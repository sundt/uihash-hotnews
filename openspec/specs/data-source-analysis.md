# 数据来源架构分析

## 概述

Hotnews 项目的数据爬取**不依赖你的本地网络直接访问各平台**，而是通过一个第三方聚合 API 服务获取数据。

## 数据流架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        数据流向图                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐                                               │
│  │  今日头条    │──┐                                            │
│  ├──────────────┤  │                                            │
│  │  微博热搜    │──┤                                            │
│  ├──────────────┤  │     ┌────────────────────┐                 │
│  │  知乎热榜    │──┼────►│  NewsNow 聚合 API  │                 │
│  ├──────────────┤  │     │ (第三方服务)       │                 │
│  │  抖音热点    │──┤     │ busiyi.world       │                 │
│  ├──────────────┤  │     └─────────┬──────────┘                 │
│  │  B站/GitHub  │──┘               │                            │
│  │  ... 31个    │                  │ HTTPS                      │
│  └──────────────┘                  ▼                            │
│                          ┌─────────────────────┐                │
│                          │  你的服务器/本地    │                │
│                          │  Hotnews 爬虫    │                │
│                          └─────────┬───────────┘                │
│                                    │                            │
│                                    ▼                            │
│                          ┌─────────────────────┐                │
│                          │   本地 SQLite 存储   │                │
│                          └─────────────────────┘                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 核心发现

### 1. 数据来源：第三方聚合 API

**API 地址**：
```
https://newsnow.busiyi.world/api/s?id={platform_id}&latest
```

**关键代码** ([fetcher.py](../../hotnews/crawler/fetcher.py#L24)):
```python
DEFAULT_API_URL = "https://newsnow.busiyi.world/api/s"
```

这是一个开源项目 [NewsNow](https://github.com/Jannchie/newsnow) 的公开实例，由第三方维护。

### 2. 网络依赖分析

| 访问目标 | 域名 | 网络要求 |
|----------|------|----------|
| 数据 API | `newsnow.busiyi.world` | ✅ 国内可访问 |
| GitHub 原始文件 | `raw.githubusercontent.com` | ⚠️ 部分地区需代理 |

### 3. 平台数据覆盖

**国内平台（31个）**：今日头条、百度、微博、知乎、抖音、B站、财联社、华尔街见闻等
**国际平台（3个）**：GitHub、Hacker News、ProductHunt

所有平台数据都通过 NewsNow API 获取，**不是直接爬取各平台**。

## 优缺点分析

### ✅ 优点

1. **无需复杂爬虫**：不用处理各平台反爬、登录等问题
2. **国内服务器可用**：API 在国内可访问，无需代理
3. **统一数据格式**：所有平台返回统一 JSON 格式
4. **低资源消耗**：只是 HTTP 请求，不需要浏览器模拟

### ⚠️ 风险

1. **第三方依赖**：如果 `busiyi.world` 服务停止，数据获取将中断
2. **数据延迟**：API 可能返回缓存数据（有 `status: cache` 标识）
3. **无法定制**：无法获取 API 未提供的平台数据

## 服务器部署建议

### 国内服务器

```yaml
# 推荐配置 - 国内阿里云/腾讯云
crawler:
  use_proxy: false  # 无需代理
```

**可正常使用的功能**：
- ✅ 所有新闻数据爬取（通过 NewsNow API）
- ✅ MCP Server
- ✅ News Viewer
- ⚠️ 版本检查可能失败（依赖 GitHub）

### 如需访问 GitHub 原始文件

用于版本更新检查，可配置代理或关闭：

```yaml
app:
  show_version_update: false  # 关闭版本检查
```

## 自建 NewsNow 实例（可选）

如果担心第三方服务稳定性，可以自建：

```bash
# NewsNow 是开源项目
git clone https://github.com/Jannchie/newsnow
# 按其文档部署后，修改 API 地址
```

然后在代码中修改 API 地址：
```python
# hotnews/crawler/fetcher.py
DEFAULT_API_URL = "https://your-own-newsnow.com/api/s"
```

## 结论

| 问题 | 答案 |
|------|------|
| 需要访问外网吗？ | ❌ 主要功能不需要 |
| 数据从哪来？ | 第三方 NewsNow API（国内可访问） |
| 直接爬取各平台吗？ | ❌ 不是，通过聚合 API |
| 国内服务器能用吗？ | ✅ 完全可以 |

**总结**：项目通过国内可访问的第三方聚合 API 获取数据，国内服务器可正常部署使用，无需代理。
