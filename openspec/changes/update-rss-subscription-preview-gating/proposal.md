# Change: RSS 订阅流程增加“预览校验后才能添加/保存”按钮门禁（entries>0）

## Why

当前 RSS 订阅弹窗允许用户在未预览验证的情况下直接添加订阅并保存，容易出现：
- 订阅了不可访问/不可解析的源，保存后回到 Viewer 才发现没有内容
- 新增源 title/栏目未确认，后续需要反复修改

希望将“源可用性验证”前置到预览步骤，提供更明确的引导式交互：
- 必须预览成功且有条目（entries>0）才允许添加订阅
- 必须至少添加过订阅才允许保存并刷新

同时保留“一次添加多个源后统一保存”的能力。

## What Changes

- 前端：RSS 订阅弹窗的按钮启用状态（gating）
  - 「预览」：在已选择 RSS 源时可点击。
  - 「添加订阅」：不再作为必需步骤；预览成功后由系统自动将该源加入“待保存订阅列表”（见下）。
  - 「保存并刷新」：仅当订阅列表相对打开弹窗时的快照发生变更，且所有“本次新增的订阅源”均满足预览 **entries>0** 时可点击。

- 前端：预览成功后的“自动加入待保存列表”（支持一次添加多个源）
  - 当用户对某个 `source_id` 执行预览且返回 `entries_count > 0` 时，系统 MUST 自动将该源加入“已保存订阅（待保存）”列表（新增或覆盖同源条目）。
  - 用户可以继续选择其它 RSS 源并重复预览，从而在同一次弹窗会话中批量加入多个订阅。
  - 用户可以从列表中删除待保存订阅。

- 前端：预览结果的状态管理
  - 对每个 `source_id` 记录预览状态：成功/失败、entries_count、时间戳。
  - 将“是否可添加/是否可保存”的判断基于该状态。

- UI 反馈
  - 当按钮不可用时提供原因提示（例如：未选择源 / 需先预览 / 预览无条目）。
  - 当预览返回 entries=0 时提示用户需要稍后重试（严格门禁，不提供跳过）。

- 测试：更新/新增 Playwright E2E
  - 覆盖：预览 entries=0 不会加入待保存列表且保存不可用；预览 entries>0 自动加入待保存列表；待保存列表变更后保存可用。

## Impact

- Affected specs:
  - `viewer-rss-subscriptions`

- Affected code:
  - `trendradar/web/static/js/src/subscription.js`
  - `trendradar/web/templates/_viewer_modals.html`（如需补充灰态/提示区域）
  - `tests/e2e/rss-subscriptions.spec.ts`

## Non-Goals

- 不改变 RSS 抓取、写库、warmup、保存后 0–5 秒等待就绪的策略。
- 不新增后端接口。

## Risks

- 合法但低频/临时无更新的 RSS 源可能长期 entries=0，会导致严格门禁阻止保存。
- 需要谨慎定义“本次新增订阅源”的范围，避免要求用户对历史已保存订阅重复预览。

## Acceptance Criteria

- 在 RSS 订阅弹窗：
  - 未预览（或预览失败 / entries=0）时，系统 MUST 不会将源加入待保存订阅列表。
  - 预览成功且 entries>0 后，系统 MUST 自动将该源加入待保存订阅列表。
  - 未添加任何订阅变更时，用户无法点击「保存并刷新」。
  - 发生订阅变更且满足预览门禁时，用户可以点击「保存并刷新」。
- Playwright E2E 覆盖上述行为并通过。
