import{a as C}from"./chunk-E3FXOX6T.js";import{a as l,b as T,c as b,d as Ke,e as ne}from"./chunk-NTAR7AIA.js";var kn={updatePlatformCount(e){if(!e)return;let t=e.querySelectorAll(".news-item:not(.filtered):not(.search-hidden):not(.paged-hidden)"),r=e.querySelector(".platform-visible-count");r&&(r.textContent=t.length)},updateAllCounts(){document.querySelectorAll(".platform-card").forEach(r=>{this.updatePlatformCount(r)});let e=document.querySelectorAll(".news-item:not(.filtered):not(.search-hidden):not(.paged-hidden)").length,t=document.getElementById("totalNews");t&&(t.textContent=e)}};l.counts=kn;var oe={openLink(e){let t=e.dataset.url;t&&window.open(t,"_blank")},isHoverDevice(){return window.matchMedia&&window.matchMedia("(hover: hover)").matches},closeAllPreviews(e){document.querySelectorAll(".news-item.preview").forEach(t=>{e&&t===e||t.classList.remove("preview")})},handleTitleClickV2(e,t){t.stopPropagation();let r=e.closest(".news-item");if(!r)return;let n=r.querySelector(".news-checkbox");if(n?n.checked||(n.checked=!0,typeof window.markAsRead=="function"?window.markAsRead(n):l.readState&&typeof l.readState.markAsRead=="function"&&l.readState.markAsRead(n)):l.readState&&typeof l.readState.markItemAsRead=="function"&&l.readState.markItemAsRead(r),this.isHoverDevice())return;if(r.classList.contains("preview")){r.classList.remove("preview");return}t.preventDefault(),this.closeAllPreviews(r),r.classList.add("preview")},handleTitleKeydownV2(e,t){t.key==="Enter"?this.handleTitleClickV2(e,t):t.key===" "?(t.preventDefault(),this.handleTitleClickV2(e,t)):t.key==="Escape"&&this.closeAllPreviews(null)}};window.handleTitleClickV2=(e,t)=>oe.handleTitleClickV2(e,t);window.handleTitleKeydownV2=(e,t)=>oe.handleTitleKeydownV2(e,t);window.openLink=e=>oe.openLink(e);document.addEventListener("click",e=>{e.target.closest(".news-item")||oe.closeAllPreviews(null)});document.addEventListener("touchstart",e=>{e.target.closest(".news-item")||oe.closeAllPreviews(null)},{passive:!0});document.addEventListener("keydown",e=>{e.key==="Escape"&&oe.closeAllPreviews(null)});l.link=oe;var Jt={searchNews(){let t=(document.getElementById("searchInput")?.value||"").toLowerCase();document.querySelectorAll(".news-item").forEach(r=>{let n=r.textContent.toLowerCase();!t||n.includes(t)?r.classList.remove("search-hidden"):r.classList.add("search-hidden")}),l.counts.updateAllCounts(),l.paging&&typeof l.paging.scheduleAutofillActiveTab=="function"&&l.paging.scheduleAutofillActiveTab()}};window.searchNews=()=>Jt.searchNews();l.search=Jt;var Zt="hotnews_platform_grid_scroll_v1",Qt={getPlatformGridScrollState(){return C.get(Zt,{})},setPlatformGridScrollState(e){C.set(Zt,e||{})},recordPlatformGridScrollForTab(e,t){if(!e||!t)return;let r=t.scrollLeft||0,n=null,o=0,a=null,i=t.querySelectorAll(".platform-card");for(let d of i)if((d.offsetLeft||0)<=r+1)a=d;else break;a?.dataset?.platform&&(n=a.dataset.platform,o=Math.max(0,r-(a.offsetLeft||0)));let s=this.getPlatformGridScrollState();s[e]={left:r,anchorPlatformId:n,anchorOffsetX:o,updatedAt:Date.now()},this.setPlatformGridScrollState(s)},attachPlatformGridScrollPersistence(){document.querySelectorAll(".tab-pane .platform-grid").forEach(e=>{if(e.dataset.scrollPersistBound==="1")return;e.dataset.scrollPersistBound="1";let t=!1;e.addEventListener("scroll",()=>{e.dataset.trRestoring!=="1"&&(e.dataset.trUserScrolled="1"),!t&&(t=!0,requestAnimationFrame(()=>{t=!1;let r=e.closest(".tab-pane"),n=r?.id?.startsWith("tab-")?r.id.slice(4):null;this.recordPlatformGridScrollForTab(n,e)}))},{passive:!0})})},restoreActiveTabPlatformGridScroll(e){let t=e?.activeTab;if(!e?.preserveScroll||!t)return;let r=this.getPlatformGridScrollState()?.[t],n=Number.isFinite(r?.left)?r.left:Number.isFinite(e.activeTabPlatformGridScrollLeft)?e.activeTabPlatformGridScrollLeft:0,o=typeof r?.anchorPlatformId=="string"&&r.anchorPlatformId?r.anchorPlatformId:e.activeTabPlatformAnchorPlatformId,a=Number.isFinite(r?.anchorOffsetX)?r.anchorOffsetX:Number.isFinite(e.activeTabPlatformAnchorOffsetX)?e.activeTabPlatformAnchorOffsetX:0,i=()=>{let s=document.querySelector(`#tab-${t} .platform-grid`);if(s&&s.dataset.trUserScrolled!=="1"){if(o){let d=null;if(s.querySelectorAll(".platform-card").forEach(f=>{!d&&f.dataset.platform===o&&(d=f)}),d&&d.offsetParent!==null){s.dataset.trRestoring="1",s.scrollLeft=(d.offsetLeft||0)+a,requestAnimationFrame(()=>{try{delete s.dataset.trRestoring}catch{}});return}}s.dataset.trRestoring="1",s.scrollLeft=n,requestAnimationFrame(()=>{try{delete s.dataset.trRestoring}catch{}})}};requestAnimationFrame(()=>{requestAnimationFrame(()=>{i(),setTimeout(i,50),setTimeout(i,200),setTimeout(i,600)})})},pauseScrollSnap(){document.body.classList.add("tr-snap-paused")},resumeScrollSnap(){setTimeout(()=>{document.body.classList.remove("tr-snap-paused")},100)},setupVisibilityScrollFix(){document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?(document.body.classList.add("tr-page-hidden"),this.pauseScrollSnap()):document.visibilityState==="visible"&&(document.body.classList.remove("tr-page-hidden"),this.resumeScrollSnap())}),window.addEventListener("beforeunload",()=>{this.pauseScrollSnap()})}};l.scroll=Qt;T(function(){Qt.setupVisibilityScrollFix()});var er="hotnews_feature_badge_v1:",tr="hotnews_new_badges_dismissed_v1",ht={getFeatureBadgeState(e){return C.get(er+e,null)},setFeatureBadgeState(e,t){C.set(er+e,t)},ensureFeatureFirstSeen(e){let t=this.getFeatureBadgeState(e);if(t&&typeof t.firstSeenAt=="number")return t;let r={firstSeenAt:Date.now(),seenAt:null};return this.setFeatureBadgeState(e,r),r},markFeatureSeen(e){let t=this.ensureFeatureFirstSeen(e);t.seenAt||(t.seenAt=Date.now(),this.setFeatureBadgeState(e,t))},shouldShowFeatureBadge(e,t){let r=this.ensureFeatureFirstSeen(e);if(r.seenAt)return!1;let n=(t||7)*24*60*60*1e3;return Date.now()-(r.firstSeenAt||0)<=n},updateNewBadges(){let e=document.getElementById("newBadgeSportsTab");e&&(e.style.display=this.shouldShowFeatureBadge("sports-nba-schedule",7)?"":"none")},getDismissedNewBadges(){let e=C.get(tr,{});return{categories:e?.categories||{},platforms:e?.platforms||{}}},setDismissedNewBadges(e){C.set(tr,e||{categories:{},platforms:{}})},applyDismissedNewBadges(){let e=this.getDismissedNewBadges();document.querySelectorAll(".new-badge-category").forEach(t=>{let r=t?.dataset?.category;r&&e.categories?.[r]&&(t.style.display="none")}),document.querySelectorAll(".new-badge-platform").forEach(t=>{let r=t?.dataset?.platform;r&&e.platforms?.[r]&&(t.style.display="none")})},dismissNewCategoryBadge(e){if(!e)return;let t=this.getDismissedNewBadges();t.categories?.[e]||(t.categories[e]=!0,this.setDismissedNewBadges(t)),document.querySelectorAll(`.new-badge-category[data-category="${CSS.escape(e)}"]`).forEach(r=>{r.style.display="none"})},dismissNewPlatformBadge(e){if(!e)return;let t=this.getDismissedNewBadges();t.platforms?.[e]||(t.platforms[e]=!0,this.setDismissedNewBadges(t)),document.querySelectorAll(`.new-badge-platform[data-platform="${CSS.escape(e)}"]`).forEach(r=>{r.style.display="none"})}};window.dismissNewPlatformBadge=e=>ht.dismissNewPlatformBadge(e);l.badges=ht;T(function(){ht.applyDismissedNewBadges()});var Xe=window.SYSTEM_SETTINGS?.display?.items_per_card||20,Mn=50,Ns=window.SYSTEM_SETTINGS?.display?.items_per_card||20,rr=10,Pn=8,On=80,In=160,Oe={PAGE_SIZE:Xe,getCardMaxPageSize(e){try{if(e?.classList?.contains("tr-morning-brief-card"))return Mn}catch{}return Xe},getCardPageSize(e){let t=e?.dataset?.pageSize,r=parseInt(t||"",10),n=Number.isFinite(r)&&r>0?r:Xe,o=this.getCardMaxPageSize(e);return Math.min(o,Math.max(1,n))},setCardPageSize(e,t){if(!e)return;let r=parseInt(String(t||""),10),n=Number.isFinite(r)&&r>0?r:Xe,o=this.getCardMaxPageSize(e);e.dataset.pageSize=String(Math.min(o,Math.max(1,n)))},applyPagingToCard(e,t){let r=Array.from(e.querySelectorAll(".news-item")),n=r.length,o=this.getCardPageSize(e);if(n<=o){r.forEach(s=>s.classList.remove("paged-hidden")),e.dataset.pageOffset="0";return}let a=Math.max(0,Math.min(t,n-1)),i=Math.min(a+o,n);r.forEach((s,d)=>{d>=a&&d<i?s.classList.remove("paged-hidden"):s.classList.add("paged-hidden")}),e.dataset.pageOffset=String(a)},initPaging(){document.querySelectorAll(".platform-card").forEach(e=>{let t=this.getCardMaxPageSize(e);this.setCardPageSize(e,t),this.applyPagingToCard(e,0)}),l.counts.updateAllCounts()},refreshPlatform(e){let t=e.closest(".platform-card");if(!t)return;let n=t.querySelectorAll(".news-item").length,o=this.getCardPageSize(t);if(n<=o)return;let a=parseInt(t.dataset.pageOffset||"0",10),i=a+o>=n?0:a+o;this.applyPagingToCard(t,i),l.counts.updateAllCounts()},getVisibleNewsItems(e){return e?Array.from(e.querySelectorAll(".news-item")).filter(t=>!t.classList.contains("filtered")&&!t.classList.contains("search-hidden")&&!t.classList.contains("paged-hidden")&&!t.classList.contains("read")):[]},shouldAutofillCard(e,t){if(!e||e.classList.contains("platform-empty-hidden"))return!1;try{if(e.classList.contains("tr-morning-brief-card"))return!1}catch{}let r=this.getVisibleNewsItems(e),n=Number.isFinite(t)?t:rr;if(r.length<n)return!0;let o=r[r.length-1];if(!o)return!0;let a=e.getBoundingClientRect(),i=o.getBoundingClientRect();return!Number.isFinite(a.bottom)||!Number.isFinite(i.bottom)?!1:a.bottom-i.bottom>=On},autofillCard(e,t={}){if(!e)return!1;try{if(e.classList.contains("tr-morning-brief-card"))return!1}catch{}let r=Number.isFinite(t.minVisible)?t.minVisible:rr,n=Number.isFinite(t.maxSteps)?t.maxSteps:Pn,o=t.force===!0,a=e.querySelectorAll(".news-item").length;if(a<=0)return!1;let i=parseInt(e.dataset.pageOffset||"0",10)||0,s=this.getCardPageSize(e),d=!1,f=Math.max(0,i);for(let c=0;c<n&&!(!o&&!this.shouldAutofillCard(e,r)||a<=s);c++){let u=f+s;if(u+s>a&&(u=0),u===f)break;f=u,this.setCardPageSize(e,s),this.applyPagingToCard(e,f),d=!0}return d&&l.counts.updateAllCounts(),d},autofillForCategory(e,t={}){let r=document.getElementById(`tab-${e}`);if(!r)return!1;let n=!1;return r.querySelectorAll(".platform-card").forEach(o=>{this.autofillCard(o,t)&&(n=!0)}),n},autofillActiveTab(e={}){let r=document.querySelector(".category-tabs .category-tab.active")?.dataset?.category;return r?this.autofillForCategory(r,e):!1},scheduleAutofillActiveTab(e={}){clearTimeout(this._autofillTimer),this._autofillTimer=setTimeout(()=>{this._autofillTimer=null,this.autofillActiveTab(e)},120)},attachAutofillScrollListener(){this._autofillScrollBound||(this._autofillScrollBound=!0,window.addEventListener("scroll",()=>{(document.documentElement.scrollHeight||0)-(window.scrollY+window.innerHeight)<=In&&this.scheduleAutofillActiveTab({force:!0})},{passive:!0}))}};window.refreshPlatform=e=>Oe.refreshPlatform(e);l.paging=Oe;T(function(){Oe.initPaging(),Oe.attachAutofillScrollListener(),Oe.scheduleAutofillActiveTab({force:!0,maxSteps:1})});var nr="hotnews_read_news_v2",or="hotnews_read_news",sr="hotnews_show_read_mode",Nn=24,G={getReadNews(){return C.get(nr,{})},saveReadNews(e){C.set(nr,e)},getShowReadModePref(){let e=C.getRaw(sr);return e===null?!0:e==="1"},applyShowReadMode(e){e?document.body.classList.add("show-read-mode"):document.body.classList.remove("show-read-mode");let t=document.getElementById("showReadBtn");t&&(e?t.classList.add("active"):t.classList.remove("active"))},migrateOldFormat(){C.getRaw(or)&&(C.remove(or),console.log("\u5DF2\u6E05\u9664\u65E7\u7248\u672C\u5DF2\u8BFB\u8BB0\u5F55"))},cleanupExpiredReads(){let e=Date.now(),t=this.getReadNews(),r=!1,n=0;for(let[o,a]of Object.entries(t))if((e-a.readAt)/36e5>=Nn){let s=document.querySelector(`[data-news-id="${o}"]`);if(s){s.classList.remove("read");let d=s.querySelector(".news-checkbox");d&&(d.checked=!1)}delete t[o],r=!0,n++}return r&&this.saveReadNews(t),n},markAsRead(e){let t=e.closest(".news-item"),r=t.dataset.newsId,n=t.dataset.newsTitle||"",o=this.getReadNews();e.checked?(t.classList.add("read"),o[r]||(o[r]={title:n.substring(0,50),readAt:Date.now()},this.saveReadNews(o))):(t.classList.remove("read"),delete o[r],this.saveReadNews(o)),l.counts.updatePlatformCount(e.closest(".platform-card")),this.updateReadCount()},markItemAsRead(e){try{if(!e)return;let t=e.dataset.newsId,r=e.dataset.newsTitle||"";if(!t)return;e.classList.add("read");let n=this.getReadNews();n[t]||(n[t]={title:String(r||"").substring(0,50),readAt:Date.now()},this.saveReadNews(n)),l.counts.updatePlatformCount(e.closest(".platform-card")),this.updateReadCount()}catch{}},updateReadCount(){let e=this.getReadNews(),t=document.getElementById("readCount");t&&(t.textContent=Object.keys(e).length)},restoreReadState(){let e=this.getReadNews();Object.keys(e).forEach(t=>{let r=document.querySelector(`[data-news-id="${t}"]`);if(r){r.classList.add("read");let n=r.querySelector(".news-checkbox");n&&(n.checked=!0)}}),l.counts.updateAllCounts(),this.updateReadCount()},toggleShowRead(){let e=!document.body.classList.contains("show-read-mode");this.applyShowReadMode(e),C.setRaw(sr,e?"1":"0"),l.counts.updateAllCounts()},clearAllRead(){confirm("\u786E\u5B9A\u8981\u6E05\u9664\u6240\u6709\u5DF2\u8BFB\u8BB0\u5F55\u5417\uFF1F\u6240\u6709\u65B0\u95FB\u5C06\u6062\u590D\u663E\u793A\u3002")&&(document.querySelectorAll(".news-item.read").forEach(e=>{e.classList.remove("read");let t=e.querySelector(".news-checkbox");t&&(t.checked=!1)}),this.saveReadNews({}),l.counts.updateAllCounts(),this.updateReadCount())}};window.markAsRead=e=>G.markAsRead(e);window.toggleShowRead=()=>G.toggleShowRead();window.clearAllRead=()=>G.clearAllRead();l.readState=G;T(function(){G.applyShowReadMode(G.getShowReadModePref()),G.migrateOldFormat();let e=G.cleanupExpiredReads();e>0&&console.log(`\u5DF2\u6E05\u7406 ${e} \u6761\u8FC7\u671F\u5DF2\u8BFB\u8BB0\u5F55`),G.restoreReadState(),G.updateReadCount()});var ar="hotnews_theme_mode",ir="eye-protection-mode",yt={isDarkMode(){try{return localStorage.getItem(ar)==="dark"}catch{return!1}},toggle(){let t=!this.isDarkMode();this.apply(t);try{localStorage.setItem(ar,t?"dark":"light")}catch{}},apply(e){e?document.body.classList.add(ir):document.body.classList.remove(ir),this.updateButtonState(e)},updateButtonState(e){let t=document.getElementById("themeToggleBtn");t&&(t.innerHTML=e?"\u{1F31E}":"\u{1F319}",t.classList.toggle("active",e))},init(){let e=this.isDarkMode();this.apply(e)}};l.theme=yt;window.toggleTheme=function(){yt.toggle()};document.addEventListener("DOMContentLoaded",()=>{yt.init()});var Je="hotnews_categories_config",wt=1,L=null,N=null,se=null,Ie=!1,we=!1,Z=!0,Rn=null,Ne="",z=!1;function Dn(e,t){let r=Array.isArray(e)?e:[],n=new Set,o=[];r.forEach(i=>{let s=String(i||"").trim();s&&(n.has(s)||(n.add(s),o.push(s)))});let a=Array.isArray(t)?t:[];a.forEach(i=>{let s=o.indexOf(i);s>=0&&o.splice(s,1)});for(let i=a.length-1;i>=0;i-=1){let s=String(a[i]||"").trim();s&&o.unshift(s)}return o}function Ze(e){(!e.categoryFilters||typeof e.categoryFilters!="object")&&(e.categoryFilters={})}function lr(e){let t=e&&typeof e=="object"?e:{};return Array.isArray(t.customCategories)||(t.customCategories=[]),Array.isArray(t.hiddenDefaultCategories)||(t.hiddenDefaultCategories=[]),Array.isArray(t.hiddenPlatforms)||(t.hiddenPlatforms=[]),Array.isArray(t.categoryOrder)||(t.categoryOrder=[]),(!t.platformOrder||typeof t.platformOrder!="object")&&(t.platformOrder={}),Ze(t),t}var M={CATEGORY_CONFIG_KEY:Je,ensureCategoryFilters:Ze,normalizeCategoryConfig:lr,getCategoryConfig(){try{let e=C.getRaw(Je);if(!e)return null;let t=JSON.parse(e);return t.version!==wt?null:lr(t)}catch{return null}},saveCategoryConfig(e){e.version=wt,C.setRaw(Je,JSON.stringify(e)),this.syncConfigToCookie(e)},syncConfigToCookie(e){try{e.customCategories?.length>0||e.hiddenDefaultCategories?.length>0||e.hiddenPlatforms?.length>0||e.categoryOrder?.length>0?document.cookie="hotnews_has_config=1; path=/; max-age=31536000; SameSite=Lax":document.cookie="hotnews_has_config=; path=/; max-age=0"}catch(t){console.error("Failed to sync config to cookie:",t)}},getDefaultCategoryConfig(){return L||(L={},N={},document.querySelectorAll(".category-tab").forEach(e=>{let t=e.dataset.category,r=e.querySelector(".category-tab-icon")?.textContent?.trim()||"\u{1F4C1}",n=e.querySelector(".category-tab-name")?.textContent?.replace(/NEW$/,"")?.trim()||t;L[t]={id:t,name:n,icon:r,isDefault:!0}}),document.querySelectorAll(".platform-card:not(.tr-morning-brief-card)").forEach(e=>{let t=e.dataset.platform,r=(e.querySelector(".platform-name")?.textContent||"").replace(/NEW\s*$/i,"").replace(/ðŸ“±\s*/g,"").trim()||t,o=e.closest(".tab-pane")?.id?.replace("tab-","")||"other";N[t]={id:t,name:r,defaultCategory:o},L[o]&&(L[o].platforms||(L[o].platforms=[]),L[o].platforms.push(t))})),{version:wt,customCategories:[],hiddenDefaultCategories:[],hiddenPlatforms:[],categoryOrder:Object.keys(L),platformOrder:{},categoryFilters:{}}},getMergedCategoryConfig(){let e=this.getDefaultCategoryConfig(),t=this.getCategoryConfig();if(!t)return e;let r={...e,customCategories:t.customCategories||[],hiddenDefaultCategories:t.hiddenDefaultCategories||[],hiddenPlatforms:t.hiddenPlatforms||[],categoryOrder:t.categoryOrder||e.categoryOrder,platformOrder:t.platformOrder||{},categoryFilters:t.categoryFilters||{}},n=Object.keys(L);n.forEach((o,a)=>{if(!r.categoryOrder.includes(o)){let i=r.categoryOrder.length;for(let s=a-1;s>=0;s--){let d=n[s],f=r.categoryOrder.indexOf(d);if(f!==-1){i=f+1;break}}r.categoryOrder.splice(i,0,o)}}),r.customCategories.forEach(o=>{r.categoryOrder.includes(o.id)||r.categoryOrder.push(o.id)});try{let o="__migrated_explore_knowledge_front_v1",a=Array.isArray(t.categoryOrder)?t.categoryOrder.indexOf("explore"):-1,i=Array.isArray(t.categoryOrder)?t.categoryOrder.indexOf("knowledge"):-1,s=a!==0||i!==1;if(!t[o]&&s){let d=Dn(r.categoryOrder,["explore","knowledge"]);r.categoryOrder=d,t.categoryOrder=d,t[o]=Date.now(),this.saveCategoryConfig(t)}}catch{}try{let o=r.categoryOrder.indexOf("my-tags");o>0?(r.categoryOrder.splice(o,1),r.categoryOrder.unshift("my-tags")):o===-1&&r.categoryOrder.unshift("my-tags")}catch{}return r},getDefaultCategories(){return L},getAllPlatforms(){return N},addPlatformToCustomCategory(e,t){let r=String(e||"").trim(),n=String(t||"").trim();if(!r||!n)return!1;let o=this.getCategoryConfig()||this.getDefaultCategoryConfig();Ze(o);let a=Array.isArray(o.customCategories)?o.customCategories.findIndex(d=>String(d?.id||"").trim()===r):-1;if(a<0)return!1;let i=o.customCategories[a]||{},s=Array.isArray(i.platforms)?[...i.platforms]:[];return s.includes(n)||s.push(n),o.customCategories[a]={...i,platforms:s},Array.isArray(o.categoryOrder)&&!o.categoryOrder.includes(r)&&o.categoryOrder.unshift(r),this.saveCategoryConfig(o),z=!0,!0},setDefaultCategories(e){L=e},setAllPlatforms(e){N=e},async openCategorySettings(){let e=document.getElementById("categorySettingsNewBadge");e&&(e.style.display="none",localStorage.setItem("category_settings_badge_dismissed","true"));try{let n=await(await fetch("/api/news")).json();n?.categories&&(L={},N={},Object.entries(n.categories).forEach(([o,a])=>{L[o]={id:o,name:a.name,icon:a.icon,isDefault:!0,platforms:Object.keys(a.platforms||{})},Object.entries(a.platforms||{}).forEach(([i,s])=>{N[i]={id:i,name:s.name,defaultCategory:o,data:s}})}))}catch(r){console.error("Failed to fetch categories:",r)}document.getElementById("categorySettingsModal").classList.add("show"),Z=!0,Rn=null,this.applyCategoryListCollapseState(),this.renderCategoryList(),this.hideEditPanel()},applyCategoryListCollapseState(){let e=document.getElementById("categoryListWrapper");e&&(Z?e.classList.add("collapsed"):e.classList.remove("collapsed"));let t=document.getElementById("categoryListToggleBtn");t&&(t.textContent=Z?"\u5C55\u5F00\u680F\u76EE\u5217\u8868":"\u6536\u8D77\u680F\u76EE\u5217\u8868")},toggleCategoryListCollapseInSettings(){Z=!Z,this.applyCategoryListCollapseState()},closeCategorySettings(){document.getElementById("categorySettingsModal").classList.remove("show"),z&&(z=!1,this.applyCategoryConfig())},saveCategorySettings(){let e=document.getElementById("categoryEditPanel");e&&e.classList.contains("show")&&!this.saveCategory()||this.closeCategorySettings()},cancelCategorySettings(){z=!1,document.getElementById("categorySettingsModal").classList.remove("show")},renderCategoryList(){let e=document.getElementById("categoryList"),t=this.getMergedCategoryConfig(),r="";t.categoryOrder.forEach(o=>{let a=t.customCategories.find(f=>f.id===o),i=t.hiddenDefaultCategories.includes(o),s;if(a)s=a;else if(L[o])s=L[o];else return;let d=a?s.platforms?.length||0:L[o]?.platforms?.length||0;r+=`
                <div class="category-item ${a?"custom":""}" data-category-id="${o}" draggable="true">
                    <span class="category-item-drag">\u2630</span>
                    <span class="category-item-name">${s.name}</span>
                    <span class="category-item-platforms">${d} \u4E2A\u5E73\u53F0</span>
                    <label class="category-item-toggle">
                        <input type="checkbox" ${i?"":"checked"} onchange="toggleCategoryVisibility('${o}')">
                        <span class="slider"></span>
                    </label>
                    <div class="category-item-actions">
                        <button class="category-item-btn" onclick="editCategory('${o}')">\u7F16\u8F91</button>
                        ${a?`<button class="category-item-btn delete" onclick="deleteCategory('${o}')">\u5220\u9664</button>`:""}
                    </div>
                </div>
            `}),e.innerHTML=r;let n=document.getElementById("allCategoriesOffToggle");if(n){let o=t.hiddenDefaultCategories||[],a=t.categoryOrder||[];n.checked=a.length>0&&a.every(i=>o.includes(i))}we?e.classList.add("hide-default"):e.classList.remove("hide-default"),this.setupCategoryDragAndDrop()},toggleDefaultCategoryListInSettings(){we=!we,this.renderCategoryList()},toggleAllCategoriesOffInSettings(e){},setupCategoryDragAndDrop(){let e=document.getElementById("categoryList");e.querySelectorAll(".category-item").forEach(r=>{r.addEventListener("dragstart",n=>{r.classList.add("dragging"),n.dataTransfer.effectAllowed="move"}),r.addEventListener("dragend",()=>{r.classList.remove("dragging"),this.saveCategoryOrder()}),r.addEventListener("dragover",n=>{n.preventDefault();let o=e.querySelector(".dragging");if(o&&o!==r){let a=r.getBoundingClientRect(),i=a.top+a.height/2;n.clientY<i?e.insertBefore(o,r):e.insertBefore(o,r.nextSibling)}})})},saveCategoryOrder(){let t=document.getElementById("categoryList").querySelectorAll(".category-item"),r=Array.from(t).map(o=>o.dataset.categoryId),n=this.getCategoryConfig()||this.getDefaultCategoryConfig();n.categoryOrder=r,this.saveCategoryConfig(n),z=!0},toggleCategoryVisibility(e){let t=this.getCategoryConfig()||this.getDefaultCategoryConfig(),r=t.hiddenDefaultCategories.indexOf(e);r>=0?t.hiddenDefaultCategories.splice(r,1):t.hiddenDefaultCategories.push(e),this.saveCategoryConfig(t),z=!0,this.renderCategoryList()},togglePlatformHidden(e){let t=String(e||"").trim();if(!t)return!1;let r=this.getCategoryConfig()||this.getDefaultCategoryConfig();Array.isArray(r.hiddenPlatforms)||(r.hiddenPlatforms=[]);let n=r.hiddenPlatforms.findIndex(o=>String(o||"").trim()===t);return n>=0?r.hiddenPlatforms.splice(n,1):r.hiddenPlatforms.push(t),this.saveCategoryConfig(r),z=!0,this.applyCategoryConfig(),!0},showAddCategoryPanel(){Ie=!0,se=null,Z=!0,this.applyCategoryListCollapseState(),we=!0,document.getElementById("editCategoryName").value="";let e=document.getElementById("platformSelectField");e&&(e.style.display="");let t=document.getElementById("platformSearchInput");t&&(t.value=""),Ne="",this.renderPlatformSelectList([],!0),l.filter.setCategoryFilterEditorState("exclude",[]),document.getElementById("categoryEditPanel").classList.add("show")},editCategory(e){Ie=!1,se=e;let t=document.getElementById("platformSelectField");t&&(t.style.display="");let r=this.getMergedCategoryConfig(),n=r.customCategories.find(d=>d.id===e),o,a;n?(o=n,a=o.platforms||[]):(o=L[e],a=r.platformOrder[e]||o.platforms||[]),document.getElementById("editCategoryName").value=o.name,this.renderPlatformSelectList(a,n);let i=l.filter.getCategoryFilterConfig(e);l.filter.setCategoryFilterEditorState(i.mode,i.keywords),we=!0,Z=!0,this.applyCategoryListCollapseState();let s=document.getElementById("platformSearchInput");s&&(s.value=""),Ne="",document.getElementById("categoryEditPanel").classList.add("show")},hideEditPanel(){document.getElementById("categoryEditPanel").classList.remove("show"),se=null,Ie=!1,we=!1,this.renderCategoryList();let e=document.getElementById("platformSearchInput");e&&(e.value=""),Ne=""},cancelEditCategory(){this.hideEditPanel()},renderPlatformSelectList(e,t=!1){let r=document.getElementById("platformSelectList"),o=(this.getMergedCategoryConfig().hiddenPlatforms||[]).map(c=>String(c||"").trim()).filter(Boolean),a=new Set(o),i=[];e.forEach(c=>{N[c]&&i.push(c)}),t&&Object.keys(N).forEach(u=>{i.includes(u)||i.push(u)});let s=(Ne||"").trim().toLowerCase(),d=s?i.filter(c=>(N[c]?.name||"").toLowerCase().includes(s)):i,f=s.length>0;r.innerHTML=d.map(c=>{let u=N[c],p=e.includes(c)&&!a.has(String(c||"").trim());return`
                <label class="platform-select-item ${p?"selected":""} ${f?"no-drag":""}" data-platform-id="${c}" draggable="${f?"false":"true"}">
                    <span class="drag-handle">\u2630</span>
                    <input type="checkbox" ${p?"checked":""} onchange="togglePlatformSelect('${c}')">
                    <span>${u.name}</span>
                </label>
            `}).join(""),f||this.setupPlatformDragAndDrop()},setPlatformSearchQuery(e){Ne=String(e||"");let t=this.getSelectedPlatforms();this.renderPlatformSelectList(t,Ie===!0)},bulkSelectPlatforms(e){let t=document.getElementById("platformSelectList");if(!t)return;t.querySelectorAll(".platform-select-item").forEach(n=>{let o=n.querySelector('input[type="checkbox"]');e==="all"?(n.classList.add("selected"),o&&(o.checked=!0)):(e==="none"||e==="clear")&&(n.classList.remove("selected"),o&&(o.checked=!1))})},setupPlatformDragAndDrop(){let e=document.getElementById("platformSelectList"),t=e.querySelectorAll(".platform-select-item"),r=60,n=20,o=null,a=0,i=0,s=()=>{o&&cancelAnimationFrame(o),o=null,a=0,i=0},d=()=>{if(!a||!i){s();return}let c=Math.max(0,(e.scrollHeight||0)-(e.clientHeight||0));if(c<=0){s();return}let u=Math.max(0,Math.min(c,(e.scrollTop||0)+a*i));e.scrollTop=u,o=requestAnimationFrame(d)},f=c=>{let u=e.getBoundingClientRect(),p=c.clientY,g=p-u.top,S=u.bottom-p,A=0,_=0;if(g>=0&&g<=r)A=-1,_=g;else if(S>=0&&S<=r)A=1,_=S;else{s();return}let P=Math.max(0,Math.min(1,(r-_)/r));i=Math.max(2,Math.round(P*P*n)),a=A,o||(o=requestAnimationFrame(d))};t.forEach(c=>{c.addEventListener("dragstart",u=>{c.classList.add("dragging"),u.dataTransfer.effectAllowed="move"}),c.addEventListener("dragend",()=>{c.classList.remove("dragging"),s()}),c.addEventListener("dragover",u=>{u.preventDefault(),f(u);let p=e.querySelector(".dragging");if(p&&p!==c){let g=c.getBoundingClientRect(),S=g.top+g.height/2;u.clientY<S?e.insertBefore(p,c):e.insertBefore(p,c.nextSibling)}})}),e.addEventListener("dragover",c=>{c.preventDefault(),e.querySelector(".dragging")&&f(c)})},togglePlatformSelect(e){let t=document.querySelector(`.platform-select-item[data-platform-id="${e}"]`);t&&t.classList.toggle("selected")},getSelectedPlatforms(){let e=document.querySelectorAll(".platform-select-item"),t=[];return e.forEach(r=>{r.classList.contains("selected")&&t.push(r.dataset.platformId)}),t},getOrderedPlatforms(){let e=document.querySelectorAll(".platform-select-item"),t=[];return e.forEach(r=>{let n=String(r?.dataset?.platformId||"").trim();n&&t.push(n)}),t},saveCategory(){let e=document.getElementById("editCategoryName").value.trim(),t="\u{1F4F1}",r=this.getSelectedPlatforms(),n=this.getOrderedPlatforms();if(!e)return alert("\u8BF7\u8F93\u5165\u680F\u76EE\u540D\u79F0"),!1;if(r.length===0)return alert("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5E73\u53F0"),!1;let o=this.getCategoryConfig()||this.getDefaultCategoryConfig();Ze(o);let a=l.filter.getEditingFilterState();if(Ie){let i="custom-"+Date.now();o.customCategories.push({id:i,name:e,icon:t,platforms:r,isCustom:!0}),o.categoryOrder.unshift(i),o.categoryFilters[i]={mode:a.mode,keywords:[...a.keywords]}}else if(se){let i=o.customCategories.findIndex(s=>s.id===se);if(i>=0)o.customCategories[i]={...o.customCategories[i],name:e,icon:t,platforms:r};else{o.platformOrder[se]=n,Array.isArray(o.hiddenPlatforms)||(o.hiddenPlatforms=[]);let s=new Set((o.hiddenPlatforms||[]).map(d=>String(d||"").trim()).filter(Boolean));n.forEach(d=>{d&&(r.includes(d)?s.delete(d):s.add(d))}),o.hiddenPlatforms=Array.from(s)}o.categoryFilters[se]={mode:a.mode,keywords:[...a.keywords]}}return this.saveCategoryConfig(o),z=!0,this.hideEditPanel(),this.renderCategoryList(),Z=!1,this.applyCategoryListCollapseState(),!0},deleteCategory(e){if(!confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u81EA\u5B9A\u4E49\u680F\u76EE\u5417\uFF1F"))return;let t=this.getCategoryConfig()||this.getDefaultCategoryConfig();t.customCategories=t.customCategories.filter(r=>r.id!==e),t.categoryOrder=t.categoryOrder.filter(r=>r!==e),delete t.platformOrder[e],this.saveCategoryConfig(t),z=!0,this.renderCategoryList()},resetDefaultCategoryConfig(){if(!confirm("\u786E\u5B9A\u8981\u521D\u59CB\u5316\u9ED8\u8BA4\u680F\u76EE\u4E0E\u5361\u7247\u5417\uFF1F\u81EA\u5B9A\u4E49\u680F\u76EE\u5C06\u4FDD\u7559\u3002"))return;let e=this.getCategoryConfig();if(!e){this.renderCategoryList(),this.applyCategoryConfig();return}let t=this.getDefaultCategoryConfig(),r=Array.isArray(t?.categoryOrder)?t.categoryOrder:[],n=new Set(r.map(s=>String(s||"").trim()).filter(Boolean)),o=e;o.hiddenDefaultCategories=(o.hiddenDefaultCategories||[]).filter(s=>!n.has(String(s||"").trim())),o.hiddenPlatforms=[],o.platformOrder={};let a=Array.isArray(o.customCategories)?o.customCategories.map(s=>String(s?.id||"").trim()).filter(Boolean):[],i=r.slice();for(let s of a)i.includes(s)||i.push(s);o.categoryOrder=i,this.saveCategoryConfig(o),z=!0,this.renderCategoryList(),this.applyCategoryConfig()},resetCategoryConfig(){confirm("\u786E\u5B9A\u8981\u6062\u590D\u9ED8\u8BA4\u680F\u76EE\u914D\u7F6E\u5417\uFF1F\u6240\u6709\u81EA\u5B9A\u4E49\u680F\u76EE\u5C06\u88AB\u5220\u9664\u3002")&&(C.remove(Je),L=null,N=null,this.renderCategoryList(),this.applyCategoryConfig())},applyCategoryConfig(){l.data.refreshViewerData({preserveScroll:!1})},applyCategoryConfigToData(e){let t=this.getMergedCategoryConfig();L?Object.entries(e).forEach(([c,u])=>{if(!L[c])L[c]={id:c,name:u.name,icon:u.icon,isDefault:!0,platforms:Object.keys(u.platforms||{})};else{L[c].platforms||(L[c].platforms=[]);let p=new Set(L[c].platforms||[]);Object.keys(u.platforms||{}).forEach(g=>{p.has(g)||L[c].platforms.push(g)})}Object.entries(u.platforms||{}).forEach(([p,g])=>{N[p]||(N[p]={id:p,name:g.name,defaultCategory:c,data:g})})}):(L={},N={},Object.entries(e).forEach(([c,u])=>{L[c]={id:c,name:u.name,icon:u.icon,isDefault:!0,platforms:Object.keys(u.platforms||{})},Object.entries(u.platforms||{}).forEach(([p,g])=>{N[p]={id:p,name:g.name,defaultCategory:c,data:g}})}));let r={};Object.values(e).forEach(c=>{Object.entries(c.platforms||{}).forEach(([u,p])=>{r[u]=p})});let n={},o=t.hiddenDefaultCategories||[],a=(t.hiddenPlatforms||[]).map(c=>String(c||"").trim()).filter(Boolean),i=new Set(a),s=t.categoryOrder||Object.keys(e),d=t.customCategories||[],f=t.platformOrder||{};return s.forEach(c=>{if(o.includes(c)||String(c||"").startsWith("rsscol-"))return;let u=d.find(p=>p.id===c);if(u){let p={};(u.platforms||[]).forEach(g=>{i.has(String(g||"").trim())||r[g]&&(p[g]=r[g])}),n[c]={name:u.name,icon:"\u{1F4F1}",platforms:p}}else if(e[c]){let p=e[c],g=f[c];if(g&&g.length>0){let S=[],A=new Set;g.forEach(x=>{i.has(String(x||"").trim())||p.platforms&&p.platforms[x]&&(S.push(x),A.add(x))});let _=[],P=[];Object.keys(p.platforms||{}).forEach(x=>{A.has(x)||i.has(String(x||"").trim())||(String(x||"").startsWith("rss-")?_.push(x):P.push(x))});let h=_.concat(S,P),w={};h.forEach(x=>{i.has(String(x||"").trim())||p.platforms&&p.platforms[x]&&(w[x]=p.platforms[x])}),n[c]={...p,platforms:w}}else{let S={};Object.entries(p.platforms||{}).forEach(([A,_])=>{i.has(String(A||"").trim())||(S[A]=_)}),n[c]={...p,platforms:S}}}}),Object.keys(e).forEach(c=>{String(c||"").startsWith("rsscol-")&&String(c)!=="rsscol-rss"||!n[c]&&!o.includes(c)&&(n[c]=e[c])}),n},syncCacheWithServer(e){try{let t=this.getCategoryConfig();if(!t)return!1;let r=new Set;if(Object.values(e||{}).forEach(o=>{let a=o?.platforms||{};Object.keys(a).forEach(i=>r.add(i))}),r.size===0)return!1;let n=!1;if(t.platformOrder&&typeof t.platformOrder=="object"&&Object.keys(t.platformOrder).forEach(o=>{if(Array.isArray(t.platformOrder[o])){let a=t.platformOrder[o].length;t.platformOrder[o]=t.platformOrder[o].filter(i=>{let s=r.has(i);return s||console.log(`[HotNews] \u6E05\u7406\u65E0\u6548\u5E73\u53F0: ${i} (from platformOrder.${o})`),s}),t.platformOrder[o].length<a&&(n=!0)}}),Array.isArray(t.customCategories)&&t.customCategories.forEach(o=>{if(Array.isArray(o.platforms)){let a=o.platforms.length;o.platforms=o.platforms.filter(i=>{let s=r.has(i);return s||console.log(`[HotNews] \u6E05\u7406\u65E0\u6548\u5E73\u53F0: ${i} (from customCategory ${o.id})`),s}),o.platforms.length<a&&(n=!0)}}),Array.isArray(t.hiddenPlatforms)){let o=t.hiddenPlatforms.length;t.hiddenPlatforms=t.hiddenPlatforms.filter(a=>{let i=r.has(a);return i||console.log(`[HotNews] \u6E05\u7406\u65E0\u6548\u5E73\u53F0: ${a} (from hiddenPlatforms)`),i}),t.hiddenPlatforms.length<o&&(n=!0)}return n&&(this.saveCategoryConfig(t),console.log("[HotNews] \u5DF2\u81EA\u52A8\u6E05\u7406\u672C\u5730\u7F13\u5B58\u4E2D\u7684\u65E0\u6548\u5E73\u53F0")),n}catch(t){return console.error("[HotNews] syncCacheWithServer error:",t),!1}}};window.openCategorySettings=()=>M.openCategorySettings();window.closeCategorySettings=()=>M.closeCategorySettings();window.saveCategorySettings=()=>M.saveCategorySettings();window.cancelCategorySettings=()=>M.cancelCategorySettings();window.showAddCategoryPanel=()=>M.showAddCategoryPanel();window.editCategory=e=>M.editCategory(e);window.cancelEditCategory=()=>M.cancelEditCategory();window.saveCategory=()=>M.saveCategory();window.deleteCategory=e=>M.deleteCategory(e);window.resetDefaultCategoryConfig=()=>M.resetDefaultCategoryConfig();window.resetCategoryConfig=()=>M.resetCategoryConfig();window.toggleCategoryVisibility=e=>M.toggleCategoryVisibility(e);window.toggleCategoryListCollapseInSettings=()=>M.toggleCategoryListCollapseInSettings();window.toggleAllCategoriesOffInSettings=e=>M.toggleAllCategoriesOffInSettings(e);window.togglePlatformSelect=e=>M.togglePlatformSelect(e);window.bulkSelectPlatforms=e=>M.bulkSelectPlatforms(e);window.setPlatformSearchQuery=e=>M.setPlatformSearchQuery(e);l.settings=M;T(function(){let e=M.getCategoryConfig();e&&M.syncConfigToCookie(e)});var cr="hotnews_filter_keywords",dr="hotnews_filter_mode_v1",ae=[],Qe="exclude";function et(e){return e==="include"?"include":"exclude"}var ie={normalizeFilterMode:et,getCategoryFilterConfig(e){if(!e)return{mode:"exclude",keywords:[]};let t=l.settings.getMergedCategoryConfig(),r=t.categoryFilters&&t.categoryFilters[e],n=et(r&&r.mode),o=Array.isArray(r&&r.keywords)?r.keywords:[];return{mode:n,keywords:o.map(a=>String(a||"").trim().toLowerCase()).filter(Boolean)}},applyCategoryFilter(e){let t=document.getElementById(`tab-${e}`);if(!t)return;let r=this.getCategoryFilterConfig(e),n=r.mode,o=r.keywords,a=`${n}|${o.join(",")}`,s=(t.dataset?t.dataset.filterSig:null)!==a;t.dataset&&(t.dataset.filterSig=a);let d=t.dataset&&t.dataset.bulkLoading==="1";if(t.querySelectorAll(".news-item").forEach(f=>{let c=(f.textContent||"").toLowerCase(),u=o.length>0?o.some(g=>c.includes(g)):!1;(o.length===0?!1:n==="include"?!u:u)?f.classList.add("filtered"):f.classList.remove("filtered")}),n!=="include"&&t.querySelectorAll(".platform-card").forEach(f=>{f.classList.remove("platform-empty-hidden")}),n==="include"){if(o.length>0)try{if(s&&!d){if(t.querySelectorAll(".platform-card").forEach(f=>{f?.dataset&&(f.dataset.loadedDone="0")}),l.infiniteScroll&&typeof l.infiniteScroll.scheduleBulkLoadCategory=="function")l.infiniteScroll.scheduleBulkLoadCategory(e,{pageSize:40});else if(l.infiniteScroll&&typeof l.infiniteScroll.scheduleEnsureCategoryLoaded=="function"){let f=t.querySelectorAll(".platform-card").length;l.infiniteScroll.scheduleEnsureCategoryLoaded(e,{cap:f,maxPagesPerCard:2})}}}catch{}t.querySelectorAll(".platform-card").forEach(f=>{let c=f?.dataset?.loadedDone==="1",u=!c||f?.dataset?.loading==="1";if(o.length>0&&u){f.classList.add("platform-empty-hidden");return}f.classList.remove("platform-empty-hidden"),f.querySelectorAll(".news-item:not(.filtered):not(.search-hidden):not(.paged-hidden)").length<=0&&c&&f.classList.add("platform-empty-hidden")})}try{let f=t.querySelector(".category-empty-state");if(f)if(n==="include"&&o.length>0){let c=Array.from(t.querySelectorAll(".platform-card")),u=c.length>0&&c.every(g=>g?.dataset?.loadedDone==="1"&&g?.dataset?.loading!=="1"),p=t.querySelectorAll(".platform-card:not(.platform-empty-hidden)").length;f.style.display=u&&p===0?"block":"none"}else f.style.display="none"}catch{}l.counts.updateAllCounts(),l.paging&&typeof l.paging.scheduleAutofillActiveTab=="function"&&l.paging.scheduleAutofillActiveTab()},applyCategoryFilterForActiveTab(){let t=document.querySelector(".category-tabs .category-tab.active")?.dataset?.category;t&&this.applyCategoryFilter(t)},setCategoryFilterEditorState(e,t){Qe=et(e),ae=(Array.isArray(t)?t:[]).map(o=>String(o||"").trim().toLowerCase()).filter(Boolean);let r=document.getElementById("categoryFilterModeToggle");r&&(r.checked=Qe==="include");let n=document.getElementById("categoryFilterInput");n&&(n.value=""),this.renderCategoryFilterTags()},handleCategoryFilterModeToggle(e){Qe=e&&e.checked?"include":"exclude"},handleCategoryFilterKeypress(e){e.key==="Enter"&&this.addCategoryFilterKeyword()},addCategoryFilterKeyword(){let e=document.getElementById("categoryFilterInput"),t=(e?.value||"").trim().toLowerCase();t&&(ae.includes(t)||(ae.push(t),this.renderCategoryFilterTags()),e&&(e.value=""))},removeCategoryFilterKeyword(e){ae=ae.filter(t=>t!==e),this.renderCategoryFilterTags()},renderCategoryFilterTags(){let e=document.getElementById("categoryFilterTags");e&&(e.innerHTML=ae.map(t=>`<span class="filter-tag">${b(t)}<span class="filter-remove" onclick="removeCategoryFilterKeyword('${b(t)}')">\xD7</span></span>`).join(""))},getEditingFilterState(){return{mode:Qe,keywords:[...ae]}},migrateLegacyGlobalFilter(){let e=C.getRaw(cr),t=C.getRaw(dr);if(!e&&!t)return;let r=[];try{r=e?JSON.parse(e):[]}catch{r=[]}Array.isArray(r)||(r=[]),r=r.map(s=>String(s||"").trim().toLowerCase()).filter(Boolean);let n=et(t),o=l.settings.getCategoryConfig()||l.settings.getDefaultCategoryConfig();l.settings.ensureCategoryFilters(o),(l.settings.getMergedCategoryConfig().categoryOrder||[]).forEach(s=>{o.categoryFilters[s]||(o.categoryFilters[s]={mode:n,keywords:[...r]})}),l.settings.saveCategoryConfig(o),C.remove(cr),C.remove(dr)}};window.handleCategoryFilterModeToggle=e=>ie.handleCategoryFilterModeToggle(e);window.handleCategoryFilterKeypress=e=>ie.handleCategoryFilterKeypress(e);window.addCategoryFilterKeyword=()=>ie.addCategoryFilterKeyword();window.removeCategoryFilterKeyword=e=>ie.removeCategoryFilterKeyword(e);l.filter=ie;T(function(){ie.migrateLegacyGlobalFilter(),ie.applyCategoryFilterForActiveTab()});var be="hotnews_active_tab",fr="hotnews_viewer_pos_v1";var $n="tr_tab_switched",Bn="tr_explore_modal_opened",Fn="tr_explore_modal_closed",le=null,bt=0;function ur(e,t){try{let r=String(e||"").trim();if(!r)return;let n={activeTab:r,scrollY:Number(t||0)||0,updatedAt:Date.now()};C.setRaw(fr,JSON.stringify(n))}catch{}}function qn(){try{let e=Q.getActiveTabId();le=e?String(e):null,bt=window.scrollY||0;try{let t=le?document.querySelector(`#tab-${le} .platform-grid`):null;le&&t&&l.scroll.recordPlatformGridScrollForTab(le,t)}catch{}}catch{}}function Hn(){try{let e=C.getRaw(fr);if(!e)return;let t=JSON.parse(e),r=String(t?.activeTab||"").trim();if(!r)return;let n=window.CSS&&typeof window.CSS.escape=="function"?window.CSS.escape(String(r)):String(r);if(!document.querySelector(`.category-tab[data-category="${n}"]`))return;Q.switchTab(r);let a=Number(t?.scrollY||0)||0;requestAnimationFrame(()=>{try{window.scrollTo({top:a,behavior:"auto"})}catch{}})}catch{}}function Gn(){let e=le,t=bt;if(le=null,bt=0,!!e){try{let r=window.CSS&&typeof window.CSS.escape=="function"?window.CSS.escape(String(e)):String(e),n=document.querySelector(`.category-tab[data-category="${r}"]`),o=document.getElementById(`tab-${e}`);if(!n||!o)return}catch{}try{l.tabs.switchTab(e)}catch{}ur(e,t),requestAnimationFrame(()=>{try{window.scrollTo({top:t,behavior:"auto"})}catch{}try{l.scroll.restoreActiveTabPlatformGridScroll({preserveScroll:!0,activeTab:e})}catch{}})}}var Q={TAB_STORAGE_KEY:be,switchTab(e){l.badges.dismissNewCategoryBadge(e),document.body.classList.toggle("tr-rss-reading",String(e)==="rsscol-rss");let t=window.CSS&&typeof window.CSS.escape=="function"?window.CSS.escape(String(e)):String(e),r=document.querySelector(`.category-tab[data-category="${t}"]`),n=document.getElementById(`tab-${e}`);if(!r||!n){let i=document.querySelector(".category-tab");i?.dataset?.category&&i.dataset.category!==String(e)?this.switchTab(i.dataset.category):C.remove(be);return}let o=r.querySelector(".update-dot.show"),a=!!o;o&&o.classList.remove("show"),document.querySelectorAll(".category-tab").forEach(i=>i.classList.remove("active")),r.classList.add("active"),document.querySelectorAll(".tab-pane").forEach(i=>i.classList.remove("active")),n.classList.add("active"),C.setRaw(be,e);try{window.dispatchEvent(new CustomEvent($n,{detail:{categoryId:e,hasUpdate:a}}))}catch{}ur(e,window.scrollY||0),l.scroll.restoreActiveTabPlatformGridScroll({preserveScroll:!0,activeTab:e}),e==="sports"&&(l.badges.markFeatureSeen("sports-nba-schedule"),l.badges.updateNewBadges()),l.filter.applyCategoryFilter(e),l.paging&&typeof l.paging.scheduleAutofillActiveTab=="function"&&l.paging.scheduleAutofillActiveTab({force:!0,maxSteps:1});try{let i=!!n.querySelector(".news-item"),s=!!n.querySelector(".news-placeholder");!i&&s&&(l.infiniteScroll&&typeof l.infiniteScroll.scheduleBulkLoadCategory=="function"?l.infiniteScroll.scheduleBulkLoadCategory(e):l.infiniteScroll&&typeof l.infiniteScroll.scheduleEnsureCategoryLoaded=="function"&&l.infiniteScroll.scheduleEnsureCategoryLoaded(e))}catch{}},restoreActiveTab(){let e=C.getRaw(be);if(e){try{if(new URLSearchParams(window.location.search).get("e2e")==="1"&&String(e)==="rsscol-rss"){C.remove(be);return}}catch{}document.querySelector(`.category-tab[data-category="${e}"]`)&&this.switchTab(e)}},getActiveTabId(){return C.getRaw(be)||document.querySelector(".category-tab.active")?.dataset?.category||null},restoreActiveTabPlatformGridScroll(e){l.scroll.restoreActiveTabPlatformGridScroll(e)},attachPlatformGridScrollPersistence(){l.scroll.attachPlatformGridScrollPersistence()}};window.switchTab=e=>Q.switchTab(e);l.tabs=Q;T(function(){try{window.addEventListener(Bn,()=>{qn()}),window.addEventListener(Fn,()=>{Gn()})}catch{}Q.restoreActiveTab(),Hn(),Q.attachPlatformGridScrollPersistence();let e=Q.getActiveTabId();e&&Q.restoreActiveTabPlatformGridScroll({preserveScroll:!0,activeTab:e})});var St="hotnews_active_tab",_e=window.SYSTEM_SETTINGS?.display?.items_per_card||20,vt=!1,zn=0,Se=null,jn=null,gr=!1,ve=null;function Vn(e){let r=e?.closest?.(".tab-pane")?.id||"";return r.startsWith("tab-")?r.slice(4):null}function Yn(e,t){let n=String(t||"").trim().startsWith("rss-");return`${n?'<button type="button" class="tr-platform-card-delete" data-action="delete-platform">\u2212</button>':""}${n?"":'<button type="button" class="tr-platform-card-hide" data-action="hide-platform">\u{1F648}</button>'}`}function Wn(e){let t=Math.max(0,Number(e||0)||0),r="";for(let n=0;n<t;n++)r+='<li class="tr-news-skeleton" aria-hidden="true"><div class="tr-news-skeleton-line"></div></li>';return r}function Un(e,t,r){let n=document.createElement("li");n.className="news-item",n.dataset.newsId=String(e?.stable_id||""),n.dataset.newsTitle=String(e?.display_title||e?.title||"");let o=document.createElement("div");o.className="news-item-content";let a=document.createElement("input");a.type="checkbox",a.className="news-checkbox",a.title="\u6807\u8BB0\u5DF2\u8BFB",a.addEventListener("change",()=>{try{window.markAsRead(a)}catch{}});let i=document.createElement("span");i.className="news-index",i.textContent=String(t);let s=document.createElement("a");if(s.className="news-title",e?.is_cross_platform&&s.classList.add("cross-platform"),s.href=String(e?.url||"#"),s.target="_blank",s.rel="noopener noreferrer",s.setAttribute("onclick","handleTitleClickV2(this, event)"),s.setAttribute("onauxclick","handleTitleClickV2(this, event)"),s.setAttribute("oncontextmenu","handleTitleClickV2(this, event)"),s.setAttribute("onkeydown","handleTitleKeydownV2(this, event)"),s.textContent=String(e?.display_title||e?.title||""),e?.is_cross_platform){let u=Array.isArray(e?.cross_platforms)?e.cross_platforms:[],p=document.createElement("span");p.className="cross-platform-badge",p.title=`\u540C\u65F6\u51FA\u73B0\u5728: ${u.join(", ")}`,p.textContent=`\u{1F525} ${String(e?.cross_platform_count??"")}`,s.appendChild(document.createTextNode(" ")),s.appendChild(p)}o.appendChild(a),o.appendChild(i),o.appendChild(s);let d=ne(e?.timestamp);if(d){let u=document.createElement("span");u.className="tr-news-date",u.style.marginLeft="8px",u.style.color="#9ca3af",u.style.fontSize="12px",u.style.whiteSpace="nowrap",u.textContent=d,o.appendChild(u)}n.appendChild(o);let f=String(e?.meta||"").trim(),c=String(r||"").startsWith("rss-");if(f&&!c){let u=document.createElement("div");u.className="news-subtitle",u.textContent=f,n.appendChild(u)}try{let u=l.readState?.getReadNews?.()||{};n.dataset.newsId&&u[n.dataset.newsId]&&(n.classList.add("read"),a.checked=!0)}catch{}return n}async function Kn(e){if(!e||!(e instanceof Element)||String(e?.dataset?.lazy||"")!=="1"||String(e?.dataset?.loading||"")==="1")return;let t=e.closest(".tab-pane");if(!t||!t.classList.contains("active"))return;let r=String(e.dataset.platform||"").trim();if(r){e.dataset.loading="1";try{let n=`/api/news/page?platform_id=${encodeURIComponent(r)}&offset=0&page_size=${encodeURIComponent(String(_e))}`,o=await fetch(n);if(!o.ok)return;let a=await o.json(),i=Array.isArray(a?.items)?a.items:[],s=e.querySelector(".news-list");if(!s)return;s.querySelectorAll(".tr-news-skeleton").forEach(c=>c.remove()),s.querySelectorAll(".news-placeholder").forEach(c=>c.remove()),s.querySelectorAll(".news-item").forEach(c=>c.remove());let d=i.slice(0,_e);for(let c=0;c<d.length;c++)s.appendChild(Un(d[c],c+1,r));let f=s.querySelectorAll(".news-item").length;e.dataset.loadedCount=String(f),e.dataset.hasMore="0",e.dataset.loadedDone="1",e.dataset.lazy="0";try{l.paging&&(l.paging.setCardPageSize(e,Math.min(_e,Math.max(1,f||_e))),l.paging.applyPagingToCard(e,0))}catch{}try{l.counts?.updatePlatformCount&&l.counts.updatePlatformCount(e),l.counts?.updateAllCounts&&l.counts.updateAllCounts()}catch{}try{l.search?.searchNews?.()}catch{}try{let c=l.tabs?.getActiveTabId?.()||null;c&&l.filter?.applyCategoryFilter?.(c)}catch{}}catch{}finally{e.dataset.loading="0"}}}function mr(){try{ve&&(ve.disconnect(),ve=null)}catch{}ve=new IntersectionObserver(e=>{for(let t of e){if(!t.isIntersecting)continue;let r=t.target;if(!(!r||!(r instanceof Element))){if(String(r?.dataset?.lazy||"")!=="1"){try{ve?.unobserve?.(r)}catch{}continue}Kn(r).catch(()=>{})}}},{root:null,rootMargin:"0px 200px 0px 200px",threshold:.15}),document.querySelectorAll('.platform-card[data-lazy="1"]').forEach(e=>{try{ve.observe(e)}catch{}})}var Ce=null,ce=null;function pr(e,t,r){return new Promise(n=>{if(ce)try{ce(!1)}catch{}if(ce=n,!Ce){let o=document.createElement("div");o.className="tr-confirm-overlay",o.innerHTML=`
                <div class="tr-confirm-modal" role="dialog" aria-modal="true">
                    <div class="tr-confirm-message"></div>
                    <div class="tr-confirm-actions">
                        <button type="button" class="tr-confirm-btn tr-confirm-cancel" data-action="cancel"></button>
                        <button type="button" class="tr-confirm-btn tr-confirm-ok" data-action="ok"></button>
                    </div>
                </div>`,o.addEventListener("click",a=>{let i=a?.target;if(!i||!(i instanceof Element))return;let s=i.closest('button[data-action="ok"]'),d=i.closest('button[data-action="cancel"]');if(s){a.preventDefault(),o.classList.remove("show");let f=ce;ce=null,f?.(!0);return}if(d||i===o){a.preventDefault(),o.classList.remove("show");let f=ce;ce=null,f?.(!1)}}),document.body.appendChild(o),Ce=o}try{let o=Ce.querySelector(".tr-confirm-message");o&&(o.textContent=String(e||""));let a=Ce.querySelector('button[data-action="ok"]');a&&(a.textContent=String(t||"\u786E\u8BA4"));let i=Ce.querySelector('button[data-action="cancel"]');i&&(i.textContent=String(r||"\u53D6\u6D88"))}catch{}Ce.classList.add("show")})}async function Xn(e){let t=String(e||"").trim();if(!t)return!1;try{let r=await fetch("/api/me/rss-subscriptions",{method:"GET"});if(!r.ok)return!1;let n=await r.json().catch(()=>({}));return!(Array.isArray(n?.subscriptions)?n.subscriptions:[]).some(i=>String(i?.source_id||i?.rss_source_id||"").trim()===t)}catch{return!1}}async function Jn(e){let t=String(e||"").trim();if(!t.startsWith("rss-"))return!1;let r=t.slice(4);if(!r||!l.subscription)return!1;try{l.subscription.ensureSnapshot?.()}catch{}let n=[];try{n=l.subscription.getSubscriptions?l.subscription.getSubscriptions():[]}catch{n=[]}let o=(Array.isArray(n)?n:[]).filter(a=>String(a?.source_id||a?.rss_source_id||"").trim()!==r);try{l.subscription.setSubscriptions?.(o)}catch{return!1}try{l.subscription.saveOnly?await l.subscription.saveOnly():l.subscription.saveAndRefresh&&await l.subscription.saveAndRefresh()}catch{return!1}return await Xn(r)}async function Zn(e){if(!e||!(e instanceof Element))return;let t=Vn(e),r=String(e.getAttribute("data-platform")||"").trim();if(!t||!r||t==="explore"||!r.startsWith("rss-"))return;try{let s=!0;try{new URLSearchParams(window.location.search).get("e2e")==="1"&&(s=!1)}catch{}try{typeof navigator<"u"&&navigator.webdriver===!0&&(s=!1)}catch{}if(s&&!await pr("\u786E\u5B9A\u8981\u5220\u9664\u8BE5 RSS \u5361\u7247\u5417\uFF1F\u5220\u9664\u540E\u5C06\u53D6\u6D88\u8BA2\u9605\u3002","\u786E\u8BA4\u5220\u9664","\u53D6\u6D88"))return}catch{}try{let s=e.querySelector('button[data-action="delete-platform"]');s&&s.setAttribute("disabled","true")}catch{}let o=e.parentNode,a=e.nextSibling;try{o&&o.removeChild(e)}catch{}try{l.counts?.updateAllCounts?.()}catch{}if(!await Jn(r)){try{o&&(a?o.insertBefore(e,a):o.appendChild(e))}catch{}try{let s=e.querySelector('button[data-action="delete-platform"]');s&&s.removeAttribute("disabled")}catch{}try{l.toast?.show?.("\u5220\u9664\u5931\u8D25\uFF1A\u8BA2\u9605\u672A\u80FD\u4ECE\u670D\u52A1\u7AEF\u79FB\u9664\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",{variant:"error",durationMs:2500})}catch{}return}try{l.counts?.updateAllCounts?.(),l.readState?.updateReadCount?.()}catch{}}var tt={formatUpdatedAt:Ke,snapshotViewerState(){let e=C.getRaw(St)||document.querySelector(".category-tab.active")?.dataset?.category||null,t={};document.querySelectorAll(".platform-card").forEach(i=>{let s=i.dataset.platform;s&&(t[s]=parseInt(i.dataset.pageOffset||"0",10)||0)});let r=e?document.querySelector(`#tab-${e} .platform-grid`):null,n=r&&r.scrollLeft||0,o=null,a=0;if(r){let i=r.scrollLeft||0,s=null,d=r.querySelectorAll(".platform-card");for(let f of d)if((f.offsetLeft||0)<=i+1)s=f;else break;s?.dataset?.platform&&(o=s.dataset.platform,a=Math.max(0,i-(s.offsetLeft||0)))}return e&&r&&l.scroll.recordPlatformGridScrollForTab(e,r),{activeTab:e,pagingOffsets:t,activeTabPlatformGridScrollLeft:n,activeTabPlatformAnchorPlatformId:o,activeTabPlatformAnchorOffsetX:a,showReadMode:document.body.classList.contains("show-read-mode"),scrollY:window.scrollY||0,searchText:document.getElementById("searchInput")?.value||""}},renderViewerFromData(e,t){let r=document.querySelector(".tab-content-area"),n=document.querySelector(".category-tabs");if(!n||!r)return;let o="";try{let h=document.getElementById("tab-knowledge"),w=h?h.querySelector(".platform-grid"):null,x=!!(w&&w.querySelector(".tr-morning-brief-card")),R=!!(w&&w.querySelector(".news-item"));x&&R&&(o=String(w.innerHTML||""))}catch{o=""}let a=l.settings.applyCategoryConfigToData(e?.categories||{});jn=a;let i=t&&typeof t.activeTab=="string"?t.activeTab:null,s=(()=>{try{return new URLSearchParams(window.location.search).get("e2e")==="1"}catch{return!1}})(),d=Object.keys(a||{}),f=d[0]||null;f==="explore"&&(f=d.find(h=>h!=="explore")||f),s&&f==="rsscol-rss"&&(f=d.find(h=>h!=="rsscol-rss")||f);let c=i||f;c==="explore"&&(c=d.find(h=>h!=="explore")||c),s&&c==="rsscol-rss"&&(c=d.find(h=>h!=="rsscol-rss")||c);let u=Object.entries(a).map(([h,w])=>{let x=b(w?.icon||""),R=b(w?.name||h),ee=`${w?.is_new?`<span class="new-badge new-badge-category" data-category="${b(h)}">NEW</span>`:""}${h==="sports"?'<span class="new-badge" id="newBadgeSportsTab" style="display:none;">NEW</span>':""}`;return`
            <div class="category-tab${String(h)===String(c)?" active":""}" data-category="${b(h)}" draggable="false" onclick="switchTab('${b(h)}')">
                <span class="category-drag-handle" title="\u62D6\u62FD\u8C03\u6574\u680F\u76EE\u987A\u5E8F" draggable="true">\u2630</span>
                <div class="category-tab-icon">${x}</div>
                <div class="category-tab-name">${R}${ee}</div>
            </div>`}).join(""),p=Object.entries(a).map(([h,w])=>{let x=!!c&&String(h)===String(c),R=x?" active":"";if(String(h)==="rsscol-rss")return`
                <div class="tab-pane${R}" id="tab-${b(h)}">
                    <div class="platform-grid" style="display:flex;flex-direction:column;gap:10px;min-height:0;">
                        
                    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
                        <div id="rssCategoryCarouselStatus" style="color:#6b7280;font-size:0.85rem;flex:1;min-width:200px;"></div>
                    </div>
                        <div id="rssCategoryCarouselGrid" style="display:flex;flex-direction:column;gap:10px;min-height:0;"></div>
                    </div>
                    <div class="category-empty-state" style="display:none;" aria-hidden="true">\u6CA1\u6709\u5339\u914D\u5185\u5BB9\uFF0C\u8BF7\u8C03\u6574\u5173\u952E\u8BCD\u6216\u5207\u6362\u6A21\u5F0F</div>
                </div>`;if(String(h)==="explore")return`
                <div class="tab-pane${R}" id="tab-${b(h)}">
                    <div class="platform-grid" id="trExploreGrid"></div>
                </div>`;if(String(h)==="knowledge"){let m=o||`
                    <div class="platform-card tr-morning-brief-card" data-platform="mb-slice-1" data-page-size="50" draggable="false">
                        <div class="platform-header">
                            <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">\u{1F552} \u6700\u65B0 1-50</div>
                            <div class="platform-header-actions"></div>
                        </div>
                        <ul class="news-list" data-mb-list="slice1">
                            <li class="news-placeholder" aria-hidden="true">\u52A0\u8F7D\u4E2D...</li>
                        </ul>
                    </div>

                    <div class="platform-card tr-morning-brief-card" data-platform="mb-slice-2" data-page-size="50" draggable="false">
                        <div class="platform-header">
                            <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">\u2B50 \u6700\u65B0 51-100</div>
                            <div class="platform-header-actions"></div>
                        </div>
                        <ul class="news-list" data-mb-list="slice2">
                            <li class="news-placeholder" aria-hidden="true">\u52A0\u8F7D\u4E2D...</li>
                        </ul>
                    </div>

                    <div class="platform-card tr-morning-brief-card" data-platform="mb-slice-3" data-page-size="50" draggable="false">
                        <div class="platform-header">
                            <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">\u{1F9FE} \u6700\u65B0 101-150</div>
                            <div class="platform-header-actions"></div>
                        </div>
                        <ul class="news-list" data-mb-list="slice3">
                            <li class="news-placeholder" aria-hidden="true">\u52A0\u8F7D\u4E2D...</li>
                        </ul>
                    </div>
                `;return`
                <div class="tab-pane${R}" id="tab-${b(h)}">
                    <div class="platform-grid" data-mb-injected="1">${m}</div>
                </div>`}let Pe=w?.platforms||{},J=Object.keys(Pe||{}),ee=x&&t?.activeTabPlatformAnchorPlatformId||null,te=ee?J.indexOf(ee):-1,We=3,gt=J.map((m,v)=>{let y=Pe?.[m];if(!y)return"";let E=b(y?.name||m),O=y?.is_new?`<span class="new-badge new-badge-platform" data-platform="${b(m)}">NEW</span>`:"",I=Array.isArray(y?.news)?y.news:[],D=I.length,re=x&&(te<0?v<3:v>=te-We&&v<=te+We),V=!re,ye=re?Math.min(D,_e):0,Y=m&&t?.pagingOffsets&&Number.isFinite(t.pagingOffsets[m])?t.pagingOffsets[m]:0,W=I.slice(0,ye),mt=V?Wn(8):W.map((H,pt)=>{let pn=b(H?.stable_id||""),Wt=b(H?.display_title||H?.title||""),hn=b(H?.url||""),Ut=b(H?.meta||""),yn=String(m||"").startsWith("rss-"),Kt=!!H?.is_cross_platform,wn=Array.isArray(H?.cross_platforms)?H.cross_platforms:[],bn=b(wn.join(", ")),Sn=b(H?.cross_platform_count??""),vn=Kt?`<span class="cross-platform-badge" title="\u540C\u65F6\u51FA\u73B0\u5728: ${bn}">\u{1F525} ${Sn}</span>`:"",Cn=Kt?"cross-platform":"",_n='<input type="checkbox" class="news-checkbox" title="\u6807\u8BB0\u5DF2\u8BFB" onchange="markAsRead(this)" />',xn=`<span class="news-index">${String(pt+1)}</span>`,En=pt<Y||pt>=Y+_e?" paged-hidden":"",Tn=Ut&&!yn?`<div class="news-subtitle">${Ut}</div>`:"",An=hn||"#",Xt=ne(H?.timestamp),Ln=Xt?`<span class="tr-news-date" style="margin-left:8px;color:#9ca3af;font-size:12px;white-space:nowrap;">${b(Xt)}</span>`:"";return`
                        <li class="news-item${En}" data-news-id="${pn}" data-news-title="${Wt}">
                            <div class="news-item-content">
                                ${_n}
                                ${xn}
                                <a class="news-title ${Cn}" href="${An}" target="_blank" rel="noopener noreferrer" onclick="handleTitleClickV2(this, event)" onauxclick="handleTitleClickV2(this, event)" oncontextmenu="handleTitleClickV2(this, event)" onkeydown="handleTitleKeydownV2(this, event)">
                                    ${Wt}
                                    ${vn}
                                </a>
                                ${Ln}
                            </div>
                            ${Tn}
                        </li>`}).join(""),Ue=Yn(h,m);return`
                <div class="platform-card" data-platform="${b(m)}" data-total-count="${String(D)}" data-loaded-count="${String(ye)}" data-lazy="${V?"1":"0"}" data-loaded-done="${V?"0":"1"}" draggable="false">
                    <div class="platform-header">
                        <span class="platform-drag-handle" title="\u62D6\u62FD\u8C03\u6574\u5E73\u53F0\u987A\u5E8F" draggable="true">\u2630</span>
                        <div class="platform-name" style="margin-bottom: 0; padding-bottom: 0; border-bottom: none; cursor: pointer;" onclick="dismissNewPlatformBadge('${b(m)}')">\u{1F4F1} ${E}${O}</div>
                        <div class="platform-header-actions">${Ue}</div>
                    </div>
                    <ul class="news-list">${mt}
                    </ul>
                    <div class="news-load-sentinel" aria-hidden="true"></div>
                </div>`}).filter(Boolean).join("");return`
            <div class="tab-pane${R}" id="tab-${b(h)}">
                <div class="platform-grid">${gt}
                </div>
                <div class="category-empty-state" style="display:none;" aria-hidden="true">\u6CA1\u6709\u5339\u914D\u5185\u5BB9\uFF0C\u8BF7\u8C03\u6574\u5173\u952E\u8BCD\u6216\u5207\u6362\u6A21\u5F0F</div>
            </div>`}).join("");n.innerHTML=u,r.innerHTML=p;try{let h=!!window.matchMedia&&window.matchMedia("(max-width: 640px)").matches,w=n.querySelectorAll(".category-tab").length;h?n.classList.remove("compact"):n.classList.toggle("compact",w>8)}catch{}let g=document.getElementById("updatedAt");g&&e?.updated_at&&(g.textContent=Ke(e.updated_at));let S=t&&typeof t.activeTab=="string"?t.activeTab:null;if(S){let h=window.CSS&&typeof window.CSS.escape=="function"?window.CSS.escape(S):S;if(document.querySelector(`.category-tab[data-category="${h}"]`))l.tabs.switchTab(S);else{let x=document.querySelector(".category-tab");x?.dataset?.category?l.tabs.switchTab(x.dataset.category):C.remove(St)}}else{let h=document.querySelector(".category-tab");h?.dataset?.category?l.tabs.switchTab(h.dataset.category):C.remove(St)}let A=typeof t?.showReadMode=="boolean"?t.showReadMode:l.readState.getShowReadModePref();l.readState.applyShowReadMode(A);let _=document.getElementById("searchInput");_&&typeof t?.searchText=="string"&&(_.value=t.searchText),l.search.searchNews(),l.filter.applyCategoryFilterForActiveTab(),l.readState.restoreReadState(),document.querySelectorAll(".platform-card").forEach(h=>{let w=h.dataset.platform,x=w&&t?.pagingOffsets&&Number.isFinite(t.pagingOffsets[w])?t.pagingOffsets[w]:0;l.paging.setCardPageSize(h,l.paging.PAGE_SIZE),l.paging.applyPagingToCard(h,x)}),l.counts.updateAllCounts(),l.readState.updateReadCount(),l.scroll.restoreActiveTabPlatformGridScroll(t),l.scroll.attachPlatformGridScrollPersistence();let P=document.getElementById("early-hide");P&&P.remove(),document.body.classList.add("categories-ready"),l.paging.scheduleAutofillActiveTab({force:!0,maxSteps:1}),mr();try{l.infiniteScroll&&typeof l.infiniteScroll.attach=="function"&&l.infiniteScroll.attach()}catch{}},async refreshViewerData(e={}){let t=e.preserveScroll!==!1;if(vt){Se?Se.preserveScroll=Se.preserveScroll&&t:Se={preserveScroll:t};return}vt=!0;try{let r=this.snapshotViewerState();r.preserveScroll=t;let o=await(await fetch("/api/news")).json();try{l.settings?.syncCacheWithServer&&o?.categories&&l.settings.syncCacheWithServer(o.categories)}catch(a){console.error("[HotNews] Cache sync failed:",a)}this.renderViewerFromData(o,r),r.preserveScroll&&(window.scrollTo({top:r.scrollY,behavior:"auto"}),l.scroll.restoreActiveTabPlatformGridScroll(r)),zn=Date.now()}catch(r){console.error("refreshViewerData error:",r)}finally{vt=!1;let r=Se;Se=null,r&&this.refreshViewerData({preserveScroll:r.preserveScroll})}},async fetchData(){let e=document.getElementById("fetchBtn"),t=document.getElementById("progressContainer"),r=document.getElementById("progressBar"),n=document.getElementById("fetchStatus");e.classList.add("loading"),e.disabled=!0,t.classList.add("show"),r.classList.add("indeterminate"),n.className="fetch-status",n.textContent="\u6B63\u5728\u83B7\u53D6\u6570\u636E...";try{let a=await(await fetch("/api/fetch",{method:"POST"})).json();r.classList.remove("indeterminate"),a.success?(r.style.width="100%",n.className="fetch-status success",n.textContent=`\u2705 ${a.platforms} \u4E2A\u5E73\u53F0\uFF0C${a.news_count} \u6761\u65B0\u95FB`,setTimeout(()=>this.refreshViewerData({preserveScroll:!0}),300)):(r.style.width="0%",n.className="fetch-status error",n.textContent=`\u274C ${a.error}`)}catch(o){r.classList.remove("indeterminate"),r.style.width="0%",n.className="fetch-status error",n.textContent=`\u274C ${o.message}`}finally{e.classList.remove("loading"),e.disabled=!1,setTimeout(()=>{t.classList.remove("show"),r.style.width="0%"},5e3)}},setupAjaxAutoRefresh(){let t=async()=>{if(document.visibilityState==="visible")try{let r=await fetch("/api/news/check-updates");if(!r.ok)return;let n=await r.json();if(n.categories)for(let[o,a]of Object.entries(n.categories))a&&this.showCategoryUpdateDot(o)}catch{}};setInterval(t,3e5),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&setTimeout(t,2e3)})},showCategoryUpdateDot(e){if(["explore","knowledge"].includes(e))return;let r=document.querySelector(`.category-tab[data-category="${e}"]`);if(!r)return;let n=r.querySelector(".update-dot");n||(n=document.createElement("span"),n.className="update-dot",r.style.position="relative",r.appendChild(n)),n.classList.add("show")},hideCategoryUpdateDot(e){let t=document.querySelector(`.category-tab[data-category="${e}"]`);if(!t)return;let r=t.querySelector(".update-dot");r&&r.classList.remove("show")}};window.fetchData=()=>tt.fetchData();window.refreshViewerData=e=>tt.refreshViewerData(e);l.data=tt;T(function(){let e=document.getElementById("updatedAt");e&&e.textContent&&(e.textContent=Ke(e.textContent)),tt.setupAjaxAutoRefresh(),gr||(gr=!0,document.addEventListener("click",t=>{let r=t?.target;if(!r||!(r instanceof Element))return;let n=r.closest('button[data-action="delete-platform"]');if(!n)return;let o=n.closest(".platform-card");o&&Zn(o).catch(()=>{})}),document.addEventListener("click",async t=>{let r=t?.target;if(!r||!(r instanceof Element))return;let n=r.closest('button[data-action="hide-platform"]');if(!n)return;let o=n.closest(".platform-card"),a=String(o?.getAttribute?.("data-platform")||"").trim();if(!(!a||a.startsWith("rss-")||!await pr("\u786E\u5B9A\u8981\u9690\u85CF\u8BE5\u5361\u7247\u5417\uFF1F\u9690\u85CF\u540E\u8BE5\u5361\u7247\u5C06\u4E0D\u518D\u663E\u793A\uFF0C\u4F60\u53EF\u4EE5\u5728\u300C\u680F\u76EE\u8BBE\u7F6E\u300D\u4E2D\u91CD\u65B0\u52FE\u9009\u5E76\u4FDD\u5B58\u6765\u6062\u590D\u663E\u793A\u3002","\u786E\u8BA4\u9690\u85CF","\u53D6\u6D88"))){try{n.setAttribute("disabled","true")}catch{}try{l.settings?.togglePlatformHidden?.(a)}catch{}}})),mr()});var rt=window.SYSTEM_SETTINGS?.display?.items_per_card||20,Qn="240px 0px 240px 0px",$=window.SYSTEM_SETTINGS?.display?.items_per_card||20;var oa=24*3600,Re=null,Ct=!1,De=0,eo=1,hr=0,to=600,nt=null,$e=null,ro=160,ot=null,Be=null,no=250;function xt(){return document.querySelector(".category-tabs .category-tab.active")?.dataset?.category||null}var oo=Math.floor(Date.now()/1e3),yr=new Set;function _t(e){e&&yr.add(e)}var so=["explore","knowledge"];function ao(e,t){let r=Number(e)||0;return!r||so.includes(t)||!yr.has(t)?!1:r>oo}function Et(e,t){try{let r=e?.querySelector?.(".news-list");if(!r)return;let n=r.querySelector(".news-placeholder");n||(n=document.createElement("li"),n.className="news-placeholder",n.setAttribute("aria-hidden","true"),r.appendChild(n)),n.textContent=String(t||"")}catch{}}function wr(){if(clearTimeout(nt),nt=null,$e){try{$e.abort()}catch{}$e=null}try{document.querySelectorAll(".platform-card").forEach(e=>{let t=e?.querySelector?.(".news-list");if(!t)return;let r=t.querySelector(".news-placeholder");!r||t.querySelectorAll(".news-item").length>0||(r.textContent||"").includes("\u52A0\u8F7D\u4E2D")&&(r.textContent="\u5F85\u52A0\u8F7D...")})}catch{}}function io(e,t={}){wr(),$e=new AbortController;let r=$e.signal;nt=setTimeout(()=>{nt=null,Cr(e,{...t,signal:r}).catch(()=>{})},ro)}function br(){if(clearTimeout(ot),ot=null,Be){try{Be.abort()}catch{}Be=null}}function Sr(e,t,r,n){let o=document.createElement("li");o.className="news-item",o.dataset.newsId=String(e?.stable_id||""),o.dataset.newsTitle=String(e?.display_title||e?.title||"");let a=document.createElement("div");a.className="news-item-content";let i=e?.published_at||e?.created_at||e?.timestamp||0;if(ao(i,n||xt())){let g=document.createElement("span");g.className="tr-new-dot",a.appendChild(g)}let s=document.createElement("input");s.type="checkbox",s.className="news-checkbox",s.title="\u6807\u8BB0\u5DF2\u8BFB",s.addEventListener("change",()=>{try{window.markAsRead(s)}catch{}});let d=document.createElement("span");d.className="news-index",d.textContent=String(t);let f=document.createElement("a");if(f.className="news-title",e?.is_cross_platform&&f.classList.add("cross-platform"),f.href=String(e?.url||"#"),f.target="_blank",f.rel="noopener noreferrer",f.setAttribute("onclick","handleTitleClickV2(this, event)"),f.setAttribute("onauxclick","handleTitleClickV2(this, event)"),f.setAttribute("oncontextmenu","handleTitleClickV2(this, event)"),f.setAttribute("onkeydown","handleTitleKeydownV2(this, event)"),f.textContent=String(e?.display_title||e?.title||""),e?.is_cross_platform){let g=Array.isArray(e?.cross_platforms)?e.cross_platforms:[],S=document.createElement("span");S.className="cross-platform-badge",S.title=`\u540C\u65F6\u51FA\u73B0\u5728: ${g.join(", ")}`,S.textContent=`\u{1F525} ${String(e?.cross_platform_count??"")}`,f.appendChild(document.createTextNode(" ")),f.appendChild(S)}a.appendChild(s),a.appendChild(d),a.appendChild(f);let c=ne(e?.timestamp);if(c){let g=document.createElement("span");g.className="tr-news-date",g.style.marginLeft="8px",g.style.color="#9ca3af",g.style.fontSize="12px",g.style.whiteSpace="nowrap",g.textContent=c,a.appendChild(g)}o.appendChild(a);let u=String(e?.meta||"").trim(),p=String(r||"").startsWith("rss-");if(u&&!p){let g=document.createElement("div");g.className="news-subtitle",g.textContent=u,o.appendChild(g)}return fo(o),co(o),o}async function vr(e,t={}){let r=document.getElementById(`tab-${e}`);if(!r||!r.classList.contains("active"))return;try{r.dataset&&(r.dataset.bulkLoading="1")}catch{}let n=t.signal;if(n?.aborted){try{r.dataset&&delete r.dataset.bulkLoading}catch{}return}let o=null;try{l.filter&&typeof l.filter.getCategoryFilterConfig=="function"&&(o=l.filter.getCategoryFilterConfig(e))}catch{o=null}let a=o?.mode||"exclude",i=Array.isArray(o?.keywords)?o.keywords:[],s=Number.isFinite(t.pageSize)?t.pageSize:$,d=Math.min(Math.max(1,s),$),f=Array.from(r.querySelectorAll(".platform-card")),c=f.map(g=>(g?.dataset?.platform||"").trim()).filter(Boolean);if(c.length<=0){try{r.dataset&&delete r.dataset.bulkLoading}catch{}return}for(let g of f)g&&(g.dataset.loading="1",Et(g,"\u52A0\u8F7D\u4E2D..."));let u;try{let g=await fetch(`/api/news/pages?page_size=${encodeURIComponent(String(d))}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform_ids:c}),signal:n});if(!g.ok)return;u=await g.json()}catch{return}finally{try{r.dataset&&delete r.dataset.bulkLoading}catch{}}let p=u&&u.platforms||{};for(let g of f){if(n?.aborted)return;let S=(g?.dataset?.platform||"").trim();if(!S)continue;let A=g.querySelector(".news-list");if(!A)continue;A.querySelectorAll(".news-placeholder").forEach(w=>w.remove()),A.querySelectorAll(".news-item").forEach(w=>w.remove());let _=p[S]||{},P=Array.isArray(_.items)?_.items:[];for(let w=0;w<P.length;w++)A.appendChild(Sr(P[w],w+1,S,e));let h=A.querySelectorAll(".news-item").length;g.dataset.loadedCount=String(h),g.dataset.hasMore=_.has_more&&h<$?"1":"0",g.dataset.loading="0",g.dataset.loadedDone="1";try{if(l.paging){let w=Math.min($,h);l.paging.setCardPageSize(g,w),l.paging.applyPagingToCard(g,0)}}catch{}l.counts?.updatePlatformCount&&l.counts.updatePlatformCount(g)}l.counts?.updateAllCounts&&l.counts.updateAllCounts();try{l.filter&&typeof l.filter.applyCategoryFilter=="function"&&l.filter.applyCategoryFilter(e)}catch{}}function lo(e,t={}){br(),Be=new AbortController;let r=Be.signal;ot=setTimeout(()=>{ot=null,vr(e,{...t,signal:r}).catch(()=>{})},no)}async function Cr(e,t={}){let r=document.getElementById(`tab-${e}`);if(!r||!r.classList.contains("active"))return;let n=t.signal;if(n?.aborted)return;let o=null;try{l.filter&&typeof l.filter.getCategoryFilterConfig=="function"&&(o=l.filter.getCategoryFilterConfig(e))}catch{o=null}let a=o?.mode||"exclude",i=Array.isArray(o?.keywords)?o.keywords:[],s=a==="include"&&i.length>0,d=Number.isFinite(t.maxPagesPerCard)?t.maxPagesPerCard:s?2:1,f=Number.isFinite(t.cap)?t.cap:s?10:4,c=Array.from(r.querySelectorAll(".platform-card")).slice(0,Math.max(0,f));for(let u of c){if(n?.aborted)return;if(!u)continue;let p=u.querySelector(".news-list");if(!p)continue;let g=p.querySelectorAll(".news-item").length;if(s&&g>0){u.dataset.loadedDone="1";continue}if(!s&&g>0){u.dataset.loadedDone="1";continue}let S=rt;for(let A=0;A<d;A++){if(n?.aborted)return;Et(u,"\u52A0\u8F7D\u4E2D..."),await _r(u,Math.min(S,$),{signal:n});try{l.paging&&(l.paging.setCardPageSize(u,Math.min(S,$)),l.paging.applyPagingToCard(u,0))}catch{}let _=u.querySelectorAll(".news-item:not(.filtered):not(.search-hidden):not(.paged-hidden)").length;if(!s||_>0||!(u.dataset.hasMore!=="0"))break;S+=rt}u.dataset.loadedDone="1"}l.counts?.updateAllCounts&&l.counts.updateAllCounts();try{l.filter&&typeof l.filter.applyCategoryFilter=="function"&&l.filter.applyCategoryFilter(e)}catch{}}function co(e){try{let t=xt();if(!t||!l.filter?.getCategoryFilterConfig)return;let r=l.filter.getCategoryFilterConfig(t),n=r?.mode||"exclude",o=Array.isArray(r?.keywords)?r.keywords:[],a=(e?.textContent||"").toLowerCase(),i=o.length>0?o.some(d=>a.includes(d)):!1;(o.length===0?!1:n==="include"?!i:i)?e.classList.add("filtered"):e.classList.remove("filtered")}catch{}}function fo(e){try{let t=e?.dataset?.newsId;if(!t||!l.readState?.getReadNews||!(l.readState.getReadNews()||{})[t])return;e.classList.add("read")}catch{}}async function _r(e,t,r={}){let n=(e?.dataset?.platform||"").trim();if(!n)return{ok:!1,hasMore:!1};let o=r.signal;if(o?.aborted)return{ok:!1,hasMore:!0};if(e.dataset.loading==="1")return{ok:!1,hasMore:!0};if(e.dataset.hasMore==="0")return{ok:!1,hasMore:!1};let a=e.querySelector(".news-list");if(!a)return{ok:!1,hasMore:!1};a.querySelectorAll(".news-placeholder").forEach(s=>s.remove()),t=Math.min(Math.max(0,t||0),$);let i=a.querySelectorAll(".news-item").length;if(i>=$)return e.dataset.hasMore="0",{ok:!1,hasMore:!1};if(i>=t)return{ok:!0,hasMore:!0};e.dataset.loading="1";try{if(De>=eo)return{ok:!1,hasMore:!0};De+=1;let s=Math.min(rt,Math.max(0,$-i));if(s<=0)return e.dataset.hasMore="0",{ok:!1,hasMore:!1};let d=`/api/news/page?platform_id=${encodeURIComponent(n)}&offset=${encodeURIComponent(String(i))}&page_size=${encodeURIComponent(String(s))}`,f;try{f=await fetch(d,{signal:o})}catch(g){if(o?.aborted||g&&g.name==="AbortError")return e.querySelectorAll(".news-item").length<=0&&Et(e,"\u5F85\u52A0\u8F7D..."),{ok:!1,hasMore:!0};throw g}if(!f.ok)return{ok:!1,hasMore:!0};let c=await f.json(),u=Array.isArray(c?.items)?c.items:[],p=!!c?.has_more;(!p||i+u.length>=$)&&(e.dataset.hasMore="0");for(let g=0;g<u.length;g++){let S=u[g]||{},A=i+g+1,_=Sr(S,A,n,xt());a.appendChild(_)}return e.dataset.loadedCount=String(a.querySelectorAll(".news-item").length),l.counts?.updatePlatformCount&&l.counts.updatePlatformCount(e),{ok:!0,hasMore:p}}finally{De=Math.max(0,De-1),e.dataset.loading="0"}}async function uo(e){if(!e||!l.paging)return;let t=e.closest(".tab-pane");if(t&&!t.classList.contains("active"))return;let r=Date.now();if(r<hr)return;hr=r+to;let n=parseInt(e.dataset.pageOffset||"0",10)||0,o=l.paging.getCardPageSize(e),a=Math.max(0,$-n);if(o>=a){e.dataset.hasMore="0";return}let i=Math.min(o+rt,a),s=n+i;await _r(e,s);let d=e.querySelectorAll(".news-item").length,f=Math.min(Math.max(o,i),Math.max(d-n,o)),c=Math.min(f,a);l.paging.setCardPageSize(e,c),l.paging.applyPagingToCard(e,n),l.counts?.updateAllCounts&&l.counts.updateAllCounts()}function xr(){if(Re){try{Re.disconnect()}catch{}Re=null}Re=new IntersectionObserver(e=>{for(let t of e){if(!t.isIntersecting||!Ct||De>0)continue;let n=t.target?.closest?.(".platform-card");n&&uo(n).catch(()=>{})}},{root:null,rootMargin:Qn,threshold:.01}),document.querySelectorAll(".news-load-sentinel").forEach(e=>Re.observe(e))}l.infiniteScroll={attach:xr,ensureCategoryLoaded:Cr,scheduleEnsureCategoryLoaded:io,cancelEnsureCategoryLoaded:wr,bulkLoadCategory:vr,scheduleBulkLoadCategory:lo,cancelBulkLoadCategory:br,markCategoryViewed:_t};T(function(){try{window.addEventListener("scroll",()=>{Ct=!0},{passive:!0,once:!0})}catch{}setTimeout(()=>{Ct=!0},1200),xr(),setTimeout(()=>{let e=document.querySelector(".category-tabs .category-tab.active");e&&e.dataset.category&&_t(e.dataset.category)},3e3),window.addEventListener("tr_tab_switched",e=>{let t=String(e?.detail?.categoryId||"").trim();t&&setTimeout(()=>_t(t),2e3)})});function go(e){return e?Array.from(e.querySelectorAll(".category-tab")).map(t=>String(t?.dataset?.category||"").trim()).filter(Boolean):[]}function mo(e){if(!Array.isArray(e)||e.length===0)return;let t=l.settings.getCategoryConfig()||l.settings.getDefaultCategoryConfig(),r=l.settings.normalizeCategoryConfig(t),n=l.settings.getMergedCategoryConfig(),o=Array.isArray(n?.categoryOrder)&&n.categoryOrder.length>0?n.categoryOrder.slice():e.slice(),a=new Set(e),i=0,s=o.map(d=>{let f=String(d||"").trim();if(!f||!a.has(f))return f;let c=e[i];return i+=1,c});r.categoryOrder=s,r.__migrated_explore_ai_front_v1=Date.now(),r.__migrated_explore_knowledge_front_v1=Date.now(),l.settings.saveCategoryConfig(r)}function po(e){let t=document.querySelector(".tab-content-area");if(!t)return;let r=new Map;t.querySelectorAll(".tab-pane").forEach(o=>{let a=String(o?.id||"");a.startsWith("tab-")&&r.set(a.slice(4),o)});let n=document.createDocumentFragment();for(let o of e){let a=r.get(o);a&&n.appendChild(a)}for(let[o,a]of r.entries())e.includes(o)||n.appendChild(a);t.appendChild(n)}function Er(){let e=document.querySelector(".category-tabs");e&&e.querySelectorAll(".category-tab").forEach(t=>{try{t.setAttribute("draggable","false");let r=t.querySelector(":scope > .category-drag-handle");r?r.setAttribute("draggable","true"):(r=document.createElement("span"),r.className="category-drag-handle",r.setAttribute("title","\u62D6\u62FD\u8C03\u6574\u680F\u76EE\u987A\u5E8F"),r.setAttribute("draggable","true"),r.textContent="\u2630",t.insertBefore(r,t.firstChild))}catch{}})}function ho(){let e=document.querySelector(".category-tabs");if(e)try{new MutationObserver(()=>{Er()}).observe(e,{childList:!0,subtree:!0})}catch{}}function yo(){let e=document.body;if(!e)return;let t=0,r=0,n=!1,o=()=>{t&&(window.clearTimeout(t),t=0),r&&(window.clearTimeout(r),r=0)},a=()=>{n=!1,e.classList.remove("category-tabs-drag-mode")};document.addEventListener("pointerdown",s=>{!s.target?.closest?.(".category-tabs")||!s.target?.closest?.(".category-tab")||s.target?.closest?.(".category-drag-handle")||(o(),t=window.setTimeout(()=>{n=!0,e.classList.add("category-tabs-drag-mode"),r=window.setTimeout(()=>{a()},2500)},380))},!0);let i=()=>{o(),n&&a()};document.addEventListener("pointerup",i,!0),document.addEventListener("pointercancel",i,!0),document.addEventListener("scroll",i,!0)}var Tr={_attached:!1,_draggingTab:null,_originTabsEl:null,attach(){this._attached||(this._attached=!0,Er(),ho(),yo(),document.addEventListener("click",e=>{e.target?.closest?.(".category-drag-handle")&&(e.preventDefault(),e.stopPropagation())},!0),document.addEventListener("dragstart",e=>{let t=e.target?.closest?.(".category-drag-handle");if(!t)return;let r=t.closest(".category-tab"),n=t.closest(".category-tabs"),o=r?.dataset?.category;if(!(!r||!n||!o)){this._draggingTab=r,this._originTabsEl=n,r.classList.add("dragging"),e.dataTransfer.effectAllowed="move";try{e.dataTransfer.setData("text/plain",String(o))}catch{}}},!0),document.addEventListener("dragover",e=>{let t=e.target?.closest?.(".category-tabs");if(!t||!this._draggingTab||this._originTabsEl&&t!==this._originTabsEl)return;let r=e.target?.closest?.(".category-tab");if(!r||r===this._draggingTab)return;e.preventDefault();let n=Array.from(t.querySelectorAll(".category-tab")),o=n.indexOf(this._draggingTab),a=n.indexOf(r);o<0||a<0||o===a||(o<a?t.insertBefore(this._draggingTab,r.nextSibling):t.insertBefore(this._draggingTab,r))},!0),document.addEventListener("drop",e=>{let t=e.target?.closest?.(".category-tabs");!t||!this._draggingTab||this._originTabsEl&&t!==this._originTabsEl||e.preventDefault()},!0),document.addEventListener("dragend",e=>{let t=e.target?.closest?.(".category-drag-handle");if(!t)return;let r=t.closest(".category-tabs");if(!r||!this._draggingTab){this._draggingTab&&this._draggingTab.classList.remove("dragging"),this._draggingTab=null,this._originTabsEl=null;return}let n=go(r);mo(n),po(n),this._draggingTab.classList.remove("dragging"),this._draggingTab=null,this._originTabsEl=null},!0))}};l.categoryTabReorder=Tr;T(()=>{Tr.attach()});var Tt="explore",wo="tr_tab_switched",bo=3,So=20;function st(){return window.SYSTEM_SETTINGS&&window.SYSTEM_SETTINGS.display&&window.SYSTEM_SETTINGS.display.items_per_card||50}var Ee=!1,xe=0,Fe=null,de=!1;function vo(){try{return document.querySelector(".category-tabs .category-tab.active")?.dataset?.category||null}catch{return null}}function Co(e){let t=Number(e||0)||0;if(!t)return"";try{let r=new Date(t*1e3),n=String(r.getFullYear()),o=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0");return`${n}-${o}-${a}`}catch{return""}}function _o(e,t={}){let r=Array.isArray(e)?e:[];return r.length?r.map((n,o)=>{let a=b(n?.stable_id||""),i=b(n?.display_title||n?.title||""),s=b(n?.url||"#"),d=Co(n?.published_at||n?.created_at),f=d?`<span class="tr-explore-time" style="margin-left:8px;color:#9ca3af;font-size:12px;">${b(d)}</span>`:"";return`
            <li class="news-item" data-news-id="${a}" data-news-title="${i}">
                <div class="news-item-content">
                    <span class="news-index">${String(o+1)}</span>
                    <a class="news-title" href="${s}" target="_blank" rel="noopener noreferrer" onclick="handleTitleClickV2(this, event)" onauxclick="handleTitleClickV2(this, event)" oncontextmenu="handleTitleClickV2(this, event)" onkeydown="handleTitleKeydownV2(this, event)">
                        ${i}
                    </a>
                    ${f}
                </div>
            </li>`}).join(""):`<li class="tr-explore-empty" aria-hidden="true">${b(t.emptyText||"\u6682\u65E0\u5185\u5BB9")}</li>`}function At(){return document.getElementById(`tab-${Tt}`)}function Lt(){let e=At();return e?e.querySelector(".platform-grid"):null}function kr(){let e=At();if(!e)return!1;let t=e.querySelector(".platform-grid");t?t.style.overscrollBehavior="contain":(t=document.createElement("div"),t.className="platform-grid",t.style.display="flex",t.style.flexDirection="row",t.style.overflowX="auto",t.style.overflowY="hidden",t.style.alignItems="flex-start",t.style.overscrollBehavior="contain",e.appendChild(t));try{t.dataset&&(t.dataset.exploreInjected="1")}catch{}return!0}async function xo(e){let t=await fetch(e,{method:"GET"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}async function Mr(e,t){let r=`/api/rss/explore/timeline?limit=${encodeURIComponent(String(e))}&offset=${encodeURIComponent(String(t))}`,n=await xo(r);return Array.isArray(n?.items)?n.items:[]}function Pr(e,t,r){if(!e||!e.length)return;let n=document.createElement("div");n.className="platform-card tr-explore-card",n.style.minWidth="360px",n.dataset.platform=`explore-slice-${t}`,n.draggable=!1;let o=st(),a=t*o+1,i=t*o+e.length;n.innerHTML=`
        <div class="platform-header">
            <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">
                \u{1F4F0} \u6700\u65B0 ${a}-${i}
            </div>
            <div class="platform-header-actions"></div>
        </div>
        <ul class="news-list" data-explore-list="slice-${t}">
            ${_o(e,{emptyText:"\u6682\u65E0\u5185\u5BB9"})}
        </ul>
    `,n.querySelectorAll(".news-index").forEach((f,c)=>{f.textContent=String(a+c)});let d=r.querySelector("#explore-load-sentinel");d?r.insertBefore(n,d):r.appendChild(n)}function Eo(e){let t=e.querySelector("#explore-load-sentinel");t&&t.remove();let r=document.createElement("div");return r.id="explore-load-sentinel",r.style.minWidth="20px",r.style.height="100%",r.style.flexShrink="0",r.innerHTML='<div style="width:20px;height:100%;display:flex;align-items:center;justify-content:center;color:#9ca3af;">\u23F3</div>',e.appendChild(r),r}function Or(){Fe&&(Fe.disconnect(),Fe=null);let e=At();if(!e)return;Fe=new IntersectionObserver(r=>{for(let n of r)n.isIntersecting&&Ar().catch(()=>{})},{root:e.querySelector(".platform-grid"),rootMargin:"200px",threshold:.01});let t=e.querySelector("#explore-load-sentinel");t&&(Fe.observe(t),setTimeout(()=>{let r=t.getBoundingClientRect(),n=e.querySelector(".platform-grid");n&&r.left<n.getBoundingClientRect().right&&Ar().catch(()=>{})},100))}async function Ar(){if(!(Ee||de)){Ee=!0;try{let e=st();if(Math.floor(xe/e)>=So){de=!0;let o=document.getElementById("explore-load-sentinel");o&&(o.innerHTML='<div style="writing-mode:vertical-rl;padding:20px;color:#9ca3af;font-size:12px;">\u5DF2\u8FBE\u5230\u6700\u5927\u663E\u793A\u6570\u91CF</div>',o.style.width="40px");return}let r=await Mr(e,xe);if(!r.length){de=!0;let o=document.getElementById("explore-load-sentinel");o&&(o.innerHTML='<div style="writing-mode:vertical-rl;padding:20px;color:#9ca3af;font-size:12px;">\u5DF2\u663E\u793A\u5168\u90E8\u5185\u5BB9</div>',o.style.width="40px");return}let n=Lt();if(n){let o=Math.floor(xe/st());Pr(r,o,n)}if(xe+=r.length,r.length<e){de=!0;let o=document.getElementById("explore-load-sentinel");o&&o.remove()}}catch(e){console.error("Explore load error:",e)}finally{Ee=!1}}}async function To(){let e=Lt();if(!e)return;xe=0,de=!1,e.innerHTML="",Eo(e);let t=st(),r=t*bo,n=await Mr(r,0);if(!n.length){e.innerHTML='<div style="padding:40px;text-align:center;color:#9ca3af;width:100%;">\u6682\u65E0\u5185\u5BB9</div>';return}for(let o=0;o<n.length;o+=t){let a=n.slice(o,o+t),i=Math.floor(o/t);Pr(a,i,e)}if(xe=n.length,n.length<r){de=!0;let o=document.getElementById("explore-load-sentinel");o&&o.remove()}else Or()}async function Ir(e=!1){if(vo()!==Tt||!kr())return!1;let t=Lt();if(!e&&t&&t.querySelectorAll(".platform-card").length>0)return Ee=!1,!0;Ee=!0;try{return await To(),!0}catch(r){return console.error("Explore refresh error:",r),!1}finally{Ee=!1}}var Lr=!1;async function Nr(){Lr||kr()&&(Lr=!0,await Ir())}function Ao(){try{window.addEventListener(wo,e=>{let t=String(e?.detail?.categoryId||"").trim(),r=!!e?.detail?.hasUpdate;t===Tt&&(de||Or(),Ir(r).catch(()=>{}))})}catch{}}function Lo(){if(l.exploreTimeline&&l.exploreTimeline._patched===!0)return;let e=l.data?.renderViewerFromData;typeof e=="function"&&(l.data.renderViewerFromData=function(r,n){e.call(l.data,r,n);try{Nr().catch(()=>{})}catch{}},l.exploreTimeline={...l.exploreTimeline||{},_patched:!0})}T(function(){Lo(),Nr().catch(()=>{}),Ao()});var qe=15,at="rsscol-rss",ko=3,kt="hotnews_rss_carousel_cursor_v1",Nt=!1,ue=!1,U=[],Mt=0,it=0,ge=!1,K=-1,k=null,Te=new Map,F=null,me=null,j=0,ct=!1,lt=!1,Rt=0,Dt=0,fe=null;function $r(){try{return window.sessionStorage}catch{return null}}function Mo(){try{let e=$r();if(!e)return null;let t=e.getItem(kt),r=Number(t);return!Number.isFinite(r)||r<0?null:Math.floor(r)}catch{return null}}function Po(e){try{let t=$r();if(!t)return;let r=Number(e);if(!Number.isFinite(r)||r<0){t.removeItem(kt);return}t.setItem(kt,String(Math.floor(r)))}catch{}}function Br(){try{return window.matchMedia&&window.matchMedia("(max-width: 640px)").matches}catch{return!1}}function Oo(e){if(!q()||!Br()||document.querySelector(".settings-modal-overlay.show")||ct)return;let t=e?.target;if(!t||!(t instanceof Element)||t.closest("a,button,input,textarea,select")||!t.closest(".rss-carousel-frame"))return;let r=e?.touches;!r||r.length!==1||(lt=!0,fe=null,Rt=Number(r[0]?.clientX||0),Dt=Number(r[0]?.clientY||0))}function Io(e){if(!lt||!q())return;let t=e?.touches;if(!t||t.length!==1)return;let r=Number(t[0]?.clientX||0),n=Number(t[0]?.clientY||0),o=r-Rt,a=n-Dt,i=Math.abs(o),s=Math.abs(a);if(!fe){if(i<10&&s<10)return;fe=i>=s?"x":"y"}try{e.preventDefault()}catch{}}function Rr(e){if(!lt||(lt=!1,!q())||!Br())return;let t=e?.changedTouches;if(!t||t.length<1)return;let r=Number(t[0]?.clientX||0),n=Number(t[0]?.clientY||0),o=r-Rt,a=n-Dt,i=Math.abs(o),s=Math.abs(a),d=44;if((fe==="x"||fe==null)&&i>=d&&i>s){o<0?Le():Ge();return}(fe==="y"||fe==null)&&s>=d&&s>i&&(a<0?Ae(-1):Ae(1))}function Fr(){try{return l.tabs?.getActiveTabId?l.tabs.getActiveTabId():null}catch{return null}}function No(e){if(!q())return;let t=async()=>{if(ue||F!=null)return;let r=[];for(let o=1;o<=ko;o+=1)r.push(e+o);let n=Math.max(...r);Number.isFinite(n)&&n>=0&&await He(n);for(let o of r)try{if(o<0)continue;await He(o);let a=U[o];if(!a)continue;await jr(a)}catch{}};try{if(typeof window.requestIdleCallback=="function"){window.requestIdleCallback(()=>t().catch(()=>{}),{timeout:1200});return}}catch{}setTimeout(()=>t().catch(()=>{}),0)}function $t(){return document.getElementById("rssCategoryPickerModal")}function Ro(){if($t())return;let e=document.createElement("div");e.id="rssCategoryPickerModal",e.className="settings-modal-overlay",e.style.zIndex="9999",e.addEventListener("click",r=>{r&&r.target===e&&Pt()}),e.innerHTML=`
        <div class="settings-modal" onclick="event.stopPropagation()" style="max-width:520px;">
            <div class="settings-modal-header">
                <span class="settings-modal-title">\u52A0\u5165\u680F\u76EE</span>
                <button class="settings-modal-close" type="button" data-action="close">&times;</button>
            </div>
            <div class="settings-modal-body" style="display:flex;flex-direction:column;gap:10px;">
                <div style="color:#6b7280;font-size:0.9rem;">\u9009\u62E9\u8981\u52A0\u5165\u7684\u680F\u76EE</div>
                <div id="rssCategoryPickerList" style="display:flex;flex-direction:column;gap:8px;"></div>
            </div>
        </div>`;let t=e.querySelector('button[data-action="close"]');t&&t.addEventListener("click",()=>Pt());try{document.body.appendChild(e)}catch{}}function Pt(){let e=$t();e&&(ct=!1,e.classList.remove("show"))}function Dr(){let e=l.settings?.getMergedCategoryConfig?l.settings.getMergedCategoryConfig():null,t=l.settings?.getDefaultCategories?l.settings.getDefaultCategories():null,r=Array.isArray(e?.categoryOrder)?e.categoryOrder:[],n=Array.isArray(e?.customCategories)?e.customCategories:[],o=[],a=new Set;for(let i of r){let s=String(i||"").trim();if(!s||a.has(s)||s==="explore"||s.startsWith("rsscol-"))continue;a.add(s);let d=n.find(p=>String(p?.id||"")===s);if(d){let p=String(d?.name||s).trim()||s;o.push({id:s,name:p,icon:"\u{1F4F1}",isCustom:!0});continue}let f=t&&t[s]?t[s]:null;if(!f)continue;let c=String(f?.name||s).trim()||s,u=String(f?.icon||"\u{1F4C1}");o.push({id:s,name:c,icon:u,isCustom:!1})}for(let i of n){let s=String(i?.id||"").trim();if(!s||a.has(s)||s==="explore"||s.startsWith("rsscol-"))continue;a.add(s);let d=String(i?.name||s).trim()||s;o.push({id:s,name:d,icon:"\u{1F4F1}",isCustom:!0})}return o}function qr(){Ro();let e=$t();if(!e)return;let t=e.querySelector("#rssCategoryPickerList");if(t){let r=Dr();t.innerHTML=r.map(n=>`
                <button type="button" class="platform-select-action-btn" data-cat-id="${b(n.id)}" style="text-align:left;">
                    ${b(n.icon)} ${b(n.name)}
                </button>`).join(""),t.querySelectorAll("button[data-cat-id]").forEach(n=>{n.addEventListener("click",async()=>{let o=String(n.getAttribute("data-cat-id")||"").trim(),i=Dr().find(d=>d.id===o),s=i||{id:o,name:o,icon:"\u{1F4C1}",isCustom:!1};Pt(),await Do(s)})})}ct=!0,e.classList.add("show");try{let r=e.querySelector(".settings-modal");r&&(r.setAttribute("tabindex","0"),r.focus())}catch{}}async function Do(e){if(!k||!k.source_id)return;let t=String(e?.id||"").trim(),r=String(e?.name||t).trim()||t||"RSS",n=!!e?.isCustom,o=String(k.source_id||"").trim(),a=o?`rss-${o}`:"",i="RSS";t&&t!=="rsscol-rss"&&!n&&(i=t);try{l.subscription?.ensureSnapshot?.()}catch{}try{l.subscription?.stageFromCatalogPreview?.({source_id:k.source_id,url:k.url,feed_title:k.feed_title||k.platform_name,column:i,entries_count:k.entries_count||0})}catch(s){B(String(s?.message||s),{variant:"error"});return}if(n&&t&&a)try{l.settings?.addPlatformToCustomCategory?.(t,a)}catch{}k.already_added=!0;try{Bt(k)}catch{}try{l.toast?.show?.(`\u5DF2\u52A0\u5165\u680F\u76EE\uFF1A${r}`,{variant:"loading",durationMs:1200})}catch{}try{l.subscription?.saveOnly?await l.subscription.saveOnly():l.subscription?.saveAndRefresh?await l.subscription.saveAndRefresh():await window.saveRssSubscriptions?.()}catch(s){B(String(s?.message||s),{variant:"error"});try{l.toast?.show?.(`\u52A0\u5165\u5931\u8D25\uFF1A${String(s?.message||s)}`,{variant:"error",durationMs:2500})}catch{}return}try{zr([k.source_id],"high").catch(()=>{})}catch{}try{l.toast?.show?.(`\u5DF2\u52A0\u5165\u680F\u76EE\uFF1A${r}`,{variant:"success",durationMs:1500})}catch{}}function q(){return Nt&&Fr()===at}function Ot(){return document.getElementById("rssCategoryCarouselGrid")}function $o(){return document.getElementById("rssCategoryCarouselStatus")}function B(e,t={}){let r=$o();if(!r)return;let n=String(t.variant||"").toLowerCase(),o=n==="error"?"#dc2626":n==="success"?"#16a34a":"#6b7280";r.style.color=o,r.textContent=e==null?"":String(e)}function Hr(e){let t=Number(e||0)||0;if(!t)return"";let r=new Date(t);if(Number.isNaN(r.getTime()))return"";let n=s=>String(s).padStart(2,"0"),o=String(r.getFullYear()),a=n(r.getMonth()+1),i=n(r.getDate());return`${o}-${a}-${i}`}function Gr(e){let t=[e?.published,e?.published_at,e?.pubDate,e?.updated,e?.updated_at,e?.date,e?.datetime,e?.date_published,e?.date_modified],n=Date.now()+365*24*60*60*1e3,o=a=>{let i=Number(a);return!Number.isFinite(i)||i<=0?0:i<1e11?Math.floor(i*1e3):Math.floor(i)};for(let a of t){if(a==null)continue;if(typeof a=="number"){let d=o(a);if(d>0&&d<=n)return d;continue}let i=String(a).trim();if(!i)continue;if(/^\d{10,13}$/.test(i)){let d=o(i);if(d>0&&d<=n)return d;continue}let s=Date.parse(i);if(!Number.isNaN(s)&&s>0)return s}return 0}async function zr(e,t="normal"){let r=Array.isArray(e)?e.map(n=>String(n||"").trim()).filter(Boolean):[];if(r.length)try{await fetch("/api/rss-sources/warmup?wait_ms=0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_ids:r,priority:t})})}catch{}}async function Bo(e,t){let r=new URLSearchParams;r.set("limit",String(e)),r.set("offset",String(t));let n=await fetch(`/api/rss-sources/search?${r.toString()}`),o=await n.json().catch(()=>({}));if(!n.ok)throw new Error(o?.detail||"Failed to load RSS sources");let a=Array.isArray(o?.sources)?o.sources:[],i=Number(o?.total||0)||0,s=Number(o?.next_offset??t+a.length)||t+a.length;return{items:a,total:i,nextOffset:s}}async function He(e){let t=Number(e);if(!Number.isFinite(t)||t<0||ge)return;let r=0;for(;U.length<=t&&!ge&&r<50;){r+=1;let n=await Bo(50,it);Mt=n.total,it=n.nextOffset;for(let o of n.items)String(o?.id||"").trim()&&U.push(o);(!n.items.length||it>=Mt)&&(ge=!0)}}async function Fo(){if(ge)return;let e=0;for(;!ge&&e<200&&(e+=1,await He(U.length),!ge););}function qo(e){return String(e?.name||e?.host||e?.id||"").trim()||"RSS"}function Ho(e){let t=e?.data||{},r=String(t?.feed?.title||"").trim(),o=(Array.isArray(t?.entries)?t.entries:[]).map(a=>{let i=String(a?.title||"").trim(),s=String(a?.link||"").trim(),d=Gr(a);return{title:i||s,link:s,ts:d}}).filter(a=>!!a.link);return{feedTitle:r,entries:o}}function Go(){let e=l.subscription?.getSubscriptions?l.subscription.getSubscriptions():[],t=new Set;for(let r of Array.isArray(e)?e:[]){let n=String(r?.source_id||r?.rss_source_id||"").trim();n&&t.add(n)}return t}async function jr(e){let t=String(e?.id||"").trim();if(!t)return null;if(Te.has(t))return Te.get(t);let r=String(e?.url||"").trim(),n=qo(e),o=Go(),a=[],i="",s=null;try{let p=await fetch(`/api/rss-sources/preview?source_id=${encodeURIComponent(t)}`);if(s=await p.json().catch(()=>({})),!p.ok)throw new Error(s?.detail||"Preview failed");let g=Ho(s);i=g.feedTitle,a=g.entries}catch(p){let g={source_id:t,error:String(p?.message||p)};return Te.set(t,g),g}if(!Array.isArray(a)||a.length<=0){let p={source_id:t,error:"No entries"};return Te.set(t,p),p}let d=0;for(let p of a){let g=Number(p?.ts||0)||0;g>d&&(d=g)}if(!d&&s){let p=Gr({published:s?.last_modified||s?.data?.feed?.updated||s?.data?.feed?.published||s?.data?.feed?.lastBuildDate});p>d&&(d=p)}let f=Hr(d),u={source_id:t,url:r,feed_title:i||n,platform_name:i||n,entries:a,entries_count:a.length,date_str:f,error:"",already_added:o.has(t)};return Te.set(t,u),u}function Bt(e){let t=Ot();if(!t)return;let r=e,n=String(r?.source_id||"").trim(),o=b(r?.platform_name||"RSS"),a=r?.already_added?"\u5DF2\u52A0\u5165":"\u52A0\u5165\u680F\u76EE",i=r?.already_added?"disabled":"",s=Array.isArray(r?.entries)?r.entries:[],d=Math.max(0,Math.ceil(s.length/qe)-1);j>d&&(j=d),j<0&&(j=0);let f=j*qe,c=s.slice(f,f+qe),u=c.map((A,_)=>{let P=b(A?.title||""),h=b(A?.link||"#"),w=b(Hr(A?.ts||0));return`
            <li class="news-item" data-news-id="" data-news-title="${P}">
                <div class="news-item-content">
                    <span class="news-index">${String(f+_+1)}</span>
                    <a class="news-title tr-news-title-lg tr-title-hover-accent tr-hover-glass tr-title-hover-wave" href="${h}" target="_blank" rel="noopener noreferrer">${P}</a>
                    <span class="rss-entry-date" style="flex:0 0 auto;margin-left:8px;color:#6b7280;font-size:0.75rem;white-space:nowrap;${w?"":"display:none;"}">${w}</span>
                </div>
            </li>`}).join(""),p=Math.max(0,qe-c.length),g=p?Array.from({length:p}).map((A,_)=>{let P=f+c.length+_+1;return`
            <li class="news-item rss-entry-placeholder" data-news-id="">
                <div class="news-item-content">
                    <span class="news-index">${String(P)}</span>
                    <span class="news-title tr-news-title-lg tr-hover-glass">&nbsp;</span>
                    <span class="rss-entry-date" style="display:none;">&nbsp;</span>
                </div>
            </li>`}).join(""):"";t.innerHTML=`
        <div class="rss-carousel-frame" style="margin:0 auto;max-width:980px;width:min(980px,100%);box-sizing:border-box;position:relative;padding:52px 56px;">
            <div class="rss-carousel-nav-hints" style="position:absolute;inset:0;pointer-events:none;">
                <div class="rss-nav-hint rss-nav-left" aria-hidden="true" style="position:absolute;left:8px;top:50%;transform:translateY(-50%);width:40px;height:40px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.65);backdrop-filter:blur(6px);color:#374151;font-weight:900;box-shadow:0 6px 20px rgba(0,0,0,0.08);opacity:0.45;display:flex;align-items:center;justify-content:center;">\u2039</div>
                <div class="rss-nav-hint rss-nav-right" aria-hidden="true" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);width:40px;height:40px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.65);backdrop-filter:blur(6px);color:#374151;font-weight:900;box-shadow:0 6px 20px rgba(0,0,0,0.08);opacity:0.45;display:flex;align-items:center;justify-content:center;">\u203A</div>
                <div class="rss-nav-hint rss-nav-up" aria-hidden="true" style="position:absolute;left:50%;top:8px;transform:translateX(-50%);width:40px;height:40px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.65);backdrop-filter:blur(6px);color:#374151;font-weight:900;box-shadow:0 6px 20px rgba(0,0,0,0.08);opacity:0.45;display:flex;align-items:center;justify-content:center;">\u02C4</div>
                <div class="rss-nav-hint rss-nav-down" aria-hidden="true" style="position:absolute;left:50%;bottom:8px;transform:translateX(-50%);width:40px;height:40px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.65);backdrop-filter:blur(6px);color:#374151;font-weight:900;box-shadow:0 6px 20px rgba(0,0,0,0.08);opacity:0.45;display:flex;align-items:center;justify-content:center;">\u02C5</div>
            </div>
            <div class="platform-card" data-rss-source-id="${b(n)}" style="margin:0 auto;max-width:980px;width:100%;box-sizing:border-box;">
                <div class="platform-header">
                    <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;flex:1;min-width:0;white-space:nowrap;overflow:hidden;">
                        <div class="rss-preview-title-row" style="display:flex;align-items:baseline;gap:12px;min-width:0;">
                            <span class="rss-preview-title-text tr-title-compact tr-title-ellipsis tr-title-hover-accent" style="flex:1;min-width:0;">\u{1F4F1} ${o}</span>
                        </div>
                    </div>
                    <div class="platform-header-actions">
                        <button type="button" class="platform-select-action-btn" data-action="add" ${i}>${a}</button>
                    </div>
                </div>
                <ul class="news-list">${u}${g}</ul>
            </div>
        </div>`;try{window.requestAnimationFrame(()=>{t.querySelectorAll(".news-title").forEach(_=>{_ instanceof HTMLElement&&(_.closest(".rss-entry-placeholder")||(_.classList.remove("tr-title-overflow-shrink"),_.scrollWidth>_.clientWidth+1&&_.classList.add("tr-title-overflow-shrink")))})})}catch{}let S=t.querySelector('button[data-action="add"]');S&&S.addEventListener("click",()=>{k&&(ct||k.already_added||(B("",{variant:"info"}),qr()))})}async function dt(e,t=1){if(!ue){ue=!0,me=Number(e);try{if(await He(e),U.length<=0){let i=Ot();i&&(i.innerHTML='<div style="color:#6b7280;">\u6682\u65E0\u53EF\u9884\u89C8\u6E90</div>'),B("",{variant:"info"});return}let r=e,n=t>=0?1:-1,o=0;for(;o<200;){o+=1,r<0&&(await Fo(),r=U.length-1),await He(r),r>=U.length&&(r=0);let i=U[r];if(!i){r+=n;continue}let s=await jr(i);if(!s||s.error){r+=n;continue}K=r,Po(K),k=s,j=0,Bt(s),B("",{variant:"info"});try{zr([s.source_id],"normal").catch(()=>{})}catch{}try{No(r)}catch{}return}let a=Ot();a&&(a.innerHTML='<div style="color:#6b7280;">\u6682\u65E0\u53EF\u9884\u89C8\u6E90</div>'),B("",{variant:"info"})}catch(r){B(String(r?.message||r),{variant:"error"})}finally{if(ue=!1,me=null,q()&&F!=null){let r=Number(F);F=null;let n=Number.isFinite(K)?K:0,o=r>=n?1:-1;dt(r,o).catch(a=>B(String(a?.message||a),{variant:"error"}))}}}}function Le(){if(!q())return;if(ue){F=(F!=null?Number(F):me!=null?Number(me):K)+1;return}let e=K+1;dt(e,1).catch(t=>B(String(t?.message||t),{variant:"error"}))}function Ge(){if(!q())return;if(ue){F=(F!=null?Number(F):me!=null?Number(me):K)-1;return}let e=K-1;dt(e,-1).catch(t=>B(String(t?.message||t),{variant:"error"}))}function zo(){ue=!1,F=null,me=null,U=[],Mt=0,it=0,ge=!1,K=-1,k=null,Te=new Map,j=0}function Ae(e){if(!q()||!k)return;let t=Array.isArray(k?.entries)?k.entries:[],r=Math.max(0,Math.ceil(t.length/qe)-1),n=Math.max(0,Math.min(r,j+e));n!==j&&(j=n,Bt(k))}function It(){Nt=!0;try{l.subscription?.ensureSnapshot?.()}catch{}zo();let e=Mo();dt(e??0,1).catch(r=>B(String(r?.message||r),{variant:"error"}))}function Vr(){Nt=!1}window.rssCategoryCarouselNext=()=>Le();window.rssCategoryCarouselPrev=()=>Ge();window.rssCategoryCarouselAddToCategory=()=>{q()&&k&&(k.already_added||qr())};l.rssCategoryCarousel={open:It,close:Vr,next:Le,prev:Ge};T(function(){try{let e=l.tabs?.switchTab;typeof e=="function"&&(l.tabs.switchTab=function(t){e.call(l.tabs,t);try{String(t)===at?It():Vr()}catch{}})}catch{}document.addEventListener("keydown",e=>{if(!q()||document.querySelector(".settings-modal-overlay.show"))return;let t=e?.target;if(!(t&&t instanceof Element&&t.closest("input,textarea,select"))){if(e.key===" "||e.key==="Spacebar"||e.code==="Space"){e.preventDefault(),Le();return}if(e.key==="ArrowUp"){e.preventDefault(),Ae(-1);return}if(e.key==="ArrowDown"){e.preventDefault(),Ae(1);return}if(e.key==="ArrowRight"){e.preventDefault(),Le();return}if(e.key==="ArrowLeft"){e.preventDefault(),Ge();return}}}),document.addEventListener("click",e=>{if(!q()||document.querySelector(".settings-modal-overlay.show"))return;let t=e?.target;if(!t||!(t instanceof Element)||t.closest("a,button,input,textarea,select"))return;let r=document.getElementById(`tab-${at}`);if(!r)return;let n=Number(e?.clientX||0),o=Number(e?.clientY||0),a=r.querySelector("#rssCategoryCarouselGrid .platform-card");if(!a)return;let i=a.getBoundingClientRect(),s=140,d=i.left-s,f=i.right+s,c=i.top-s,u=i.bottom+s;if(!(n<d||n>f||o<c||o>u)&&!(n>=i.left&&n<=i.right&&o>=i.top&&o<=i.bottom)){if(o<i.top){Ae(-1);return}if(o>i.bottom){Ae(1);return}if(n<i.left){Ge();return}if(n>i.right){Le();return}}}),document.addEventListener("touchstart",Oo,{passive:!0}),document.addEventListener("touchmove",Io,{passive:!1}),document.addEventListener("touchend",Rr,{passive:!0}),document.addEventListener("touchcancel",Rr,{passive:!0});try{Fr()===at&&It()}catch{}});function pe(e){let t=e;return t?t.nodeType===3?t.parentElement||null:t:null}function ke(e){if(!e)return!1;let t=e.scrollWidth||0,r=e.clientWidth||0;return t>r+1}function Yr(e){return pe(e)?.closest?.(".platform-card")?.closest?.(".platform-grid")||null}function Ft(e){let t=pe(e);return!t?.closest||t.closest(".platform-drag-handle")?!1:!!t.closest(".platform-header")||!!t.closest(".platform-name")}T(()=>{let t=null,r=!1,n=null,o=0,a=0,i=!1,s=0,d=null,f=0,c=0,u=0,p=.92,g=.5;function S(){d&&(cancelAnimationFrame(d),d=null),f=0}function A(m){if(!m)return null;let v=Array.from(m.querySelectorAll(".platform-card"));if(v.length===0)return null;let E=m.getBoundingClientRect().left,O=m.scrollLeft||0,I=null,D=1/0;for(let V of v){let Y=V.getBoundingClientRect().left,W=Math.abs(Y-E);W<D&&(D=W,I=V)}return I?I.offsetLeft||0:null}function _(m){if(!m)return;let v=A(m);if(v===null)return;let y=Math.max(0,(m.scrollWidth||0)-(m.clientWidth||0)),E=Math.max(0,Math.min(y,v));m.scrollTo({left:E,behavior:"smooth"})}function P(m,v){if(!m||!ke(m))return;S(),f=v;function y(){if(Math.abs(f)<g){S(),setTimeout(()=>_(m),100);return}f*=p;let E=Math.max(0,(m.scrollWidth||0)-(m.clientWidth||0)),O=m.scrollLeft||0,I=Math.max(0,Math.min(E,O+f));if(m.scrollLeft=I,I<=0||I>=E){S(),setTimeout(()=>_(m),100);return}d=requestAnimationFrame(y)}d=requestAnimationFrame(y)}let h=!1,w=null,x=0,R=null;function Pe(){if(h=!1,!w||!ke(w)){x=0;return}let m=x;if(x=0,!m)return;let v=Math.max(0,(w.scrollWidth||0)-(w.clientWidth||0)),y=w.scrollLeft||0,E=Math.max(0,Math.min(v,y+m));w.scrollLeft=E,R&&clearTimeout(R),R=setTimeout(()=>{R=null,_(w)},150)}let J=()=>{let v=performance.now()-c,y=0;i&&n&&v>0&&v<100&&(y=-(u-o)/(v/16),y=Math.max(-50,Math.min(50,y)));let E=n;t=null,r=!1,n=null,o=0,a=0,i=!1,c=0,u=0;try{document.body.classList.remove("tr-platform-title-dragging")}catch{}E&&Math.abs(y)>2&&P(E,y)},ee=(m,v,y=!1)=>{if(y){let O=pe(m)?.closest?.(".platform-card");if(!O)return!1;let I=O.closest(".platform-grid");if(!I||!ke(I))return!1;S(),n=I,o=v,a=I.scrollLeft||0,i=!1,c=performance.now(),u=v;try{document.body.classList.add("tr-platform-title-dragging")}catch{}return!0}if(!Ft(m)||document.querySelector(".platform-card.dragging"))return!1;let E=Yr(m);if(!E||!ke(E))return!1;S(),n=E,o=v,a=E.scrollLeft||0,i=!1,c=performance.now(),u=v;try{document.body.classList.add("tr-platform-title-dragging")}catch{}return!0};document.addEventListener("pointerdown",m=>{if(m.button!==0&&m.button!==1)return;let v=pe(m.target),y=m.button===1;if(ee(v,m.clientX,y)&&(t=m.pointerId,y))try{m.preventDefault()}catch{}},{passive:!1}),document.addEventListener("mousedown",m=>{if(m.button!==0&&m.button!==1||t!==null)return;let v=pe(m.target),y=m.button===1;if(ee(v,m.clientX,y)&&(r=!0,y))try{m.preventDefault()}catch{}},{passive:!1}),document.addEventListener("pointermove",m=>{if(t===null||m.pointerId!==t||!n)return;if(document.querySelector(".platform-card.dragging")){J();return}let v=m.clientX-o;if(!i&&Math.abs(v)<4)return;i=!0;try{m.preventDefault()}catch{}c=performance.now(),u=m.clientX;let y=Math.max(0,(n.scrollWidth||0)-(n.clientWidth||0)),E=Math.max(0,Math.min(y,a-v));n.scrollLeft=E},{passive:!1}),document.addEventListener("mousemove",m=>{if(!r||!n)return;if(document.querySelector(".platform-card.dragging")){J();return}let v=m.clientX-o;if(!i&&Math.abs(v)<4)return;i=!0;try{m.preventDefault()}catch{}c=performance.now(),u=m.clientX;let y=Math.max(0,(n.scrollWidth||0)-(n.clientWidth||0)),E=Math.max(0,Math.min(y,a-v));n.scrollLeft=E},{passive:!1});let te=()=>{t!==null&&(i&&(s=Date.now()+600),J())};document.addEventListener("pointerup",te,{passive:!0}),document.addEventListener("pointercancel",te,{passive:!0}),document.addEventListener("mouseup",()=>{r&&(i&&(s=Date.now()+600),J())},{passive:!0}),document.addEventListener("click",m=>{if(Date.now()>s)return;let y=pe(m.target);if(Ft(y)){try{m.preventDefault()}catch{}try{m.stopPropagation()}catch{}try{m.stopImmediatePropagation()}catch{}}},!0),document.addEventListener("wheel",m=>{let v=typeof document.elementFromPoint=="function"?document.elementFromPoint(m.clientX,m.clientY):null,y=pe(v||m.target);if(!m.shiftKey||!Ft(y)||document.querySelector(".platform-card.dragging"))return;let E=Yr(y);if(!E||!ke(E))return;S();let O=typeof m.deltaX=="number"&&m.deltaX!==0?m.deltaX:m.deltaY;if(m.deltaMode===1?O*=20:m.deltaMode===2&&(O*=E.clientWidth||100),!!O){try{m.preventDefault()}catch{}w=E,x+=O,h||(h=!0,requestAnimationFrame(Pe))}},{passive:!1});function We(m,v){if(!m)return;let y=Array.from(m.querySelectorAll(".platform-card"));if(y.length===0)return;let O=m.getBoundingClientRect().left,I=m.scrollLeft||0,D=0,re=1/0;y.forEach((Y,W)=>{let mt=Y.getBoundingClientRect(),Ue=Math.abs(mt.left-O);Ue<re&&(re=Ue,D=W)});let V=Math.max(0,Math.min(y.length-1,D+v));if(V===D&&re<10){let Y=Math.max(0,Math.min(y.length-1,D+v));if(Y!==D){let W=y[Y];W&&(S(),m.scrollTo({left:W.offsetLeft||0,behavior:"smooth"}))}return}let ye=y[V];ye&&(S(),m.scrollTo({left:ye.offsetLeft||0,behavior:"smooth"}))}function gt(){let m=document.querySelector(".tab-pane.active");if(!m||(m.id||"")==="tab-rsscol-rss")return null;let y=m.querySelector(".platform-grid");return!y||!ke(y)?null:y}document.addEventListener("keydown",m=>{let v=m.target;if(v&&v instanceof Element&&v.closest("input,textarea,select")||document.querySelector(".settings-modal-overlay.show")||document.getElementById("rssCatalogPreviewModal")?.classList.contains("show")||m.key!=="ArrowLeft"&&m.key!=="ArrowRight")return;let y=gt();y&&(m.preventDefault(),We(y,m.key==="ArrowRight"?1:-1))})});var Ht="knowledge";var ga=2*3600,jo="tr_tab_switched",Vo=3e5,Yo=10,Wo=20;var ma=24*3600;function je(){return window.SYSTEM_SETTINGS&&window.SYSTEM_SETTINGS.display&&window.SYSTEM_SETTINGS.display.morning_brief_items||50}var Ve=!1,qt=0,Wr=null,Me=0,ze=null,he=!1;function Uo(){try{return document.querySelector(".category-tabs .category-tab.active")?.dataset?.category||null}catch{return null}}var pa=Math.floor(Date.now()/1e3);function Ko(e){return!1}function Xo(e){try{l.paging?.setCardPageSize?.(e,50),l.paging?.applyPagingToCard?.(e,0)}catch{}}function Jo(e){let t=Number(e||0)||0;if(!t)return"";try{let r=new Date(t*1e3),n=String(r.getFullYear()),o=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0");return`${n}-${o}-${a}`}catch{return""}}function Zo(e,t={}){let r=Array.isArray(e)?e:[];return r.length?r.map((n,o)=>{let a=b(n?.stable_id||""),i=b(n?.display_title||n?.title||""),s=b(n?.url||"#"),d=Jo(n?.published_at||n?.created_at),f=d?`<span class="tr-mb-time" style="margin-left:8px;color:#9ca3af;font-size:12px;">${b(d)}</span>`:"",c=n?.published_at||n?.created_at||0,u=Ko(c)?'<span class="tr-new-dot"></span>':"";return`
            <li class="news-item" data-news-id="${a}" data-news-title="${i}">
                <div class="news-item-content">
                    ${u}
                    <span class="news-index">${String(o+1)}</span>
                    <a class="news-title" href="${s}" target="_blank" rel="noopener noreferrer" onclick="handleTitleClickV2(this, event)" onauxclick="handleTitleClickV2(this, event)" oncontextmenu="handleTitleClickV2(this, event)" onkeydown="handleTitleKeydownV2(this, event)">
                        ${i}
                    </a>
                    ${f}
                </div>
            </li>`}).join(""):`<li class="tr-mb-empty" aria-hidden="true">${b(t.emptyText||"\u6682\u65E0\u5185\u5BB9")}</li>`}function ft(){return document.getElementById(`tab-${Ht}`)}function Ur(){let e=ft();return e?e.querySelector(".platform-grid"):null}function Kr(){let e=ft();if(!e)return!1;let t=e.querySelector(".platform-grid");t?t.style.overscrollBehavior="contain":(t=document.createElement("div"),t.className="platform-grid",t.style.display="flex",t.style.flexDirection="row",t.style.overflowX="auto",t.style.overflowY="hidden",t.style.alignItems="flex-start",t.style.overscrollBehavior="contain",e.appendChild(t));try{t.dataset&&(t.dataset.mbInjected="1")}catch{}return!0}async function Qo(e){let t=await fetch(e,{method:"GET"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return await t.json()}async function Xr(e,t){let r=`/api/rss/brief/timeline?limit=${encodeURIComponent(String(e))}&offset=${encodeURIComponent(String(t))}&drop_published_at_zero=0`,n=await Qo(r);return Array.isArray(n?.items)?n.items:[]}function Jr(e,t,r){if(!e||!e.length)return;let n=document.createElement("div");n.className="platform-card tr-morning-brief-card",n.style.minWidth="360px",n.dataset.platform=`mb-slice-${t}`,n.draggable=!1;let o=je(),a=t*o+1,i=t*o+e.length;n.innerHTML=`
        <div class="platform-header">
            <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">
                \u{1F552} \u6700\u65B0 ${a}-${i}
            </div>
            <div class="platform-header-actions"></div>
        </div>
        <ul class="news-list" data-mb-list="slice-${t}">
            ${Zo(e,{emptyText:"\u6682\u65E0\u5185\u5BB9"})}
        </ul>
    `,n.querySelectorAll(".news-index").forEach((f,c)=>{f.textContent=String(a+c)});let d=r.querySelector("#mb-load-sentinel");d?r.insertBefore(n,d):r.appendChild(n),Xo(n)}function es(e){let t=e.querySelector("#mb-load-sentinel");t&&t.remove();let r=document.createElement("div");return r.id="mb-load-sentinel",r.style.minWidth="20px",r.style.height="100%",r.style.flexShrink="0",r.innerHTML='<div style="width:20px;height:100%;display:flex;align-items:center;justify-content:center;color:#9ca3af;">\u23F3</div>',e.appendChild(r),r}function Zr(){ze&&(ze.disconnect(),ze=null);let e=ft();if(!e)return;ze=new IntersectionObserver(r=>{for(let n of r)n.isIntersecting&&ts().catch(()=>{})},{root:e.querySelector(".platform-grid"),rootMargin:"200px",threshold:.01});let t=e.querySelector("#mb-load-sentinel");t&&ze.observe(t)}async function ts(){if(Ve||he)return;if(Math.floor(Me/je())>=Wo){he=!0;let t=document.getElementById("mb-load-sentinel");t&&(t.innerHTML='<div style="writing-mode:vertical-rl;padding:20px;color:#9ca3af;font-size:12px;">\u5DF2\u8FBE\u5230\u6700\u5927\u663E\u793A\u6570\u91CF</div>',t.style.width="40px");return}Ve=!0;try{let t=je(),r=await Xr(t,Me);if(!r.length){he=!0;let o=document.getElementById("mb-load-sentinel");o&&(o.innerHTML='<div style="writing-mode:vertical-rl;padding:20px;color:#9ca3af;font-size:12px;">\u5DF2\u663E\u793A\u5168\u90E8\u5185\u5BB9</div>',o.style.width="40px");return}let n=Ur();if(n){let o=Math.floor(Me/je());Jr(r,o,n)}if(Me+=r.length,r.length<t){he=!0;let o=document.getElementById("mb-load-sentinel");o&&o.remove()}}catch{}finally{Ve=!1}}async function rs(){let e=Ur();if(!e)return;Me=0,he=!1,e.innerHTML="",es(e);let t=je(),r=t*Yo,n=await Xr(r,0);if(!n.length){e.innerHTML='<div style="padding:40px;text-align:center;color:#9ca3af;width:100%;">\u6682\u65E0\u5185\u5BB9</div>';return}for(let o=0;o<n.length;o+=t){let a=n.slice(o,o+t),i=Math.floor(o/t);Jr(a,i,e)}if(Me=n.length,n.length<r){he=!0;let o=document.getElementById("mb-load-sentinel");o&&o.remove()}else Zr()}async function Gt(e={}){let t=e.force===!0;if(Uo()!==Ht)return!1;let r=Date.now();if(!t&&qt>0&&r-qt<Vo-5e3||!Kr())return!1;Ve=!0;try{return await rs(),qt=Date.now(),!0}catch{return!1}finally{Ve=!1}}function ns(){let e=ft();if(e&&!(e.dataset&&e.dataset.mbBound==="1")){e.addEventListener("click",t=>{let r=t.target;if(!r||!(r instanceof Element))return;r.closest('[data-action="mb-refresh"]')&&(t.preventDefault(),Gt({force:!0}).catch(()=>{try{l.toast?.show("\u5237\u65B0\u5931\u8D25",{variant:"error",durationMs:2e3})}catch{}}))});try{e.dataset&&(e.dataset.mbBound="1")}catch{}}}async function Qr(){Kr()&&(ns(),await Gt({force:!1}))}function os(){try{window.addEventListener(jo,e=>{String(e?.detail?.categoryId||"").trim()===Ht&&(he||Zr(),clearTimeout(Wr),Wr=setTimeout(()=>{Gt({force:!1}).catch(()=>{})},120))})}catch{}}function ss(){if(l.morningBrief&&l.morningBrief._patched===!0)return;let e=l.data?.renderViewerFromData;typeof e=="function"&&(l.data.renderViewerFromData=function(r,n){e.call(l.data,r,n);try{Qr().catch(()=>{})}catch{}},l.morningBrief={...l.morningBrief||{},_patched:!0})}T(function(){ss(),Qr().catch(()=>{}),os()});var en=Math.floor(Date.now()/1e3),tn=new Set;function as(e,t){let r=Number(e)||0;return!r||!tn.has(t)?!1:r>en}function zt(e){e&&tn.add(e)}function is(){return en}async function rn(e,t,r,n,o){try{await fetch("/api/news/click",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({news_id:e,url:t,title:r,source_name:n||"",category:o||""})})}catch{}}function nn(e,t){if(!e)return;let r=e.querySelector(".tr-new-dot");r&&r.remove();let n=e.dataset.newsId||"",o=e.dataset.newsTitle||"",a=e.querySelector(".news-title"),i=a?a.href:"",s=e.closest(".platform-card")?.querySelector(".platform-name")?.textContent?.trim()||"";n&&rn(n,i,o,s,t)}function ls(){document.addEventListener("click",e=>{let t=e.target.closest(".news-title");if(!t)return;let r=t.closest(".news-item");if(!r)return;let n=r.closest(".tab-pane"),o=n?.id?.startsWith("tab-")?n.id.slice(4):"";nn(r,o)})}function cs(){window.addEventListener("tr_tab_switched",e=>{let t=String(e?.detail?.categoryId||"").trim();t&&setTimeout(()=>{zt(t)},2e3)})}l.clickTracker={getSessionStartTime:is,markCategoryViewed:zt,isNewContent:as,reportClick:rn,handleNewsClick:nn};T(function(){ls(),cs(),setTimeout(()=>{let e=document.querySelector(".tab-pane.active");e&&e.id?.startsWith("tab-")&&zt(e.id.slice(4))},3e3)});async function on(){console.log("[Auth] renderUserMenu called");let e=document.querySelector(".header-right");if(!e){console.error("[Auth] .header-right not found");return}if(console.log("[Auth] .header-right found:",e),document.getElementById("userMenu")){console.log("[Auth] userMenu already exists, skipping");return}try{console.log("[Auth] Fetching /api/auth/me...");let t=await fetch("/api/auth/me");if(t.status===404){console.log("[Auth] Auth API not available (404), skipping user menu");return}if(t.status===500){console.error("[Auth] Server error (500), skipping user menu");return}let r;try{r=await t.json()}catch(o){console.error("[Auth] Failed to parse JSON response:",o);return}console.log("[Auth] API response:",r);let n=document.createElement("div");if(n.id="userMenu",n.className="user-menu",r.ok&&r.user){let o=r.user.nickname||r.user.email||"Me",a=o[0].toUpperCase();if(n.innerHTML=`
                <div class="user-avatar" onclick="toggleUserDropdown()" title="${o}">
                    ${a}
                </div>
                <div class="user-dropdown" id="userDropdown">
                    <div class="dropdown-item user-info-item">${o}</div>
                    <div class="dropdown-divider"></div>
                    <a href="/api/user/preferences/page" class="dropdown-item">\u2699\uFE0F \u6211\u7684\u8BBE\u7F6E</a>
                    <div class="dropdown-item" onclick="logoutUser()">\u{1F6AA} \u9000\u51FA\u767B\u5F55</div>
                </div>
            `,!document.getElementById("user-menu-styles")){let i=document.createElement("style");i.id="user-menu-styles",i.textContent=`
                    .user-menu { position: relative; margin-left: 10px; }
                    .user-avatar {
                        width: 32px; height: 32px; border-radius: 50%;
                        background: #3B82F6; color: white;
                        display: flex; align-items: center; justify-content: center;
                        font-weight: bold; cursor: pointer; user-select: none;
                        font-size: 14px;
                    }
                    .user-dropdown {
                        display: none; position: absolute; right: 0; top: 40px;
                        background: #1E293B; border: 1px solid #334155;
                        border-radius: 8px; width: 160px; z-index: 1000;
                        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
                    }
                    .user-dropdown.show { display: block; }
                    .dropdown-item {
                        padding: 10px 16px; cursor: pointer; color: #F1F5F9;
                        text-decoration: none; display: block; font-size: 14px;
                    }
                    .dropdown-item:hover { background: #334155; }
                    .user-info-item { color: #94A3B8; font-size: 12px; cursor: default; }
                    .user-info-item:hover { background: transparent; }
                    .dropdown-divider { height: 1px; background: #334155; margin: 4px 0; }
                `,document.head.appendChild(i)}document.addEventListener("click",i=>{i.target.closest(".user-menu")||document.getElementById("userDropdown")?.classList.remove("show")})}else if(n.innerHTML=`
                <a href="/api/auth/page" class="login-btn">\u767B\u5F55 / \u6CE8\u518C</a>
            `,!document.getElementById("user-login-styles")){let o=document.createElement("style");o.id="user-login-styles",o.textContent=`
                    .login-btn {
                        background: #3B82F6; color: white; padding: 6px 12px;
                        border-radius: 6px; text-decoration: none; font-size: 14px;
                        margin-left: 10px; transition: background 0.2s;
                    }
                    .login-btn:hover { background: #2563EB; }
                `,document.head.appendChild(o)}e.appendChild(n),console.log("[Auth] User menu rendered successfully, logged in:",r.ok&&r.user)}catch(t){console.error("Failed to render user menu:",t)}}function sn(){let e=document.getElementById("userDropdown");e&&e.classList.toggle("show")}async function an(){try{await fetch("/api/auth/logout",{method:"POST"}),window.location.reload()}catch{alert("\u9000\u51FA\u5931\u8D25")}}window.toggleUserDropdown=sn;window.logoutUser=an;window.renderUserMenu=on;l.auth={renderUserMenu:on,toggleUserDropdown:sn,logoutUser:an};var ds="my-tags",Ye="hotnews_my_tags_cache",fs=5*60*1e3,ut=!1,X=!1;async function us(){try{let e=await fetch("/api/auth/me");if(!e.ok)return null;let t=await e.json();return t.ok&&t.user?t.user:null}catch(e){return console.error("[MyTags] Auth check failed:",e),null}}function gs(){try{let e=localStorage.getItem(Ye);if(!e)return null;let t=JSON.parse(e),r=Date.now();return!t.timestamp||r-t.timestamp>fs?(localStorage.removeItem(Ye),null):t.tags}catch(e){return console.error("[MyTags] Cache read error:",e),localStorage.removeItem(Ye),null}}function dn(e){try{let t={tags:e,timestamp:Date.now()};localStorage.setItem(Ye,JSON.stringify(t))}catch(t){console.error("[MyTags] Cache write error:",t)}}function ms(){try{localStorage.removeItem(Ye),console.log("[MyTags] Cache cleared")}catch(e){console.error("[MyTags] Cache clear error:",e)}}async function fn(){try{let e=await fetch("/api/user/preferences/followed-news?limit=50");if(!e.ok){if(e.status===401)return{needsAuth:!0};throw new Error("Failed to fetch")}return await e.json()}catch(e){return console.error("[MyTags] Fetch failed:",e),{error:e.message}}}function ps(e){e.innerHTML=`
        <div style="text-align:center;padding:60px 20px;width:100%;">
            <div style="font-size:64px;margin-bottom:20px;">\u{1F3F7}\uFE0F</div>
            <div style="font-size:18px;color:#374151;margin-bottom:12px;font-weight:600;">\u60A8\u8FD8\u672A\u5173\u6CE8\u4EFB\u4F55\u6807\u7B7E</div>
            <div style="font-size:14px;color:#6b7280;margin-bottom:24px;line-height:1.6;">
                \u524D\u5F80\u300C\u6211\u7684\u8BBE\u7F6E\u300D\u6DFB\u52A0\u611F\u5174\u8DA3\u7684\u6807\u7B7E\uFF0C<br>
                \u8FD9\u91CC\u5C06\u4E3A\u60A8\u805A\u5408\u76F8\u5173\u65B0\u95FB
            </div>
            <a href="/api/user/preferences/page" 
               style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg,#4f46e5,#7c3aed);color:white;text-decoration:none;border-radius:8px;font-weight:500;transition:transform 0.2s;"
               onmouseover="this.style.transform='scale(1.05)'"
               onmouseout="this.style.transform='scale(1)'">
                \u53BB\u8BBE\u7F6E\u6807\u7B7E
            </a>
        </div>
    `}function ln(e){e.innerHTML=`
        <div style="text-align:center;padding:60px 20px;width:100%;">
            <div style="font-size:64px;margin-bottom:20px;">\u{1F512}</div>
            <div style="font-size:18px;color:#374151;margin-bottom:12px;font-weight:600;">\u8BF7\u5148\u767B\u5F55</div>
            <div style="font-size:14px;color:#6b7280;margin-bottom:24px;line-height:1.6;">
                \u767B\u5F55\u540E\u5373\u53EF\u67E5\u770B\u60A8\u5173\u6CE8\u7684\u6807\u7B7E\u65B0\u95FB
            </div>
            <a href="/api/auth/page" 
               style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg,#4f46e5,#7c3aed);color:white;text-decoration:none;border-radius:8px;font-weight:500;transition:transform 0.2s;"
               onmouseover="this.style.transform='scale(1.05)'"
               onmouseout="this.style.transform='scale(1)'">
                \u7ACB\u5373\u767B\u5F55
            </a>
        </div>
    `}function jt(e,t){e.innerHTML=`
        <div style="text-align:center;padding:60px 20px;width:100%;color:#6b7280;">
            <div style="font-size:48px;margin-bottom:16px;">\u{1F615}</div>
            <div style="font-size:16px;">\u52A0\u8F7D\u5931\u8D25: ${t||"\u672A\u77E5\u9519\u8BEF"}</div>
            <button onclick="window.HotNews?.myTags?.load(true)" 
                    style="margin-top:16px;padding:8px 16px;background:#4f46e5;color:white;border:none;border-radius:6px;cursor:pointer;">
                \u91CD\u8BD5
            </button>
        </div>
    `}function hs(e){let{tag:t,news:r,count:n}=e,o=t.icon||"\u{1F3F7}\uFE0F",a=t.name||t.id,i=r.length>0?r.map((s,d)=>{let f=ne(s.published_at);return`
            <li class="news-item" data-news-id="${s.id}">
                <div class="news-item-content">
                    <span class="news-index">${d+1}</span>
                    <a class="news-title" href="${s.url||"#"}" target="_blank" rel="noopener noreferrer">
                        ${s.title}
                    </a>
                    ${f?`<span class="tr-news-date" style="margin-left:8px;color:#9ca3af;font-size:12px;white-space:nowrap;">${f}</span>`:""}
                </div>
            </li>
            `}).join(""):'<li class="news-placeholder" style="color:#9ca3af;padding:20px;text-align:center;">\u6682\u65E0\u76F8\u5173\u65B0\u95FB</li>';return`
        <div class="platform-card" data-tag-id="${t.id}" draggable="false">
            <div class="platform-header">
                <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">
                    ${o} ${a}
                    <span style="font-size:12px;color:#9ca3af;margin-left:8px;">(${n}\u6761)</span>
                </div>
                <div class="platform-header-actions"></div>
            </div>
            <ul class="news-list">
                ${i}
            </ul>
        </div>
    `}function cn(e,t){if(console.log("[MyTags] renderTagsNews called, container:",e,"tagsData:",t),!e){console.error("[MyTags] renderTagsNews: container is null!");return}if(!t||t.length===0){console.log("[MyTags] No tags data, showing empty state"),ps(e);return}console.log("[MyTags] Rendering",t.length,"tags");let r=t.map(n=>hs(n)).join("");console.log("[MyTags] Generated HTML length:",r.length),e.innerHTML=r,console.log("[MyTags] HTML inserted into container")}async function Yt(e=!1){if(console.log("[MyTags] loadMyTags called, force:",e,"loading:",X,"loaded:",ut),X){console.log("[MyTags] Already loading, skipping");return}if(ut&&!e){console.log("[MyTags] Already loaded, skipping");return}let t=document.getElementById("myTagsGrid");if(!t){console.error("[MyTags] Container #myTagsGrid not found!");return}console.log("[MyTags] Container found, starting load..."),X=!0;try{console.log("[MyTags] Checking auth...");let r=await us();if(!r){console.log("[MyTags] User not authenticated"),ln(t),X=!1;return}if(console.log("[MyTags] User authenticated:",r),!e){let a=gs();if(a&&a.length>0){console.log("[MyTags] Loading from frontend cache, tags:",a.length),cn(t,a),ut=!0,X=!1,ys().catch(i=>{console.error("[MyTags] Background update failed:",i)});return}else console.log("[MyTags] No valid cache found")}console.log("[MyTags] Showing loading state..."),t.innerHTML=`
            <div class="my-tags-loading" style="text-align:center;padding:60px 20px;color:#6b7280;width:100%;">
                <div style="font-size:48px;margin-bottom:16px;">\u{1F3F7}\uFE0F</div>
                <div style="font-size:16px;">\u52A0\u8F7D\u4E2D...</div>
            </div>
        `,console.log("[MyTags] Fetching followed news from API...");let n=await fn();if(console.log("[MyTags] API response:",n),n.needsAuth){console.log("[MyTags] API returned needsAuth"),ln(t),X=!1;return}if(n.error){console.error("[MyTags] API returned error:",n.error),jt(t,n.error),X=!1;return}if(!n.ok){console.error("[MyTags] API returned not ok"),jt(t,"\u8BF7\u6C42\u5931\u8D25"),X=!1;return}let o=n.tags||[];console.log("[MyTags] Got tags from API:",o.length,"tags"),n.cached?console.log(`[MyTags] Loaded from backend cache (age: ${n.cache_age}s)`):console.log("[MyTags] Loaded fresh data from database"),dn(o),console.log("[MyTags] Rendering tags..."),cn(t,o),ut=!0,console.log("[MyTags] Load complete!")}catch(r){console.error("[MyTags] Load error:",r),jt(t,r.message)}finally{X=!1}}async function ys(){try{let e=await fn();e.ok&&e.tags&&(dn(e.tags),console.log("[MyTags] Background cache update completed"))}catch(e){console.error("[MyTags] Background cache update error:",e)}}function ws(e){e===ds&&Yt()}function Vt(){window.addEventListener("tr_tab_switched",t=>{let r=t?.detail?.categoryId;r&&ws(r)}),document.querySelector("#tab-my-tags.active")&&Yt(),console.log("[MyTags] Module initialized")}typeof window<"u"&&(window.HotNews=window.HotNews||{},window.HotNews.myTags={load:Yt,init:Vt,clearCache:ms});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Vt):Vt();var gn="hotnews_mobile_top_collapsed_v1",mn="tr-mobile-top-collapsed";function un(e){let t=!!e;try{document.body.classList.toggle(mn,t)}catch{}try{localStorage.setItem(gn,t?"1":"0")}catch{}try{let r=document.getElementById("trFooterTopToggle");r&&(r.textContent=t?"\u663E\u793A\u9876\u90E8":"\u9690\u85CF\u9876\u90E8")}catch{}}function bs(){let e=!0;try{let t=localStorage.getItem(gn);t==="0"&&(e=!1),t==="1"&&(e=!0)}catch{}try{new URLSearchParams(window.location.search).get("e2e")==="1"&&(e=!1)}catch{}un(e);try{let t=document.getElementById("trFooterTopToggle");if(!t||t.dataset.bound==="1")return;t.dataset.bound="1",t.setAttribute("role","button"),t.setAttribute("aria-label","\u663E\u793A\u6216\u9690\u85CF\u9876\u90E8\u680F"),t.addEventListener("click",()=>{let r=!document.body.classList.contains(mn);if(un(r),!r)try{window.scrollTo({top:0,behavior:"smooth"})}catch{}})}catch{}}T(function(){try{if(new URLSearchParams(window.location.search).get("e2e")==="1"){try{let n=document.getElementById("early-hide");n&&n.remove()}catch{}try{let n=document.querySelector(".category-tabs");n&&n instanceof HTMLElement&&(n.style.display="flex")}catch{}try{let n=document.querySelector(".tab-content-area");n&&n instanceof HTMLElement&&(n.style.display="block")}catch{}}}catch{}if(bs(),localStorage.getItem("category_settings_badge_dismissed")==="true"){let r=document.getElementById("categorySettingsNewBadge");r&&(r.style.display="none")}if(localStorage.getItem("rss_subscription_badge_dismissed")==="true"){let r=document.getElementById("rssSubscriptionNewBadge");r&&(r.style.display="none")}let e=l.settings.getCategoryConfig();if(e&&(e.customCategories&&e.customCategories.length>0||e.hiddenDefaultCategories&&e.hiddenDefaultCategories.length>0||e.categoryOrder&&e.categoryOrder.length>0||e.platformOrder&&typeof e.platformOrder=="object"&&Object.keys(e.platformOrder).length>0)){l.data.refreshViewerData({preserveScroll:!1});try{window.setTimeout(()=>{try{if(document.body.classList.contains("categories-ready"))return}catch{}try{let r=document.getElementById("early-hide");r&&r.remove()}catch{}try{let r=document.querySelector(".category-tabs");r&&r instanceof HTMLElement&&(r.style.display="flex")}catch{}try{let r=document.querySelector(".tab-content-area");r&&r instanceof HTMLElement&&(r.style.display="block")}catch{}try{document.body.classList.add("categories-ready")}catch{}},2500)}catch{}}else document.body.classList.add("categories-ready")});import("./platform-reorder-QQPKTQXB.js");import("./subscription-ORFNDK42.js");import("./rss-catalog-preview-parity-UKSK6GKS.js");import("./explore-embedded-rss-O42CYAPX.js");export{l as TR};
