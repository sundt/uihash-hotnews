import{a as E}from"./chunk-LWNQQXSE.js";import{a as l,b as T,c as C,d as Yt,e as ht}from"./chunk-JEFDO44H.js";var cn={updatePlatformCount(t){if(!t)return;let e=t.querySelectorAll(".news-item:not(.filtered):not(.search-hidden):not(.paged-hidden)"),r=t.querySelector(".platform-visible-count");r&&(r.textContent=e.length)},updateAllCounts(){document.querySelectorAll(".platform-card").forEach(r=>{this.updatePlatformCount(r)});let t=document.querySelectorAll(".news-item:not(.filtered):not(.search-hidden):not(.paged-hidden)").length,e=document.getElementById("totalNews");e&&(e.textContent=t)}};l.counts=cn;var nt={openLink(t){let e=t.dataset.url;e&&window.open(e,"_blank")},isHoverDevice(){return window.matchMedia&&window.matchMedia("(hover: hover)").matches},closeAllPreviews(t){document.querySelectorAll(".news-item.preview").forEach(e=>{t&&e===t||e.classList.remove("preview")})},handleTitleClickV2(t,e){e.stopPropagation();let r=t.closest(".news-item");if(!r)return;let n=r.querySelector(".news-checkbox");if(n?n.checked||(n.checked=!0,typeof window.markAsRead=="function"?window.markAsRead(n):l.readState&&typeof l.readState.markAsRead=="function"&&l.readState.markAsRead(n)):l.readState&&typeof l.readState.markItemAsRead=="function"&&l.readState.markItemAsRead(r),this.isHoverDevice())return;if(r.classList.contains("preview")){r.classList.remove("preview");return}e.preventDefault(),this.closeAllPreviews(r),r.classList.add("preview")},handleTitleKeydownV2(t,e){e.key==="Enter"?this.handleTitleClickV2(t,e):e.key===" "?(e.preventDefault(),this.handleTitleClickV2(t,e)):e.key==="Escape"&&this.closeAllPreviews(null)}};window.handleTitleClickV2=(t,e)=>nt.handleTitleClickV2(t,e);window.handleTitleKeydownV2=(t,e)=>nt.handleTitleKeydownV2(t,e);window.openLink=t=>nt.openLink(t);document.addEventListener("click",t=>{t.target.closest(".news-item")||nt.closeAllPreviews(null)});document.addEventListener("touchstart",t=>{t.target.closest(".news-item")||nt.closeAllPreviews(null)},{passive:!0});document.addEventListener("keydown",t=>{t.key==="Escape"&&nt.closeAllPreviews(null)});l.link=nt;var Ge={searchNews(){let e=(document.getElementById("searchInput")?.value||"").toLowerCase();document.querySelectorAll(".news-item").forEach(r=>{let n=r.textContent.toLowerCase();!e||n.includes(e)?r.classList.remove("search-hidden"):r.classList.add("search-hidden")}),l.counts.updateAllCounts(),l.paging&&typeof l.paging.scheduleAutofillActiveTab=="function"&&l.paging.scheduleAutofillActiveTab()}};window.searchNews=()=>Ge.searchNews();l.search=Ge;var je="hotnews_platform_grid_scroll_v1",Ve={getPlatformGridScrollState(){return E.get(je,{})},setPlatformGridScrollState(t){E.set(je,t||{})},recordPlatformGridScrollForTab(t,e){if(!t||!e)return;let r=e.scrollLeft||0,n=null,a=0,o=null,i=e.querySelectorAll(".platform-card");for(let d of i)if((d.offsetLeft||0)<=r+1)o=d;else break;o?.dataset?.platform&&(n=o.dataset.platform,a=Math.max(0,r-(o.offsetLeft||0)));let s=this.getPlatformGridScrollState();s[t]={left:r,anchorPlatformId:n,anchorOffsetX:a,updatedAt:Date.now()},this.setPlatformGridScrollState(s)},attachPlatformGridScrollPersistence(){document.querySelectorAll(".tab-pane .platform-grid").forEach(t=>{if(t.dataset.scrollPersistBound==="1")return;t.dataset.scrollPersistBound="1";let e=!1;t.addEventListener("scroll",()=>{t.dataset.trRestoring!=="1"&&(t.dataset.trUserScrolled="1"),!e&&(e=!0,requestAnimationFrame(()=>{e=!1;let r=t.closest(".tab-pane"),n=r?.id?.startsWith("tab-")?r.id.slice(4):null;this.recordPlatformGridScrollForTab(n,t)}))},{passive:!0})})},restoreActiveTabPlatformGridScroll(t){let e=t?.activeTab;if(!t?.preserveScroll||!e)return;let r=this.getPlatformGridScrollState()?.[e],n=Number.isFinite(r?.left)?r.left:Number.isFinite(t.activeTabPlatformGridScrollLeft)?t.activeTabPlatformGridScrollLeft:0,a=typeof r?.anchorPlatformId=="string"&&r.anchorPlatformId?r.anchorPlatformId:t.activeTabPlatformAnchorPlatformId,o=Number.isFinite(r?.anchorOffsetX)?r.anchorOffsetX:Number.isFinite(t.activeTabPlatformAnchorOffsetX)?t.activeTabPlatformAnchorOffsetX:0,i=()=>{let s=document.querySelector(`#tab-${e} .platform-grid`);if(s&&s.dataset.trUserScrolled!=="1"){if(a){let d=null;if(s.querySelectorAll(".platform-card").forEach(u=>{!d&&u.dataset.platform===a&&(d=u)}),d&&d.offsetParent!==null){s.dataset.trRestoring="1",s.scrollLeft=(d.offsetLeft||0)+o,requestAnimationFrame(()=>{try{delete s.dataset.trRestoring}catch{}});return}}s.dataset.trRestoring="1",s.scrollLeft=n,requestAnimationFrame(()=>{try{delete s.dataset.trRestoring}catch{}})}};requestAnimationFrame(()=>{requestAnimationFrame(()=>{i(),setTimeout(i,50),setTimeout(i,200),setTimeout(i,600)})})},pauseScrollSnap(){document.body.classList.add("tr-snap-paused")},resumeScrollSnap(){setTimeout(()=>{document.body.classList.remove("tr-snap-paused")},100)},setupVisibilityScrollFix(){document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?(document.body.classList.add("tr-page-hidden"),this.pauseScrollSnap()):document.visibilityState==="visible"&&(document.body.classList.remove("tr-page-hidden"),this.resumeScrollSnap())}),window.addEventListener("beforeunload",()=>{this.pauseScrollSnap()})}};l.scroll=Ve;T(function(){Ve.setupVisibilityScrollFix()});var ze="hotnews_feature_badge_v1:",Ye="hotnews_new_badges_dismissed_v1",me={getFeatureBadgeState(t){return E.get(ze+t,null)},setFeatureBadgeState(t,e){E.set(ze+t,e)},ensureFeatureFirstSeen(t){let e=this.getFeatureBadgeState(t);if(e&&typeof e.firstSeenAt=="number")return e;let r={firstSeenAt:Date.now(),seenAt:null};return this.setFeatureBadgeState(t,r),r},markFeatureSeen(t){let e=this.ensureFeatureFirstSeen(t);e.seenAt||(e.seenAt=Date.now(),this.setFeatureBadgeState(t,e))},shouldShowFeatureBadge(t,e){let r=this.ensureFeatureFirstSeen(t);if(r.seenAt)return!1;let n=(e||7)*24*60*60*1e3;return Date.now()-(r.firstSeenAt||0)<=n},updateNewBadges(){let t=document.getElementById("newBadgeSportsTab");t&&(t.style.display=this.shouldShowFeatureBadge("sports-nba-schedule",7)?"":"none")},getDismissedNewBadges(){let t=E.get(Ye,{});return{categories:t?.categories||{},platforms:t?.platforms||{}}},setDismissedNewBadges(t){E.set(Ye,t||{categories:{},platforms:{}})},applyDismissedNewBadges(){let t=this.getDismissedNewBadges();document.querySelectorAll(".new-badge-category").forEach(e=>{let r=e?.dataset?.category;r&&t.categories?.[r]&&(e.style.display="none")}),document.querySelectorAll(".new-badge-platform").forEach(e=>{let r=e?.dataset?.platform;r&&t.platforms?.[r]&&(e.style.display="none")})},dismissNewCategoryBadge(t){if(!t)return;let e=this.getDismissedNewBadges();e.categories?.[t]||(e.categories[t]=!0,this.setDismissedNewBadges(e)),document.querySelectorAll(`.new-badge-category[data-category="${CSS.escape(t)}"]`).forEach(r=>{r.style.display="none"})},dismissNewPlatformBadge(t){if(!t)return;let e=this.getDismissedNewBadges();e.platforms?.[t]||(e.platforms[t]=!0,this.setDismissedNewBadges(e)),document.querySelectorAll(`.new-badge-platform[data-platform="${CSS.escape(t)}"]`).forEach(r=>{r.style.display="none"})}};window.dismissNewPlatformBadge=t=>me.dismissNewPlatformBadge(t);l.badges=me;T(function(){me.applyDismissedNewBadges()});var Wt=window.SYSTEM_SETTINGS?.display?.items_per_card||20,dn=50,Ka=window.SYSTEM_SETTINGS?.display?.items_per_card||20,We=10,fn=8,un=80,mn=160,Pt={PAGE_SIZE:Wt,getCardMaxPageSize(t){try{if(t?.classList?.contains("tr-morning-brief-card"))return dn}catch{}return Wt},getCardPageSize(t){let e=t?.dataset?.pageSize,r=parseInt(e||"",10),n=Number.isFinite(r)&&r>0?r:Wt,a=this.getCardMaxPageSize(t);return Math.min(a,Math.max(1,n))},setCardPageSize(t,e){if(!t)return;let r=parseInt(String(e||""),10),n=Number.isFinite(r)&&r>0?r:Wt,a=this.getCardMaxPageSize(t);t.dataset.pageSize=String(Math.min(a,Math.max(1,n)))},applyPagingToCard(t,e){let r=Array.from(t.querySelectorAll(".news-item")),n=r.length,a=this.getCardPageSize(t);if(n<=a){r.forEach(s=>s.classList.remove("paged-hidden")),t.dataset.pageOffset="0";return}let o=Math.max(0,Math.min(e,n-1)),i=Math.min(o+a,n);r.forEach((s,d)=>{d>=o&&d<i?s.classList.remove("paged-hidden"):s.classList.add("paged-hidden")}),t.dataset.pageOffset=String(o)},initPaging(){document.querySelectorAll(".platform-card").forEach(t=>{let e=this.getCardMaxPageSize(t);this.setCardPageSize(t,e),this.applyPagingToCard(t,0)}),l.counts.updateAllCounts()},refreshPlatform(t){let e=t.closest(".platform-card");if(!e)return;let n=e.querySelectorAll(".news-item").length,a=this.getCardPageSize(e);if(n<=a)return;let o=parseInt(e.dataset.pageOffset||"0",10),i=o+a>=n?0:o+a;this.applyPagingToCard(e,i),l.counts.updateAllCounts()},getVisibleNewsItems(t){return t?Array.from(t.querySelectorAll(".news-item")).filter(e=>!e.classList.contains("filtered")&&!e.classList.contains("search-hidden")&&!e.classList.contains("paged-hidden")&&!e.classList.contains("read")):[]},shouldAutofillCard(t,e){if(!t||t.classList.contains("platform-empty-hidden"))return!1;try{if(t.classList.contains("tr-morning-brief-card"))return!1}catch{}let r=this.getVisibleNewsItems(t),n=Number.isFinite(e)?e:We;if(r.length<n)return!0;let a=r[r.length-1];if(!a)return!0;let o=t.getBoundingClientRect(),i=a.getBoundingClientRect();return!Number.isFinite(o.bottom)||!Number.isFinite(i.bottom)?!1:o.bottom-i.bottom>=un},autofillCard(t,e={}){if(!t)return!1;try{if(t.classList.contains("tr-morning-brief-card"))return!1}catch{}let r=Number.isFinite(e.minVisible)?e.minVisible:We,n=Number.isFinite(e.maxSteps)?e.maxSteps:fn,a=e.force===!0,o=t.querySelectorAll(".news-item").length;if(o<=0)return!1;let i=parseInt(t.dataset.pageOffset||"0",10)||0,s=this.getCardPageSize(t),d=!1,u=Math.max(0,i);for(let c=0;c<n&&!(!a&&!this.shouldAutofillCard(t,r)||o<=s);c++){let f=u+s;if(f+s>o&&(f=0),f===u)break;u=f,this.setCardPageSize(t,s),this.applyPagingToCard(t,u),d=!0}return d&&l.counts.updateAllCounts(),d},autofillForCategory(t,e={}){let r=document.getElementById(`tab-${t}`);if(!r)return!1;let n=!1;return r.querySelectorAll(".platform-card").forEach(a=>{this.autofillCard(a,e)&&(n=!0)}),n},autofillActiveTab(t={}){let r=document.querySelector(".category-tabs .category-tab.active")?.dataset?.category;return r?this.autofillForCategory(r,t):!1},scheduleAutofillActiveTab(t={}){clearTimeout(this._autofillTimer),this._autofillTimer=setTimeout(()=>{this._autofillTimer=null,this.autofillActiveTab(t)},120)},attachAutofillScrollListener(){this._autofillScrollBound||(this._autofillScrollBound=!0,window.addEventListener("scroll",()=>{(document.documentElement.scrollHeight||0)-(window.scrollY+window.innerHeight)<=mn&&this.scheduleAutofillActiveTab({force:!0})},{passive:!0}))}};window.refreshPlatform=t=>Pt.refreshPlatform(t);l.paging=Pt;T(function(){Pt.initPaging(),Pt.attachAutofillScrollListener(),Pt.scheduleAutofillActiveTab({force:!0,maxSteps:1})});var Ue="hotnews_read_news_v2",Ke="hotnews_read_news",Xe="hotnews_show_read_mode",gn=24,V={getReadNews(){return E.get(Ue,{})},saveReadNews(t){E.set(Ue,t)},getShowReadModePref(){let t=E.getRaw(Xe);return t===null?!0:t==="1"},applyShowReadMode(t){t?document.body.classList.add("show-read-mode"):document.body.classList.remove("show-read-mode");let e=document.getElementById("showReadBtn");e&&(t?e.classList.add("active"):e.classList.remove("active"))},migrateOldFormat(){E.getRaw(Ke)&&(E.remove(Ke),console.log("\u5DF2\u6E05\u9664\u65E7\u7248\u672C\u5DF2\u8BFB\u8BB0\u5F55"))},cleanupExpiredReads(){let t=Date.now(),e=this.getReadNews(),r=!1,n=0;for(let[a,o]of Object.entries(e))if((t-o.readAt)/36e5>=gn){let s=document.querySelector(`[data-news-id="${a}"]`);if(s){s.classList.remove("read");let d=s.querySelector(".news-checkbox");d&&(d.checked=!1)}delete e[a],r=!0,n++}return r&&this.saveReadNews(e),n},markAsRead(t){let e=t.closest(".news-item"),r=e.dataset.newsId,n=e.dataset.newsTitle||"",a=this.getReadNews();t.checked?(e.classList.add("read"),a[r]||(a[r]={title:n.substring(0,50),readAt:Date.now()},this.saveReadNews(a))):(e.classList.remove("read"),delete a[r],this.saveReadNews(a)),l.counts.updatePlatformCount(t.closest(".platform-card")),this.updateReadCount()},markItemAsRead(t){try{if(!t)return;let e=t.dataset.newsId,r=t.dataset.newsTitle||"";if(!e)return;t.classList.add("read");let n=this.getReadNews();n[e]||(n[e]={title:String(r||"").substring(0,50),readAt:Date.now()},this.saveReadNews(n)),l.counts.updatePlatformCount(t.closest(".platform-card")),this.updateReadCount()}catch{}},updateReadCount(){let t=this.getReadNews(),e=document.getElementById("readCount");e&&(e.textContent=Object.keys(t).length)},restoreReadState(){let t=this.getReadNews();Object.keys(t).forEach(e=>{let r=document.querySelector(`[data-news-id="${e}"]`);if(r){r.classList.add("read");let n=r.querySelector(".news-checkbox");n&&(n.checked=!0)}}),l.counts.updateAllCounts(),this.updateReadCount()},toggleShowRead(){let t=!document.body.classList.contains("show-read-mode");this.applyShowReadMode(t),E.setRaw(Xe,t?"1":"0"),l.counts.updateAllCounts()},clearAllRead(){confirm("\u786E\u5B9A\u8981\u6E05\u9664\u6240\u6709\u5DF2\u8BFB\u8BB0\u5F55\u5417\uFF1F\u6240\u6709\u65B0\u95FB\u5C06\u6062\u590D\u663E\u793A\u3002")&&(document.querySelectorAll(".news-item.read").forEach(t=>{t.classList.remove("read");let e=t.querySelector(".news-checkbox");e&&(e.checked=!1)}),this.saveReadNews({}),l.counts.updateAllCounts(),this.updateReadCount())}};window.markAsRead=t=>V.markAsRead(t);window.toggleShowRead=()=>V.toggleShowRead();window.clearAllRead=()=>V.clearAllRead();l.readState=V;T(function(){V.applyShowReadMode(V.getShowReadModePref()),V.migrateOldFormat();let t=V.cleanupExpiredReads();t>0&&console.log(`\u5DF2\u6E05\u7406 ${t} \u6761\u8FC7\u671F\u5DF2\u8BFB\u8BB0\u5F55`),V.restoreReadState(),V.updateReadCount()});var Je="hotnews_theme_mode",Ze="eye-protection-mode",ge={isDarkMode(){try{return localStorage.getItem(Je)==="dark"}catch{return!1}},toggle(){let e=!this.isDarkMode();this.apply(e);try{localStorage.setItem(Je,e?"dark":"light")}catch{}},apply(t){t?document.body.classList.add(Ze):document.body.classList.remove(Ze),this.updateButtonState(t)},updateButtonState(t){let e=document.getElementById("themeToggleBtn");e&&(e.innerHTML=t?"\u{1F31E}":"\u{1F319}",e.classList.toggle("active",t))},init(){let t=this.isDarkMode();this.apply(t)}};l.theme=ge;window.toggleTheme=function(){ge.toggle()};document.addEventListener("DOMContentLoaded",()=>{ge.init()});var Ut="hotnews_categories_config",pe=1,L=null,D=null,at=null,Mt=!1,yt=!1,Q=!0,pn=null,Ot="",z=!1;function hn(t,e){let r=Array.isArray(t)?t:[],n=new Set,a=[];r.forEach(i=>{let s=String(i||"").trim();s&&(n.has(s)||(n.add(s),a.push(s)))});let o=Array.isArray(e)?e:[];o.forEach(i=>{let s=a.indexOf(i);s>=0&&a.splice(s,1)});for(let i=o.length-1;i>=0;i-=1){let s=String(o[i]||"").trim();s&&a.unshift(s)}return a}function Kt(t){(!t.categoryFilters||typeof t.categoryFilters!="object")&&(t.categoryFilters={})}function Qe(t){let e=t&&typeof t=="object"?t:{};return Array.isArray(e.customCategories)||(e.customCategories=[]),Array.isArray(e.hiddenDefaultCategories)||(e.hiddenDefaultCategories=[]),Array.isArray(e.hiddenPlatforms)||(e.hiddenPlatforms=[]),Array.isArray(e.categoryOrder)||(e.categoryOrder=[]),(!e.platformOrder||typeof e.platformOrder!="object")&&(e.platformOrder={}),Kt(e),e}var O={CATEGORY_CONFIG_KEY:Ut,ensureCategoryFilters:Kt,normalizeCategoryConfig:Qe,getCategoryConfig(){try{let t=E.getRaw(Ut);if(!t)return null;let e=JSON.parse(t);return e.version!==pe?null:Qe(e)}catch{return null}},saveCategoryConfig(t){t.version=pe,E.setRaw(Ut,JSON.stringify(t)),this.syncConfigToCookie(t)},syncConfigToCookie(t){try{t.customCategories?.length>0||t.hiddenDefaultCategories?.length>0||t.hiddenPlatforms?.length>0||t.categoryOrder?.length>0?document.cookie="hotnews_has_config=1; path=/; max-age=31536000; SameSite=Lax":document.cookie="hotnews_has_config=; path=/; max-age=0"}catch(e){console.error("Failed to sync config to cookie:",e)}},getDefaultCategoryConfig(){return L||(L={},D={},document.querySelectorAll(".category-tab").forEach(t=>{let e=t.dataset.category,r=t.querySelector(".category-tab-icon")?.textContent?.trim()||"\u{1F4C1}",n=t.querySelector(".category-tab-name")?.textContent?.replace(/NEW$/,"")?.trim()||e;L[e]={id:e,name:n,icon:r,isDefault:!0}}),document.querySelectorAll(".platform-card:not(.tr-morning-brief-card)").forEach(t=>{let e=t.dataset.platform,r=(t.querySelector(".platform-name")?.textContent||"").replace(/NEW\s*$/i,"").replace(/ðŸ“±\s*/g,"").trim()||e,a=t.closest(".tab-pane")?.id?.replace("tab-","")||"other";D[e]={id:e,name:r,defaultCategory:a},L[a]&&(L[a].platforms||(L[a].platforms=[]),L[a].platforms.push(e))})),{version:pe,customCategories:[],hiddenDefaultCategories:[],hiddenPlatforms:[],categoryOrder:Object.keys(L),platformOrder:{},categoryFilters:{}}},getMergedCategoryConfig(){let t=this.getDefaultCategoryConfig(),e=this.getCategoryConfig();if(!e)return t;let r={...t,customCategories:e.customCategories||[],hiddenDefaultCategories:e.hiddenDefaultCategories||[],hiddenPlatforms:e.hiddenPlatforms||[],categoryOrder:e.categoryOrder||t.categoryOrder,platformOrder:e.platformOrder||{},categoryFilters:e.categoryFilters||{}},n=Object.keys(L);n.forEach((a,o)=>{if(!r.categoryOrder.includes(a)){let i=r.categoryOrder.length;for(let s=o-1;s>=0;s--){let d=n[s],u=r.categoryOrder.indexOf(d);if(u!==-1){i=u+1;break}}r.categoryOrder.splice(i,0,a)}}),r.customCategories.forEach(a=>{r.categoryOrder.includes(a.id)||r.categoryOrder.push(a.id)});try{let a="__migrated_explore_knowledge_front_v1",o=Array.isArray(e.categoryOrder)?e.categoryOrder.indexOf("explore"):-1,i=Array.isArray(e.categoryOrder)?e.categoryOrder.indexOf("knowledge"):-1,s=o!==0||i!==1;if(!e[a]&&s){let d=hn(r.categoryOrder,["explore","knowledge"]);r.categoryOrder=d,e.categoryOrder=d,e[a]=Date.now(),this.saveCategoryConfig(e)}}catch{}return r},getDefaultCategories(){return L},getAllPlatforms(){return D},addPlatformToCustomCategory(t,e){let r=String(t||"").trim(),n=String(e||"").trim();if(!r||!n)return!1;let a=this.getCategoryConfig()||this.getDefaultCategoryConfig();Kt(a);let o=Array.isArray(a.customCategories)?a.customCategories.findIndex(d=>String(d?.id||"").trim()===r):-1;if(o<0)return!1;let i=a.customCategories[o]||{},s=Array.isArray(i.platforms)?[...i.platforms]:[];return s.includes(n)||s.push(n),a.customCategories[o]={...i,platforms:s},Array.isArray(a.categoryOrder)&&!a.categoryOrder.includes(r)&&a.categoryOrder.unshift(r),this.saveCategoryConfig(a),z=!0,!0},setDefaultCategories(t){L=t},setAllPlatforms(t){D=t},async openCategorySettings(){let t=document.getElementById("categorySettingsNewBadge");t&&(t.style.display="none",localStorage.setItem("category_settings_badge_dismissed","true"));try{let n=await(await fetch("/api/news")).json();n?.categories&&(L={},D={},Object.entries(n.categories).forEach(([a,o])=>{L[a]={id:a,name:o.name,icon:o.icon,isDefault:!0,platforms:Object.keys(o.platforms||{})},Object.entries(o.platforms||{}).forEach(([i,s])=>{D[i]={id:i,name:s.name,defaultCategory:a,data:s}})}))}catch(r){console.error("Failed to fetch categories:",r)}document.getElementById("categorySettingsModal").classList.add("show"),Q=!0,pn=null,this.applyCategoryListCollapseState(),this.renderCategoryList(),this.hideEditPanel()},applyCategoryListCollapseState(){let t=document.getElementById("categoryListWrapper");t&&(Q?t.classList.add("collapsed"):t.classList.remove("collapsed"));let e=document.getElementById("categoryListToggleBtn");e&&(e.textContent=Q?"\u5C55\u5F00\u680F\u76EE\u5217\u8868":"\u6536\u8D77\u680F\u76EE\u5217\u8868")},toggleCategoryListCollapseInSettings(){Q=!Q,this.applyCategoryListCollapseState()},closeCategorySettings(){document.getElementById("categorySettingsModal").classList.remove("show"),z&&(z=!1,this.applyCategoryConfig())},saveCategorySettings(){let t=document.getElementById("categoryEditPanel");t&&t.classList.contains("show")&&!this.saveCategory()||this.closeCategorySettings()},cancelCategorySettings(){z=!1,document.getElementById("categorySettingsModal").classList.remove("show")},renderCategoryList(){let t=document.getElementById("categoryList"),e=this.getMergedCategoryConfig(),r="";e.categoryOrder.forEach(a=>{let o=e.customCategories.find(u=>u.id===a),i=e.hiddenDefaultCategories.includes(a),s;if(o)s=o;else if(L[a])s=L[a];else return;let d=o?s.platforms?.length||0:L[a]?.platforms?.length||0;r+=`
                <div class="category-item ${o?"custom":""}" data-category-id="${a}" draggable="true">
                    <span class="category-item-drag">\u2630</span>
                    <span class="category-item-name">${s.name}</span>
                    <span class="category-item-platforms">${d} \u4E2A\u5E73\u53F0</span>
                    <label class="category-item-toggle">
                        <input type="checkbox" ${i?"":"checked"} onchange="toggleCategoryVisibility('${a}')">
                        <span class="slider"></span>
                    </label>
                    <div class="category-item-actions">
                        <button class="category-item-btn" onclick="editCategory('${a}')">\u7F16\u8F91</button>
                        ${o?`<button class="category-item-btn delete" onclick="deleteCategory('${a}')">\u5220\u9664</button>`:""}
                    </div>
                </div>
            `}),t.innerHTML=r;let n=document.getElementById("allCategoriesOffToggle");if(n){let a=e.hiddenDefaultCategories||[],o=e.categoryOrder||[];n.checked=o.length>0&&o.every(i=>a.includes(i))}yt?t.classList.add("hide-default"):t.classList.remove("hide-default"),this.setupCategoryDragAndDrop()},toggleDefaultCategoryListInSettings(){yt=!yt,this.renderCategoryList()},toggleAllCategoriesOffInSettings(t){},setupCategoryDragAndDrop(){let t=document.getElementById("categoryList");t.querySelectorAll(".category-item").forEach(r=>{r.addEventListener("dragstart",n=>{r.classList.add("dragging"),n.dataTransfer.effectAllowed="move"}),r.addEventListener("dragend",()=>{r.classList.remove("dragging"),this.saveCategoryOrder()}),r.addEventListener("dragover",n=>{n.preventDefault();let a=t.querySelector(".dragging");if(a&&a!==r){let o=r.getBoundingClientRect(),i=o.top+o.height/2;n.clientY<i?t.insertBefore(a,r):t.insertBefore(a,r.nextSibling)}})})},saveCategoryOrder(){let e=document.getElementById("categoryList").querySelectorAll(".category-item"),r=Array.from(e).map(a=>a.dataset.categoryId),n=this.getCategoryConfig()||this.getDefaultCategoryConfig();n.categoryOrder=r,this.saveCategoryConfig(n),z=!0},toggleCategoryVisibility(t){let e=this.getCategoryConfig()||this.getDefaultCategoryConfig(),r=e.hiddenDefaultCategories.indexOf(t);r>=0?e.hiddenDefaultCategories.splice(r,1):e.hiddenDefaultCategories.push(t),this.saveCategoryConfig(e),z=!0,this.renderCategoryList()},togglePlatformHidden(t){let e=String(t||"").trim();if(!e)return!1;let r=this.getCategoryConfig()||this.getDefaultCategoryConfig();Array.isArray(r.hiddenPlatforms)||(r.hiddenPlatforms=[]);let n=r.hiddenPlatforms.findIndex(a=>String(a||"").trim()===e);return n>=0?r.hiddenPlatforms.splice(n,1):r.hiddenPlatforms.push(e),this.saveCategoryConfig(r),z=!0,this.applyCategoryConfig(),!0},showAddCategoryPanel(){Mt=!0,at=null,Q=!0,this.applyCategoryListCollapseState(),yt=!0,document.getElementById("editCategoryName").value="";let t=document.getElementById("platformSelectField");t&&(t.style.display="");let e=document.getElementById("platformSearchInput");e&&(e.value=""),Ot="",this.renderPlatformSelectList([],!0),l.filter.setCategoryFilterEditorState("exclude",[]),document.getElementById("categoryEditPanel").classList.add("show")},editCategory(t){Mt=!1,at=t;let e=document.getElementById("platformSelectField");e&&(e.style.display="");let r=this.getMergedCategoryConfig(),n=r.customCategories.find(d=>d.id===t),a,o;n?(a=n,o=a.platforms||[]):(a=L[t],o=r.platformOrder[t]||a.platforms||[]),document.getElementById("editCategoryName").value=a.name,this.renderPlatformSelectList(o,n);let i=l.filter.getCategoryFilterConfig(t);l.filter.setCategoryFilterEditorState(i.mode,i.keywords),yt=!0,Q=!0,this.applyCategoryListCollapseState();let s=document.getElementById("platformSearchInput");s&&(s.value=""),Ot="",document.getElementById("categoryEditPanel").classList.add("show")},hideEditPanel(){document.getElementById("categoryEditPanel").classList.remove("show"),at=null,Mt=!1,yt=!1,this.renderCategoryList();let t=document.getElementById("platformSearchInput");t&&(t.value=""),Ot=""},cancelEditCategory(){this.hideEditPanel()},renderPlatformSelectList(t,e=!1){let r=document.getElementById("platformSelectList"),a=(this.getMergedCategoryConfig().hiddenPlatforms||[]).map(c=>String(c||"").trim()).filter(Boolean),o=new Set(a),i=[];t.forEach(c=>{D[c]&&i.push(c)}),e&&Object.keys(D).forEach(f=>{i.includes(f)||i.push(f)});let s=(Ot||"").trim().toLowerCase(),d=s?i.filter(c=>(D[c]?.name||"").toLowerCase().includes(s)):i,u=s.length>0;r.innerHTML=d.map(c=>{let f=D[c],g=t.includes(c)&&!o.has(String(c||"").trim());return`
                <label class="platform-select-item ${g?"selected":""} ${u?"no-drag":""}" data-platform-id="${c}" draggable="${u?"false":"true"}">
                    <span class="drag-handle">\u2630</span>
                    <input type="checkbox" ${g?"checked":""} onchange="togglePlatformSelect('${c}')">
                    <span>${f.name}</span>
                </label>
            `}).join(""),u||this.setupPlatformDragAndDrop()},setPlatformSearchQuery(t){Ot=String(t||"");let e=this.getSelectedPlatforms();this.renderPlatformSelectList(e,Mt===!0)},bulkSelectPlatforms(t){let e=document.getElementById("platformSelectList");if(!e)return;e.querySelectorAll(".platform-select-item").forEach(n=>{let a=n.querySelector('input[type="checkbox"]');t==="all"?(n.classList.add("selected"),a&&(a.checked=!0)):(t==="none"||t==="clear")&&(n.classList.remove("selected"),a&&(a.checked=!1))})},setupPlatformDragAndDrop(){let t=document.getElementById("platformSelectList"),e=t.querySelectorAll(".platform-select-item"),r=60,n=20,a=null,o=0,i=0,s=()=>{a&&cancelAnimationFrame(a),a=null,o=0,i=0},d=()=>{if(!o||!i){s();return}let c=Math.max(0,(t.scrollHeight||0)-(t.clientHeight||0));if(c<=0){s();return}let f=Math.max(0,Math.min(c,(t.scrollTop||0)+o*i));t.scrollTop=f,a=requestAnimationFrame(d)},u=c=>{let f=t.getBoundingClientRect(),g=c.clientY,p=g-f.top,y=f.bottom-g,A=0,_=0;if(p>=0&&p<=r)A=-1,_=p;else if(y>=0&&y<=r)A=1,_=y;else{s();return}let k=Math.max(0,Math.min(1,(r-_)/r));i=Math.max(2,Math.round(k*k*n)),o=A,a||(a=requestAnimationFrame(d))};e.forEach(c=>{c.addEventListener("dragstart",f=>{c.classList.add("dragging"),f.dataTransfer.effectAllowed="move"}),c.addEventListener("dragend",()=>{c.classList.remove("dragging"),s()}),c.addEventListener("dragover",f=>{f.preventDefault(),u(f);let g=t.querySelector(".dragging");if(g&&g!==c){let p=c.getBoundingClientRect(),y=p.top+p.height/2;f.clientY<y?t.insertBefore(g,c):t.insertBefore(g,c.nextSibling)}})}),t.addEventListener("dragover",c=>{c.preventDefault(),t.querySelector(".dragging")&&u(c)})},togglePlatformSelect(t){let e=document.querySelector(`.platform-select-item[data-platform-id="${t}"]`);e&&e.classList.toggle("selected")},getSelectedPlatforms(){let t=document.querySelectorAll(".platform-select-item"),e=[];return t.forEach(r=>{r.classList.contains("selected")&&e.push(r.dataset.platformId)}),e},getOrderedPlatforms(){let t=document.querySelectorAll(".platform-select-item"),e=[];return t.forEach(r=>{let n=String(r?.dataset?.platformId||"").trim();n&&e.push(n)}),e},saveCategory(){let t=document.getElementById("editCategoryName").value.trim(),e="\u{1F4F1}",r=this.getSelectedPlatforms(),n=this.getOrderedPlatforms();if(!t)return alert("\u8BF7\u8F93\u5165\u680F\u76EE\u540D\u79F0"),!1;if(r.length===0)return alert("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5E73\u53F0"),!1;let a=this.getCategoryConfig()||this.getDefaultCategoryConfig();Kt(a);let o=l.filter.getEditingFilterState();if(Mt){let i="custom-"+Date.now();a.customCategories.push({id:i,name:t,icon:e,platforms:r,isCustom:!0}),a.categoryOrder.unshift(i),a.categoryFilters[i]={mode:o.mode,keywords:[...o.keywords]}}else if(at){let i=a.customCategories.findIndex(s=>s.id===at);if(i>=0)a.customCategories[i]={...a.customCategories[i],name:t,icon:e,platforms:r};else{a.platformOrder[at]=n,Array.isArray(a.hiddenPlatforms)||(a.hiddenPlatforms=[]);let s=new Set((a.hiddenPlatforms||[]).map(d=>String(d||"").trim()).filter(Boolean));n.forEach(d=>{d&&(r.includes(d)?s.delete(d):s.add(d))}),a.hiddenPlatforms=Array.from(s)}a.categoryFilters[at]={mode:o.mode,keywords:[...o.keywords]}}return this.saveCategoryConfig(a),z=!0,this.hideEditPanel(),this.renderCategoryList(),Q=!1,this.applyCategoryListCollapseState(),!0},deleteCategory(t){if(!confirm("\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u81EA\u5B9A\u4E49\u680F\u76EE\u5417\uFF1F"))return;let e=this.getCategoryConfig()||this.getDefaultCategoryConfig();e.customCategories=e.customCategories.filter(r=>r.id!==t),e.categoryOrder=e.categoryOrder.filter(r=>r!==t),delete e.platformOrder[t],this.saveCategoryConfig(e),z=!0,this.renderCategoryList()},resetDefaultCategoryConfig(){if(!confirm("\u786E\u5B9A\u8981\u521D\u59CB\u5316\u9ED8\u8BA4\u680F\u76EE\u4E0E\u5361\u7247\u5417\uFF1F\u81EA\u5B9A\u4E49\u680F\u76EE\u5C06\u4FDD\u7559\u3002"))return;let t=this.getCategoryConfig();if(!t){this.renderCategoryList(),this.applyCategoryConfig();return}let e=this.getDefaultCategoryConfig(),r=Array.isArray(e?.categoryOrder)?e.categoryOrder:[],n=new Set(r.map(s=>String(s||"").trim()).filter(Boolean)),a=t;a.hiddenDefaultCategories=(a.hiddenDefaultCategories||[]).filter(s=>!n.has(String(s||"").trim())),a.hiddenPlatforms=[],a.platformOrder={};let o=Array.isArray(a.customCategories)?a.customCategories.map(s=>String(s?.id||"").trim()).filter(Boolean):[],i=r.slice();for(let s of o)i.includes(s)||i.push(s);a.categoryOrder=i,this.saveCategoryConfig(a),z=!0,this.renderCategoryList(),this.applyCategoryConfig()},resetCategoryConfig(){confirm("\u786E\u5B9A\u8981\u6062\u590D\u9ED8\u8BA4\u680F\u76EE\u914D\u7F6E\u5417\uFF1F\u6240\u6709\u81EA\u5B9A\u4E49\u680F\u76EE\u5C06\u88AB\u5220\u9664\u3002")&&(E.remove(Ut),L=null,D=null,this.renderCategoryList(),this.applyCategoryConfig())},applyCategoryConfig(){l.data.refreshViewerData({preserveScroll:!1})},applyCategoryConfigToData(t){let e=this.getMergedCategoryConfig();L?Object.entries(t).forEach(([c,f])=>{if(!L[c])L[c]={id:c,name:f.name,icon:f.icon,isDefault:!0,platforms:Object.keys(f.platforms||{})};else{L[c].platforms||(L[c].platforms=[]);let g=new Set(L[c].platforms||[]);Object.keys(f.platforms||{}).forEach(p=>{g.has(p)||L[c].platforms.push(p)})}Object.entries(f.platforms||{}).forEach(([g,p])=>{D[g]||(D[g]={id:g,name:p.name,defaultCategory:c,data:p})})}):(L={},D={},Object.entries(t).forEach(([c,f])=>{L[c]={id:c,name:f.name,icon:f.icon,isDefault:!0,platforms:Object.keys(f.platforms||{})},Object.entries(f.platforms||{}).forEach(([g,p])=>{D[g]={id:g,name:p.name,defaultCategory:c,data:p}})}));let r={};Object.values(t).forEach(c=>{Object.entries(c.platforms||{}).forEach(([f,g])=>{r[f]=g})});let n={},a=e.hiddenDefaultCategories||[],o=(e.hiddenPlatforms||[]).map(c=>String(c||"").trim()).filter(Boolean),i=new Set(o),s=e.categoryOrder||Object.keys(t),d=e.customCategories||[],u=e.platformOrder||{};return s.forEach(c=>{if(a.includes(c)||String(c||"").startsWith("rsscol-"))return;let f=d.find(g=>g.id===c);if(f){let g={};(f.platforms||[]).forEach(p=>{i.has(String(p||"").trim())||r[p]&&(g[p]=r[p])}),n[c]={name:f.name,icon:"\u{1F4F1}",platforms:g}}else if(t[c]){let g=t[c],p=u[c];if(p&&p.length>0){let y=[],A=new Set;p.forEach(S=>{i.has(String(S||"").trim())||g.platforms&&g.platforms[S]&&(y.push(S),A.add(S))});let _=[],k=[];Object.keys(g.platforms||{}).forEach(S=>{A.has(S)||i.has(String(S||"").trim())||(String(S||"").startsWith("rss-")?_.push(S):k.push(S))});let h=_.concat(y,k),b={};h.forEach(S=>{i.has(String(S||"").trim())||g.platforms&&g.platforms[S]&&(b[S]=g.platforms[S])}),n[c]={...g,platforms:b}}else{let y={};Object.entries(g.platforms||{}).forEach(([A,_])=>{i.has(String(A||"").trim())||(y[A]=_)}),n[c]={...g,platforms:y}}}}),Object.keys(t).forEach(c=>{String(c||"").startsWith("rsscol-")&&String(c)!=="rsscol-rss"||!n[c]&&!a.includes(c)&&(n[c]=t[c])}),n}};window.openCategorySettings=()=>O.openCategorySettings();window.closeCategorySettings=()=>O.closeCategorySettings();window.saveCategorySettings=()=>O.saveCategorySettings();window.cancelCategorySettings=()=>O.cancelCategorySettings();window.showAddCategoryPanel=()=>O.showAddCategoryPanel();window.editCategory=t=>O.editCategory(t);window.cancelEditCategory=()=>O.cancelEditCategory();window.saveCategory=()=>O.saveCategory();window.deleteCategory=t=>O.deleteCategory(t);window.resetDefaultCategoryConfig=()=>O.resetDefaultCategoryConfig();window.resetCategoryConfig=()=>O.resetCategoryConfig();window.toggleCategoryVisibility=t=>O.toggleCategoryVisibility(t);window.toggleCategoryListCollapseInSettings=()=>O.toggleCategoryListCollapseInSettings();window.toggleAllCategoriesOffInSettings=t=>O.toggleAllCategoriesOffInSettings(t);window.togglePlatformSelect=t=>O.togglePlatformSelect(t);window.bulkSelectPlatforms=t=>O.bulkSelectPlatforms(t);window.setPlatformSearchQuery=t=>O.setPlatformSearchQuery(t);l.settings=O;T(function(){let t=O.getCategoryConfig();t&&O.syncConfigToCookie(t)});var tr="hotnews_filter_keywords",er="hotnews_filter_mode_v1",st=[],Xt="exclude";function Jt(t){return t==="include"?"include":"exclude"}var ot={normalizeFilterMode:Jt,getCategoryFilterConfig(t){if(!t)return{mode:"exclude",keywords:[]};let e=l.settings.getMergedCategoryConfig(),r=e.categoryFilters&&e.categoryFilters[t],n=Jt(r&&r.mode),a=Array.isArray(r&&r.keywords)?r.keywords:[];return{mode:n,keywords:a.map(o=>String(o||"").trim().toLowerCase()).filter(Boolean)}},applyCategoryFilter(t){let e=document.getElementById(`tab-${t}`);if(!e)return;let r=this.getCategoryFilterConfig(t),n=r.mode,a=r.keywords,o=`${n}|${a.join(",")}`,s=(e.dataset?e.dataset.filterSig:null)!==o;e.dataset&&(e.dataset.filterSig=o);let d=e.dataset&&e.dataset.bulkLoading==="1";if(e.querySelectorAll(".news-item").forEach(u=>{let c=(u.textContent||"").toLowerCase(),f=a.length>0?a.some(p=>c.includes(p)):!1;(a.length===0?!1:n==="include"?!f:f)?u.classList.add("filtered"):u.classList.remove("filtered")}),n!=="include"&&e.querySelectorAll(".platform-card").forEach(u=>{u.classList.remove("platform-empty-hidden")}),n==="include"){if(a.length>0)try{if(s&&!d){if(e.querySelectorAll(".platform-card").forEach(u=>{u?.dataset&&(u.dataset.loadedDone="0")}),l.infiniteScroll&&typeof l.infiniteScroll.scheduleBulkLoadCategory=="function")l.infiniteScroll.scheduleBulkLoadCategory(t,{pageSize:40});else if(l.infiniteScroll&&typeof l.infiniteScroll.scheduleEnsureCategoryLoaded=="function"){let u=e.querySelectorAll(".platform-card").length;l.infiniteScroll.scheduleEnsureCategoryLoaded(t,{cap:u,maxPagesPerCard:2})}}}catch{}e.querySelectorAll(".platform-card").forEach(u=>{let c=u?.dataset?.loadedDone==="1",f=!c||u?.dataset?.loading==="1";if(a.length>0&&f){u.classList.add("platform-empty-hidden");return}u.classList.remove("platform-empty-hidden"),u.querySelectorAll(".news-item:not(.filtered):not(.search-hidden):not(.paged-hidden)").length<=0&&c&&u.classList.add("platform-empty-hidden")})}try{let u=e.querySelector(".category-empty-state");if(u)if(n==="include"&&a.length>0){let c=Array.from(e.querySelectorAll(".platform-card")),f=c.length>0&&c.every(p=>p?.dataset?.loadedDone==="1"&&p?.dataset?.loading!=="1"),g=e.querySelectorAll(".platform-card:not(.platform-empty-hidden)").length;u.style.display=f&&g===0?"block":"none"}else u.style.display="none"}catch{}l.counts.updateAllCounts(),l.paging&&typeof l.paging.scheduleAutofillActiveTab=="function"&&l.paging.scheduleAutofillActiveTab()},applyCategoryFilterForActiveTab(){let e=document.querySelector(".category-tabs .category-tab.active")?.dataset?.category;e&&this.applyCategoryFilter(e)},setCategoryFilterEditorState(t,e){Xt=Jt(t),st=(Array.isArray(e)?e:[]).map(a=>String(a||"").trim().toLowerCase()).filter(Boolean);let r=document.getElementById("categoryFilterModeToggle");r&&(r.checked=Xt==="include");let n=document.getElementById("categoryFilterInput");n&&(n.value=""),this.renderCategoryFilterTags()},handleCategoryFilterModeToggle(t){Xt=t&&t.checked?"include":"exclude"},handleCategoryFilterKeypress(t){t.key==="Enter"&&this.addCategoryFilterKeyword()},addCategoryFilterKeyword(){let t=document.getElementById("categoryFilterInput"),e=(t?.value||"").trim().toLowerCase();e&&(st.includes(e)||(st.push(e),this.renderCategoryFilterTags()),t&&(t.value=""))},removeCategoryFilterKeyword(t){st=st.filter(e=>e!==t),this.renderCategoryFilterTags()},renderCategoryFilterTags(){let t=document.getElementById("categoryFilterTags");t&&(t.innerHTML=st.map(e=>`<span class="filter-tag">${C(e)}<span class="filter-remove" onclick="removeCategoryFilterKeyword('${C(e)}')">\xD7</span></span>`).join(""))},getEditingFilterState(){return{mode:Xt,keywords:[...st]}},migrateLegacyGlobalFilter(){let t=E.getRaw(tr),e=E.getRaw(er);if(!t&&!e)return;let r=[];try{r=t?JSON.parse(t):[]}catch{r=[]}Array.isArray(r)||(r=[]),r=r.map(s=>String(s||"").trim().toLowerCase()).filter(Boolean);let n=Jt(e),a=l.settings.getCategoryConfig()||l.settings.getDefaultCategoryConfig();l.settings.ensureCategoryFilters(a),(l.settings.getMergedCategoryConfig().categoryOrder||[]).forEach(s=>{a.categoryFilters[s]||(a.categoryFilters[s]={mode:n,keywords:[...r]})}),l.settings.saveCategoryConfig(a),E.remove(tr),E.remove(er)}};window.handleCategoryFilterModeToggle=t=>ot.handleCategoryFilterModeToggle(t);window.handleCategoryFilterKeypress=t=>ot.handleCategoryFilterKeypress(t);window.addCategoryFilterKeyword=()=>ot.addCategoryFilterKeyword();window.removeCategoryFilterKeyword=t=>ot.removeCategoryFilterKeyword(t);l.filter=ot;T(function(){ot.migrateLegacyGlobalFilter(),ot.applyCategoryFilterForActiveTab()});var wt="hotnews_active_tab",rr="hotnews_viewer_pos_v1";var yn="tr_tab_switched",wn="tr_explore_modal_opened",bn="tr_explore_modal_closed",it=null,he=0;function nr(t,e){try{let r=String(t||"").trim();if(!r)return;let n={activeTab:r,scrollY:Number(e||0)||0,updatedAt:Date.now()};E.setRaw(rr,JSON.stringify(n))}catch{}}function Sn(){try{let t=tt.getActiveTabId();it=t?String(t):null,he=window.scrollY||0;try{let e=it?document.querySelector(`#tab-${it} .platform-grid`):null;it&&e&&l.scroll.recordPlatformGridScrollForTab(it,e)}catch{}}catch{}}function Cn(){try{let t=E.getRaw(rr);if(!t)return;let e=JSON.parse(t),r=String(e?.activeTab||"").trim();if(!r)return;let n=window.CSS&&typeof window.CSS.escape=="function"?window.CSS.escape(String(r)):String(r);if(!document.querySelector(`.category-tab[data-category="${n}"]`))return;tt.switchTab(r);let o=Number(e?.scrollY||0)||0;requestAnimationFrame(()=>{try{window.scrollTo({top:o,behavior:"auto"})}catch{}})}catch{}}function vn(){let t=it,e=he;if(it=null,he=0,!!t){try{let r=window.CSS&&typeof window.CSS.escape=="function"?window.CSS.escape(String(t)):String(t),n=document.querySelector(`.category-tab[data-category="${r}"]`),a=document.getElementById(`tab-${t}`);if(!n||!a)return}catch{}try{l.tabs.switchTab(t)}catch{}nr(t,e),requestAnimationFrame(()=>{try{window.scrollTo({top:e,behavior:"auto"})}catch{}try{l.scroll.restoreActiveTabPlatformGridScroll({preserveScroll:!0,activeTab:t})}catch{}})}}var tt={TAB_STORAGE_KEY:wt,switchTab(t){l.badges.dismissNewCategoryBadge(t),document.body.classList.toggle("tr-rss-reading",String(t)==="rsscol-rss");let e=window.CSS&&typeof window.CSS.escape=="function"?window.CSS.escape(String(t)):String(t),r=document.querySelector(`.category-tab[data-category="${e}"]`),n=document.getElementById(`tab-${t}`);if(!r||!n){let i=document.querySelector(".category-tab");i?.dataset?.category&&i.dataset.category!==String(t)?this.switchTab(i.dataset.category):E.remove(wt);return}let a=r.querySelector(".update-dot.show"),o=!!a;a&&a.classList.remove("show"),document.querySelectorAll(".category-tab").forEach(i=>i.classList.remove("active")),r.classList.add("active"),document.querySelectorAll(".tab-pane").forEach(i=>i.classList.remove("active")),n.classList.add("active"),E.setRaw(wt,t);try{window.dispatchEvent(new CustomEvent(yn,{detail:{categoryId:t,hasUpdate:o}}))}catch{}nr(t,window.scrollY||0),l.scroll.restoreActiveTabPlatformGridScroll({preserveScroll:!0,activeTab:t}),t==="sports"&&(l.badges.markFeatureSeen("sports-nba-schedule"),l.badges.updateNewBadges()),l.filter.applyCategoryFilter(t),l.paging&&typeof l.paging.scheduleAutofillActiveTab=="function"&&l.paging.scheduleAutofillActiveTab({force:!0,maxSteps:1});try{let i=!!n.querySelector(".news-item"),s=!!n.querySelector(".news-placeholder");!i&&s&&(l.infiniteScroll&&typeof l.infiniteScroll.scheduleBulkLoadCategory=="function"?l.infiniteScroll.scheduleBulkLoadCategory(t):l.infiniteScroll&&typeof l.infiniteScroll.scheduleEnsureCategoryLoaded=="function"&&l.infiniteScroll.scheduleEnsureCategoryLoaded(t))}catch{}},restoreActiveTab(){let t=E.getRaw(wt);if(t){try{if(new URLSearchParams(window.location.search).get("e2e")==="1"&&String(t)==="rsscol-rss"){E.remove(wt);return}}catch{}document.querySelector(`.category-tab[data-category="${t}"]`)&&this.switchTab(t)}},getActiveTabId(){return E.getRaw(wt)||document.querySelector(".category-tab.active")?.dataset?.category||null},restoreActiveTabPlatformGridScroll(t){l.scroll.restoreActiveTabPlatformGridScroll(t)},attachPlatformGridScrollPersistence(){l.scroll.attachPlatformGridScrollPersistence()}};window.switchTab=t=>tt.switchTab(t);l.tabs=tt;T(function(){try{window.addEventListener(wn,()=>{Sn()}),window.addEventListener(bn,()=>{vn()})}catch{}tt.restoreActiveTab(),Cn(),tt.attachPlatformGridScrollPersistence();let t=tt.getActiveTabId();t&&tt.restoreActiveTabPlatformGridScroll({preserveScroll:!0,activeTab:t})});var ye="hotnews_active_tab",vt=window.SYSTEM_SETTINGS?.display?.items_per_card||20,we=!1,_n=0,bt=null,En=null,ar=!1,St=null;function xn(t){let r=t?.closest?.(".tab-pane")?.id||"";return r.startsWith("tab-")?r.slice(4):null}function An(t,e){let n=String(e||"").trim().startsWith("rss-");return`${n?'<button type="button" class="tr-platform-card-delete" data-action="delete-platform">\u2212</button>':""}${n?"":'<button type="button" class="tr-platform-card-hide" data-action="hide-platform">\u{1F648}</button>'}`}function Tn(t){let e=Math.max(0,Number(t||0)||0),r="";for(let n=0;n<e;n++)r+='<li class="tr-news-skeleton" aria-hidden="true"><div class="tr-news-skeleton-line"></div></li>';return r}function Ln(t,e,r){let n=document.createElement("li");n.className="news-item",n.dataset.newsId=String(t?.stable_id||""),n.dataset.newsTitle=String(t?.display_title||t?.title||"");let a=document.createElement("div");a.className="news-item-content";let o=document.createElement("input");o.type="checkbox",o.className="news-checkbox",o.title="\u6807\u8BB0\u5DF2\u8BFB",o.addEventListener("change",()=>{try{window.markAsRead(o)}catch{}});let i=document.createElement("span");i.className="news-index",i.textContent=String(e);let s=document.createElement("a");if(s.className="news-title",t?.is_cross_platform&&s.classList.add("cross-platform"),s.href=String(t?.url||"#"),s.target="_blank",s.rel="noopener noreferrer",s.setAttribute("onclick","handleTitleClickV2(this, event)"),s.setAttribute("onauxclick","handleTitleClickV2(this, event)"),s.setAttribute("oncontextmenu","handleTitleClickV2(this, event)"),s.setAttribute("onkeydown","handleTitleKeydownV2(this, event)"),s.textContent=String(t?.display_title||t?.title||""),t?.is_cross_platform){let f=Array.isArray(t?.cross_platforms)?t.cross_platforms:[],g=document.createElement("span");g.className="cross-platform-badge",g.title=`\u540C\u65F6\u51FA\u73B0\u5728: ${f.join(", ")}`,g.textContent=`\u{1F525} ${String(t?.cross_platform_count??"")}`,s.appendChild(document.createTextNode(" ")),s.appendChild(g)}a.appendChild(o),a.appendChild(i),a.appendChild(s);let d=ht(t?.timestamp);if(d){let f=document.createElement("span");f.className="tr-news-date",f.style.marginLeft="8px",f.style.color="#9ca3af",f.style.fontSize="12px",f.style.whiteSpace="nowrap",f.textContent=d,a.appendChild(f)}n.appendChild(a);let u=String(t?.meta||"").trim(),c=String(r||"").startsWith("rss-");if(u&&!c){let f=document.createElement("div");f.className="news-subtitle",f.textContent=u,n.appendChild(f)}try{let f=l.readState?.getReadNews?.()||{};n.dataset.newsId&&f[n.dataset.newsId]&&(n.classList.add("read"),o.checked=!0)}catch{}return n}async function kn(t){if(!t||!(t instanceof Element)||String(t?.dataset?.lazy||"")!=="1"||String(t?.dataset?.loading||"")==="1")return;let e=t.closest(".tab-pane");if(!e||!e.classList.contains("active"))return;let r=String(t.dataset.platform||"").trim();if(r){t.dataset.loading="1";try{let n=`/api/news/page?platform_id=${encodeURIComponent(r)}&offset=0&page_size=${encodeURIComponent(String(vt))}`,a=await fetch(n);if(!a.ok)return;let o=await a.json(),i=Array.isArray(o?.items)?o.items:[],s=t.querySelector(".news-list");if(!s)return;s.querySelectorAll(".tr-news-skeleton").forEach(c=>c.remove()),s.querySelectorAll(".news-placeholder").forEach(c=>c.remove()),s.querySelectorAll(".news-item").forEach(c=>c.remove());let d=i.slice(0,vt);for(let c=0;c<d.length;c++)s.appendChild(Ln(d[c],c+1,r));let u=s.querySelectorAll(".news-item").length;t.dataset.loadedCount=String(u),t.dataset.hasMore="0",t.dataset.loadedDone="1",t.dataset.lazy="0";try{l.paging&&(l.paging.setCardPageSize(t,Math.min(vt,Math.max(1,u||vt))),l.paging.applyPagingToCard(t,0))}catch{}try{l.counts?.updatePlatformCount&&l.counts.updatePlatformCount(t),l.counts?.updateAllCounts&&l.counts.updateAllCounts()}catch{}try{l.search?.searchNews?.()}catch{}try{let c=l.tabs?.getActiveTabId?.()||null;c&&l.filter?.applyCategoryFilter?.(c)}catch{}}catch{}finally{t.dataset.loading="0"}}}function sr(){try{St&&(St.disconnect(),St=null)}catch{}St=new IntersectionObserver(t=>{for(let e of t){if(!e.isIntersecting)continue;let r=e.target;if(!(!r||!(r instanceof Element))){if(String(r?.dataset?.lazy||"")!=="1"){try{St?.unobserve?.(r)}catch{}continue}kn(r).catch(()=>{})}}},{root:null,rootMargin:"0px 200px 0px 200px",threshold:.15}),document.querySelectorAll('.platform-card[data-lazy="1"]').forEach(t=>{try{St.observe(t)}catch{}})}var Ct=null,lt=null;function or(t,e,r){return new Promise(n=>{if(lt)try{lt(!1)}catch{}if(lt=n,!Ct){let a=document.createElement("div");a.className="tr-confirm-overlay",a.innerHTML=`
                <div class="tr-confirm-modal" role="dialog" aria-modal="true">
                    <div class="tr-confirm-message"></div>
                    <div class="tr-confirm-actions">
                        <button type="button" class="tr-confirm-btn tr-confirm-cancel" data-action="cancel"></button>
                        <button type="button" class="tr-confirm-btn tr-confirm-ok" data-action="ok"></button>
                    </div>
                </div>`,a.addEventListener("click",o=>{let i=o?.target;if(!i||!(i instanceof Element))return;let s=i.closest('button[data-action="ok"]'),d=i.closest('button[data-action="cancel"]');if(s){o.preventDefault(),a.classList.remove("show");let u=lt;lt=null,u?.(!0);return}if(d||i===a){o.preventDefault(),a.classList.remove("show");let u=lt;lt=null,u?.(!1)}}),document.body.appendChild(a),Ct=a}try{let a=Ct.querySelector(".tr-confirm-message");a&&(a.textContent=String(t||""));let o=Ct.querySelector('button[data-action="ok"]');o&&(o.textContent=String(e||"\u786E\u8BA4"));let i=Ct.querySelector('button[data-action="cancel"]');i&&(i.textContent=String(r||"\u53D6\u6D88"))}catch{}Ct.classList.add("show")})}async function Pn(t){let e=String(t||"").trim();if(!e)return!1;try{let r=await fetch("/api/me/rss-subscriptions",{method:"GET"});if(!r.ok)return!1;let n=await r.json().catch(()=>({}));return!(Array.isArray(n?.subscriptions)?n.subscriptions:[]).some(i=>String(i?.source_id||i?.rss_source_id||"").trim()===e)}catch{return!1}}async function Mn(t){let e=String(t||"").trim();if(!e.startsWith("rss-"))return!1;let r=e.slice(4);if(!r||!l.subscription)return!1;try{l.subscription.ensureSnapshot?.()}catch{}let n=[];try{n=l.subscription.getSubscriptions?l.subscription.getSubscriptions():[]}catch{n=[]}let a=(Array.isArray(n)?n:[]).filter(o=>String(o?.source_id||o?.rss_source_id||"").trim()!==r);try{l.subscription.setSubscriptions?.(a)}catch{return!1}try{l.subscription.saveOnly?await l.subscription.saveOnly():l.subscription.saveAndRefresh&&await l.subscription.saveAndRefresh()}catch{return!1}return await Pn(r)}async function On(t){if(!t||!(t instanceof Element))return;let e=xn(t),r=String(t.getAttribute("data-platform")||"").trim();if(!e||!r||e==="explore"||!r.startsWith("rss-"))return;try{let s=!0;try{new URLSearchParams(window.location.search).get("e2e")==="1"&&(s=!1)}catch{}try{typeof navigator<"u"&&navigator.webdriver===!0&&(s=!1)}catch{}if(s&&!await or("\u786E\u5B9A\u8981\u5220\u9664\u8BE5 RSS \u5361\u7247\u5417\uFF1F\u5220\u9664\u540E\u5C06\u53D6\u6D88\u8BA2\u9605\u3002","\u786E\u8BA4\u5220\u9664","\u53D6\u6D88"))return}catch{}try{let s=t.querySelector('button[data-action="delete-platform"]');s&&s.setAttribute("disabled","true")}catch{}let a=t.parentNode,o=t.nextSibling;try{a&&a.removeChild(t)}catch{}try{l.counts?.updateAllCounts?.()}catch{}if(!await Mn(r)){try{a&&(o?a.insertBefore(t,o):a.appendChild(t))}catch{}try{let s=t.querySelector('button[data-action="delete-platform"]');s&&s.removeAttribute("disabled")}catch{}try{l.toast?.show?.("\u5220\u9664\u5931\u8D25\uFF1A\u8BA2\u9605\u672A\u80FD\u4ECE\u670D\u52A1\u7AEF\u79FB\u9664\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",{variant:"error",durationMs:2500})}catch{}return}try{l.counts?.updateAllCounts?.(),l.readState?.updateReadCount?.()}catch{}}var Zt={formatUpdatedAt:Yt,snapshotViewerState(){let t=E.getRaw(ye)||document.querySelector(".category-tab.active")?.dataset?.category||null,e={};document.querySelectorAll(".platform-card").forEach(i=>{let s=i.dataset.platform;s&&(e[s]=parseInt(i.dataset.pageOffset||"0",10)||0)});let r=t?document.querySelector(`#tab-${t} .platform-grid`):null,n=r&&r.scrollLeft||0,a=null,o=0;if(r){let i=r.scrollLeft||0,s=null,d=r.querySelectorAll(".platform-card");for(let u of d)if((u.offsetLeft||0)<=i+1)s=u;else break;s?.dataset?.platform&&(a=s.dataset.platform,o=Math.max(0,i-(s.offsetLeft||0)))}return t&&r&&l.scroll.recordPlatformGridScrollForTab(t,r),{activeTab:t,pagingOffsets:e,activeTabPlatformGridScrollLeft:n,activeTabPlatformAnchorPlatformId:a,activeTabPlatformAnchorOffsetX:o,showReadMode:document.body.classList.contains("show-read-mode"),scrollY:window.scrollY||0,searchText:document.getElementById("searchInput")?.value||""}},renderViewerFromData(t,e){let r=document.querySelector(".tab-content-area"),n=document.querySelector(".category-tabs");if(!n||!r)return;let a="";try{let h=document.getElementById("tab-knowledge"),b=h?h.querySelector(".platform-grid"):null,S=!!(b&&b.querySelector(".tr-morning-brief-card")),N=!!(b&&b.querySelector(".news-item"));S&&N&&(a=String(b.innerHTML||""))}catch{a=""}let o=l.settings.applyCategoryConfigToData(t?.categories||{});En=o;let i=e&&typeof e.activeTab=="string"?e.activeTab:null,s=(()=>{try{return new URLSearchParams(window.location.search).get("e2e")==="1"}catch{return!1}})(),d=Object.keys(o||{}),u=d[0]||null;u==="explore"&&(u=d.find(h=>h!=="explore")||u),s&&u==="rsscol-rss"&&(u=d.find(h=>h!=="rsscol-rss")||u);let c=i||u;c==="explore"&&(c=d.find(h=>h!=="explore")||c),s&&c==="rsscol-rss"&&(c=d.find(h=>h!=="rsscol-rss")||c);let f=Object.entries(o).map(([h,b])=>{let S=C(b?.icon||""),N=C(b?.name||h),$=`${b?.is_new?`<span class="new-badge new-badge-category" data-category="${C(h)}">NEW</span>`:""}${h==="sports"?'<span class="new-badge" id="newBadgeSportsTab" style="display:none;">NEW</span>':""}`;return`
            <div class="category-tab${String(h)===String(c)?" active":""}" data-category="${C(h)}" draggable="false" onclick="switchTab('${C(h)}')">
                <span class="category-drag-handle" title="\u62D6\u62FD\u8C03\u6574\u680F\u76EE\u987A\u5E8F" draggable="true">\u2630</span>
                <div class="category-tab-icon">${S}</div>
                <div class="category-tab-name">${N}${$}</div>
            </div>`}).join(""),g=Object.entries(o).map(([h,b])=>{let S=!!c&&String(h)===String(c),N=S?" active":"";if(String(h)==="rsscol-rss")return`
                <div class="tab-pane${N}" id="tab-${C(h)}">
                    <div class="platform-grid" style="display:flex;flex-direction:column;gap:10px;min-height:0;">
                        
                    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
                        <div id="rssCategoryCarouselStatus" style="color:#6b7280;font-size:0.85rem;flex:1;min-width:200px;"></div>
                    </div>
                        <div id="rssCategoryCarouselGrid" style="display:flex;flex-direction:column;gap:10px;min-height:0;"></div>
                    </div>
                    <div class="category-empty-state" style="display:none;" aria-hidden="true">\u6CA1\u6709\u5339\u914D\u5185\u5BB9\uFF0C\u8BF7\u8C03\u6574\u5173\u952E\u8BCD\u6216\u5207\u6362\u6A21\u5F0F</div>
                </div>`;if(String(h)==="explore")return`
                <div class="tab-pane${N}" id="tab-${C(h)}">
                    <div class="platform-grid" id="trExploreGrid"></div>
                </div>`;if(String(h)==="knowledge"){let m=a||`
                    <div class="platform-card tr-morning-brief-card" data-platform="mb-slice-1" data-page-size="50" draggable="false">
                        <div class="platform-header">
                            <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">\u{1F552} \u6700\u65B0 1-50</div>
                            <div class="platform-header-actions"></div>
                        </div>
                        <ul class="news-list" data-mb-list="slice1">
                            <li class="news-placeholder" aria-hidden="true">\u52A0\u8F7D\u4E2D...</li>
                        </ul>
                    </div>

                    <div class="platform-card tr-morning-brief-card" data-platform="mb-slice-2" data-page-size="50" draggable="false">
                        <div class="platform-header">
                            <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">\u2B50 \u6700\u65B0 51-100</div>
                            <div class="platform-header-actions"></div>
                        </div>
                        <ul class="news-list" data-mb-list="slice2">
                            <li class="news-placeholder" aria-hidden="true">\u52A0\u8F7D\u4E2D...</li>
                        </ul>
                    </div>

                    <div class="platform-card tr-morning-brief-card" data-platform="mb-slice-3" data-page-size="50" draggable="false">
                        <div class="platform-header">
                            <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">\u{1F9FE} \u6700\u65B0 101-150</div>
                            <div class="platform-header-actions"></div>
                        </div>
                        <ul class="news-list" data-mb-list="slice3">
                            <li class="news-placeholder" aria-hidden="true">\u52A0\u8F7D\u4E2D...</li>
                        </ul>
                    </div>
                `;return`
                <div class="tab-pane${N}" id="tab-${C(h)}">
                    <div class="platform-grid" data-mb-injected="1">${m}</div>
                </div>`}let Z=b?.platforms||{},P=Object.keys(Z||{}),$=S&&e?.activeTabPlatformAnchorPlatformId||null,et=$?P.indexOf($):-1,Vt=3,de=P.map((m,v)=>{let w=Z?.[m];if(!w)return"";let x=C(w?.name||m),R=w?.is_new?`<span class="new-badge new-badge-platform" data-platform="${C(m)}">NEW</span>`:"",I=Array.isArray(w?.news)?w.news:[],B=I.length,rt=S&&(et<0?v<3:v>=et-Vt&&v<=et+Vt),W=!rt,pt=rt?Math.min(B,vt):0,U=m&&e?.pagingOffsets&&Number.isFinite(e.pagingOffsets[m])?e.pagingOffsets[m]:0,K=I.slice(0,pt),fe=W?Tn(8):K.map((j,ue)=>{let Ur=C(j?.stable_id||""),Be=C(j?.display_title||j?.title||""),Kr=C(j?.url||""),Fe=C(j?.meta||""),Xr=String(m||"").startsWith("rss-"),qe=!!j?.is_cross_platform,Jr=Array.isArray(j?.cross_platforms)?j.cross_platforms:[],Zr=C(Jr.join(", ")),Qr=C(j?.cross_platform_count??""),tn=qe?`<span class="cross-platform-badge" title="\u540C\u65F6\u51FA\u73B0\u5728: ${Zr}">\u{1F525} ${Qr}</span>`:"",en=qe?"cross-platform":"",rn='<input type="checkbox" class="news-checkbox" title="\u6807\u8BB0\u5DF2\u8BFB" onchange="markAsRead(this)" />',nn=`<span class="news-index">${String(ue+1)}</span>`,an=ue<U||ue>=U+vt?" paged-hidden":"",sn=Fe&&!Xr?`<div class="news-subtitle">${Fe}</div>`:"",on=Kr||"#",He=ht(j?.timestamp),ln=He?`<span class="tr-news-date" style="margin-left:8px;color:#9ca3af;font-size:12px;white-space:nowrap;">${C(He)}</span>`:"";return`
                        <li class="news-item${an}" data-news-id="${Ur}" data-news-title="${Be}">
                            <div class="news-item-content">
                                ${rn}
                                ${nn}
                                <a class="news-title ${en}" href="${on}" target="_blank" rel="noopener noreferrer" onclick="handleTitleClickV2(this, event)" onauxclick="handleTitleClickV2(this, event)" oncontextmenu="handleTitleClickV2(this, event)" onkeydown="handleTitleKeydownV2(this, event)">
                                    ${Be}
                                    ${tn}
                                </a>
                                ${ln}
                            </div>
                            ${sn}
                        </li>`}).join(""),zt=An(h,m);return`
                <div class="platform-card" data-platform="${C(m)}" data-total-count="${String(B)}" data-loaded-count="${String(pt)}" data-lazy="${W?"1":"0"}" data-loaded-done="${W?"0":"1"}" draggable="false">
                    <div class="platform-header">
                        <span class="platform-drag-handle" title="\u62D6\u62FD\u8C03\u6574\u5E73\u53F0\u987A\u5E8F" draggable="true">\u2630</span>
                        <div class="platform-name" style="margin-bottom: 0; padding-bottom: 0; border-bottom: none; cursor: pointer;" onclick="dismissNewPlatformBadge('${C(m)}')">\u{1F4F1} ${x}${R}</div>
                        <div class="platform-header-actions">${zt}</div>
                    </div>
                    <ul class="news-list">${fe}
                    </ul>
                    <div class="news-load-sentinel" aria-hidden="true"></div>
                </div>`}).filter(Boolean).join("");return`
            <div class="tab-pane${N}" id="tab-${C(h)}">
                <div class="platform-grid">${de}
                </div>
                <div class="category-empty-state" style="display:none;" aria-hidden="true">\u6CA1\u6709\u5339\u914D\u5185\u5BB9\uFF0C\u8BF7\u8C03\u6574\u5173\u952E\u8BCD\u6216\u5207\u6362\u6A21\u5F0F</div>
            </div>`}).join("");n.innerHTML=f,r.innerHTML=g;try{let h=!!window.matchMedia&&window.matchMedia("(max-width: 640px)").matches,b=n.querySelectorAll(".category-tab").length;h?n.classList.remove("compact"):n.classList.toggle("compact",b>8)}catch{}let p=document.getElementById("updatedAt");p&&t?.updated_at&&(p.textContent=Yt(t.updated_at));let y=e&&typeof e.activeTab=="string"?e.activeTab:null;if(y){let h=window.CSS&&typeof window.CSS.escape=="function"?window.CSS.escape(y):y;if(document.querySelector(`.category-tab[data-category="${h}"]`))l.tabs.switchTab(y);else{let S=document.querySelector(".category-tab");S?.dataset?.category?l.tabs.switchTab(S.dataset.category):E.remove(ye)}}else{let h=document.querySelector(".category-tab");h?.dataset?.category?l.tabs.switchTab(h.dataset.category):E.remove(ye)}let A=typeof e?.showReadMode=="boolean"?e.showReadMode:l.readState.getShowReadModePref();l.readState.applyShowReadMode(A);let _=document.getElementById("searchInput");_&&typeof e?.searchText=="string"&&(_.value=e.searchText),l.search.searchNews(),l.filter.applyCategoryFilterForActiveTab(),l.readState.restoreReadState(),document.querySelectorAll(".platform-card").forEach(h=>{let b=h.dataset.platform,S=b&&e?.pagingOffsets&&Number.isFinite(e.pagingOffsets[b])?e.pagingOffsets[b]:0;l.paging.setCardPageSize(h,l.paging.PAGE_SIZE),l.paging.applyPagingToCard(h,S)}),l.counts.updateAllCounts(),l.readState.updateReadCount(),l.scroll.restoreActiveTabPlatformGridScroll(e),l.scroll.attachPlatformGridScrollPersistence();let k=document.getElementById("early-hide");k&&k.remove(),document.body.classList.add("categories-ready"),l.paging.scheduleAutofillActiveTab({force:!0,maxSteps:1}),sr();try{l.infiniteScroll&&typeof l.infiniteScroll.attach=="function"&&l.infiniteScroll.attach()}catch{}},async refreshViewerData(t={}){let e=t.preserveScroll!==!1;if(we){bt?bt.preserveScroll=bt.preserveScroll&&e:bt={preserveScroll:e};return}we=!0;try{let r=this.snapshotViewerState();r.preserveScroll=e;let a=await(await fetch("/api/news")).json();this.renderViewerFromData(a,r),r.preserveScroll&&(window.scrollTo({top:r.scrollY,behavior:"auto"}),l.scroll.restoreActiveTabPlatformGridScroll(r)),_n=Date.now()}catch(r){console.error("refreshViewerData error:",r)}finally{we=!1;let r=bt;bt=null,r&&this.refreshViewerData({preserveScroll:r.preserveScroll})}},async fetchData(){let t=document.getElementById("fetchBtn"),e=document.getElementById("progressContainer"),r=document.getElementById("progressBar"),n=document.getElementById("fetchStatus");t.classList.add("loading"),t.disabled=!0,e.classList.add("show"),r.classList.add("indeterminate"),n.className="fetch-status",n.textContent="\u6B63\u5728\u83B7\u53D6\u6570\u636E...";try{let o=await(await fetch("/api/fetch",{method:"POST"})).json();r.classList.remove("indeterminate"),o.success?(r.style.width="100%",n.className="fetch-status success",n.textContent=`\u2705 ${o.platforms} \u4E2A\u5E73\u53F0\uFF0C${o.news_count} \u6761\u65B0\u95FB`,setTimeout(()=>this.refreshViewerData({preserveScroll:!0}),300)):(r.style.width="0%",n.className="fetch-status error",n.textContent=`\u274C ${o.error}`)}catch(a){r.classList.remove("indeterminate"),r.style.width="0%",n.className="fetch-status error",n.textContent=`\u274C ${a.message}`}finally{t.classList.remove("loading"),t.disabled=!1,setTimeout(()=>{e.classList.remove("show"),r.style.width="0%"},5e3)}},setupAjaxAutoRefresh(){let e=async()=>{if(document.visibilityState==="visible")try{let r=await fetch("/api/news/check-updates");if(!r.ok)return;let n=await r.json();if(n.categories)for(let[a,o]of Object.entries(n.categories))o&&this.showCategoryUpdateDot(a)}catch{}};setInterval(e,3e5),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&setTimeout(e,2e3)})},showCategoryUpdateDot(t){let e=document.querySelector(`.category-tab[data-category="${t}"]`);if(!e)return;let r=e.querySelector(".update-dot");r||(r=document.createElement("span"),r.className="update-dot",e.style.position="relative",e.appendChild(r)),r.classList.add("show")},hideCategoryUpdateDot(t){let e=document.querySelector(`.category-tab[data-category="${t}"]`);if(!e)return;let r=e.querySelector(".update-dot");r&&r.classList.remove("show")}};window.fetchData=()=>Zt.fetchData();window.refreshViewerData=t=>Zt.refreshViewerData(t);l.data=Zt;T(function(){let t=document.getElementById("updatedAt");t&&t.textContent&&(t.textContent=Yt(t.textContent)),Zt.setupAjaxAutoRefresh(),ar||(ar=!0,document.addEventListener("click",e=>{let r=e?.target;if(!r||!(r instanceof Element))return;let n=r.closest('button[data-action="delete-platform"]');if(!n)return;let a=n.closest(".platform-card");a&&On(a).catch(()=>{})}),document.addEventListener("click",async e=>{let r=e?.target;if(!r||!(r instanceof Element))return;let n=r.closest('button[data-action="hide-platform"]');if(!n)return;let a=n.closest(".platform-card"),o=String(a?.getAttribute?.("data-platform")||"").trim();if(!(!o||o.startsWith("rss-")||!await or("\u786E\u5B9A\u8981\u9690\u85CF\u8BE5\u5361\u7247\u5417\uFF1F\u9690\u85CF\u540E\u8BE5\u5361\u7247\u5C06\u4E0D\u518D\u663E\u793A\uFF0C\u4F60\u53EF\u4EE5\u5728\u300C\u680F\u76EE\u8BBE\u7F6E\u300D\u4E2D\u91CD\u65B0\u52FE\u9009\u5E76\u4FDD\u5B58\u6765\u6062\u590D\u663E\u793A\u3002","\u786E\u8BA4\u9690\u85CF","\u53D6\u6D88"))){try{n.setAttribute("disabled","true")}catch{}try{l.settings?.togglePlatformHidden?.(o)}catch{}}})),sr()});var Qt=window.SYSTEM_SETTINGS?.display?.items_per_card||20,Rn="240px 0px 240px 0px",F=window.SYSTEM_SETTINGS?.display?.items_per_card||20,Rt=null,be=!1,It=0,In=1,ir=0,Nn=600,te=null,Nt=null,Dn=160,ee=null,Dt=null,$n=250;function Bn(){return document.querySelector(".category-tabs .category-tab.active")?.dataset?.category||null}function Se(t,e){try{let r=t?.querySelector?.(".news-list");if(!r)return;let n=r.querySelector(".news-placeholder");n||(n=document.createElement("li"),n.className="news-placeholder",n.setAttribute("aria-hidden","true"),r.appendChild(n)),n.textContent=String(e||"")}catch{}}function lr(){if(clearTimeout(te),te=null,Nt){try{Nt.abort()}catch{}Nt=null}try{document.querySelectorAll(".platform-card").forEach(t=>{let e=t?.querySelector?.(".news-list");if(!e)return;let r=e.querySelector(".news-placeholder");!r||e.querySelectorAll(".news-item").length>0||(r.textContent||"").includes("\u52A0\u8F7D\u4E2D")&&(r.textContent="\u5F85\u52A0\u8F7D...")})}catch{}}function Fn(t,e={}){lr(),Nt=new AbortController;let r=Nt.signal;te=setTimeout(()=>{te=null,fr(t,{...e,signal:r}).catch(()=>{})},Dn)}function cr(){if(clearTimeout(ee),ee=null,Dt){try{Dt.abort()}catch{}Dt=null}}function qn(t,e,r){let n=document.createElement("li");n.className="news-item",n.dataset.newsId=String(t?.stable_id||""),n.dataset.newsTitle=String(t?.display_title||t?.title||"");let a=document.createElement("div");a.className="news-item-content";let o=document.createElement("input");o.type="checkbox",o.className="news-checkbox",o.title="\u6807\u8BB0\u5DF2\u8BFB",o.addEventListener("change",()=>{try{window.markAsRead(o)}catch{}});let i=document.createElement("span");i.className="news-index",i.textContent=String(e);let s=document.createElement("a");if(s.className="news-title",t?.is_cross_platform&&s.classList.add("cross-platform"),s.href=String(t?.url||"#"),s.target="_blank",s.rel="noopener noreferrer",s.setAttribute("onclick","handleTitleClickV2(this, event)"),s.setAttribute("onauxclick","handleTitleClickV2(this, event)"),s.setAttribute("oncontextmenu","handleTitleClickV2(this, event)"),s.setAttribute("onkeydown","handleTitleKeydownV2(this, event)"),s.textContent=String(t?.display_title||t?.title||""),t?.is_cross_platform){let f=Array.isArray(t?.cross_platforms)?t.cross_platforms:[],g=document.createElement("span");g.className="cross-platform-badge",g.title=`\u540C\u65F6\u51FA\u73B0\u5728: ${f.join(", ")}`,g.textContent=`\u{1F525} ${String(t?.cross_platform_count??"")}`,s.appendChild(document.createTextNode(" ")),s.appendChild(g)}a.appendChild(o),a.appendChild(i),a.appendChild(s);let d=ht(t?.timestamp);if(d){let f=document.createElement("span");f.className="tr-news-date",f.style.marginLeft="8px",f.style.color="#9ca3af",f.style.fontSize="12px",f.style.whiteSpace="nowrap",f.textContent=d,a.appendChild(f)}n.appendChild(a);let u=String(t?.meta||"").trim(),c=String(r||"").startsWith("rss-");if(u&&!c){let f=document.createElement("div");f.className="news-subtitle",f.textContent=u,n.appendChild(f)}return mr(n),ur(n),n}async function dr(t,e={}){let r=document.getElementById(`tab-${t}`);if(!r||!r.classList.contains("active"))return;try{r.dataset&&(r.dataset.bulkLoading="1")}catch{}let n=e.signal;if(n?.aborted){try{r.dataset&&delete r.dataset.bulkLoading}catch{}return}let a=null;try{l.filter&&typeof l.filter.getCategoryFilterConfig=="function"&&(a=l.filter.getCategoryFilterConfig(t))}catch{a=null}let o=a?.mode||"exclude",i=Array.isArray(a?.keywords)?a.keywords:[],s=Number.isFinite(e.pageSize)?e.pageSize:F,d=Math.min(Math.max(1,s),F),u=Array.from(r.querySelectorAll(".platform-card")),c=u.map(p=>(p?.dataset?.platform||"").trim()).filter(Boolean);if(c.length<=0){try{r.dataset&&delete r.dataset.bulkLoading}catch{}return}for(let p of u)p&&(p.dataset.loading="1",Se(p,"\u52A0\u8F7D\u4E2D..."));let f;try{let p=await fetch(`/api/news/pages?page_size=${encodeURIComponent(String(d))}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform_ids:c}),signal:n});if(!p.ok)return;f=await p.json()}catch{return}finally{try{r.dataset&&delete r.dataset.bulkLoading}catch{}}let g=f&&f.platforms||{};for(let p of u){if(n?.aborted)return;let y=(p?.dataset?.platform||"").trim();if(!y)continue;let A=p.querySelector(".news-list");if(!A)continue;A.querySelectorAll(".news-placeholder").forEach(b=>b.remove()),A.querySelectorAll(".news-item").forEach(b=>b.remove());let _=g[y]||{},k=Array.isArray(_.items)?_.items:[];for(let b=0;b<k.length;b++)A.appendChild(qn(k[b],b+1,y));let h=A.querySelectorAll(".news-item").length;p.dataset.loadedCount=String(h),p.dataset.hasMore=_.has_more&&h<F?"1":"0",p.dataset.loading="0",p.dataset.loadedDone="1";try{if(l.paging){let b=Math.min(F,h);l.paging.setCardPageSize(p,b),l.paging.applyPagingToCard(p,0)}}catch{}l.counts?.updatePlatformCount&&l.counts.updatePlatformCount(p)}l.counts?.updateAllCounts&&l.counts.updateAllCounts();try{l.filter&&typeof l.filter.applyCategoryFilter=="function"&&l.filter.applyCategoryFilter(t)}catch{}}function Hn(t,e={}){cr(),Dt=new AbortController;let r=Dt.signal;ee=setTimeout(()=>{ee=null,dr(t,{...e,signal:r}).catch(()=>{})},$n)}async function fr(t,e={}){let r=document.getElementById(`tab-${t}`);if(!r||!r.classList.contains("active"))return;let n=e.signal;if(n?.aborted)return;let a=null;try{l.filter&&typeof l.filter.getCategoryFilterConfig=="function"&&(a=l.filter.getCategoryFilterConfig(t))}catch{a=null}let o=a?.mode||"exclude",i=Array.isArray(a?.keywords)?a.keywords:[],s=o==="include"&&i.length>0,d=Number.isFinite(e.maxPagesPerCard)?e.maxPagesPerCard:s?2:1,u=Number.isFinite(e.cap)?e.cap:s?10:4,c=Array.from(r.querySelectorAll(".platform-card")).slice(0,Math.max(0,u));for(let f of c){if(n?.aborted)return;if(!f)continue;let g=f.querySelector(".news-list");if(!g)continue;let p=g.querySelectorAll(".news-item").length;if(s&&p>0){f.dataset.loadedDone="1";continue}if(!s&&p>0){f.dataset.loadedDone="1";continue}let y=Qt;for(let A=0;A<d;A++){if(n?.aborted)return;Se(f,"\u52A0\u8F7D\u4E2D..."),await gr(f,Math.min(y,F),{signal:n});try{l.paging&&(l.paging.setCardPageSize(f,Math.min(y,F)),l.paging.applyPagingToCard(f,0))}catch{}let _=f.querySelectorAll(".news-item:not(.filtered):not(.search-hidden):not(.paged-hidden)").length;if(!s||_>0||!(f.dataset.hasMore!=="0"))break;y+=Qt}f.dataset.loadedDone="1"}l.counts?.updateAllCounts&&l.counts.updateAllCounts();try{l.filter&&typeof l.filter.applyCategoryFilter=="function"&&l.filter.applyCategoryFilter(t)}catch{}}function ur(t){try{let e=Bn();if(!e||!l.filter?.getCategoryFilterConfig)return;let r=l.filter.getCategoryFilterConfig(e),n=r?.mode||"exclude",a=Array.isArray(r?.keywords)?r.keywords:[],o=(t?.textContent||"").toLowerCase(),i=a.length>0?a.some(d=>o.includes(d)):!1;(a.length===0?!1:n==="include"?!i:i)?t.classList.add("filtered"):t.classList.remove("filtered")}catch{}}function mr(t){try{let e=t?.dataset?.newsId;if(!e||!l.readState?.getReadNews||!(l.readState.getReadNews()||{})[e])return;t.classList.add("read")}catch{}}async function gr(t,e,r={}){let n=(t?.dataset?.platform||"").trim();if(!n)return{ok:!1,hasMore:!1};let a=r.signal;if(a?.aborted)return{ok:!1,hasMore:!0};if(t.dataset.loading==="1")return{ok:!1,hasMore:!0};if(t.dataset.hasMore==="0")return{ok:!1,hasMore:!1};let o=t.querySelector(".news-list");if(!o)return{ok:!1,hasMore:!1};o.querySelectorAll(".news-placeholder").forEach(s=>s.remove()),e=Math.min(Math.max(0,e||0),F);let i=o.querySelectorAll(".news-item").length;if(i>=F)return t.dataset.hasMore="0",{ok:!1,hasMore:!1};if(i>=e)return{ok:!0,hasMore:!0};t.dataset.loading="1";try{if(It>=In)return{ok:!1,hasMore:!0};It+=1;let s=Math.min(Qt,Math.max(0,F-i));if(s<=0)return t.dataset.hasMore="0",{ok:!1,hasMore:!1};let d=`/api/news/page?platform_id=${encodeURIComponent(n)}&offset=${encodeURIComponent(String(i))}&page_size=${encodeURIComponent(String(s))}`,u;try{u=await fetch(d,{signal:a})}catch(p){if(a?.aborted||p&&p.name==="AbortError")return t.querySelectorAll(".news-item").length<=0&&Se(t,"\u5F85\u52A0\u8F7D..."),{ok:!1,hasMore:!0};throw p}if(!u.ok)return{ok:!1,hasMore:!0};let c=await u.json(),f=Array.isArray(c?.items)?c.items:[],g=!!c?.has_more;(!g||i+f.length>=F)&&(t.dataset.hasMore="0");for(let p=0;p<f.length;p++){let y=f[p]||{},A=i+p+1,_=document.createElement("li");_.className="news-item",_.dataset.newsId=String(y.stable_id||""),_.dataset.newsTitle=String(y.display_title||y.title||"");let k=document.createElement("div");k.className="news-item-content";let h=document.createElement("input");h.type="checkbox",h.className="news-checkbox",h.title="\u6807\u8BB0\u5DF2\u8BFB",h.addEventListener("change",()=>{try{window.markAsRead(h)}catch{}});let b=document.createElement("span");b.className="news-index",b.textContent=String(A);let S=document.createElement("a");if(S.className="news-title",y.is_cross_platform&&S.classList.add("cross-platform"),S.href=String(y.url||"#"),S.target="_blank",S.rel="noopener noreferrer",S.setAttribute("onclick","handleTitleClickV2(this, event)"),S.setAttribute("onauxclick","handleTitleClickV2(this, event)"),S.setAttribute("oncontextmenu","handleTitleClickV2(this, event)"),S.setAttribute("onkeydown","handleTitleKeydownV2(this, event)"),S.textContent=String(y.display_title||y.title||""),y.is_cross_platform){let P=Array.isArray(y.cross_platforms)?y.cross_platforms:[],$=document.createElement("span");$.className="cross-platform-badge",$.title=`\u540C\u65F6\u51FA\u73B0\u5728: ${P.join(", ")}`,$.textContent=`\u{1F525} ${String(y.cross_platform_count??"")}`,S.appendChild(document.createTextNode(" ")),S.appendChild($)}k.appendChild(h),k.appendChild(b),k.appendChild(S);let N=ht(y.timestamp);if(N){let P=document.createElement("span");P.className="tr-news-date",P.style.marginLeft="8px",P.style.color="#9ca3af",P.style.fontSize="12px",P.style.whiteSpace="nowrap",P.textContent=N,k.appendChild(P)}_.appendChild(k);let Z=String(y.meta||"").trim();if(Z){let P=document.createElement("div");P.className="news-subtitle",P.textContent=Z,_.appendChild(P)}o.appendChild(_),mr(_),ur(_)}return t.dataset.loadedCount=String(o.querySelectorAll(".news-item").length),l.counts?.updatePlatformCount&&l.counts.updatePlatformCount(t),{ok:!0,hasMore:g}}finally{It=Math.max(0,It-1),t.dataset.loading="0"}}async function Gn(t){if(!t||!l.paging)return;let e=t.closest(".tab-pane");if(e&&!e.classList.contains("active"))return;let r=Date.now();if(r<ir)return;ir=r+Nn;let n=parseInt(t.dataset.pageOffset||"0",10)||0,a=l.paging.getCardPageSize(t),o=Math.max(0,F-n);if(a>=o){t.dataset.hasMore="0";return}let i=Math.min(a+Qt,o),s=n+i;await gr(t,s);let d=t.querySelectorAll(".news-item").length,u=Math.min(Math.max(a,i),Math.max(d-n,a)),c=Math.min(u,o);l.paging.setCardPageSize(t,c),l.paging.applyPagingToCard(t,n),l.counts?.updateAllCounts&&l.counts.updateAllCounts()}function pr(){if(Rt){try{Rt.disconnect()}catch{}Rt=null}Rt=new IntersectionObserver(t=>{for(let e of t){if(!e.isIntersecting||!be||It>0)continue;let n=e.target?.closest?.(".platform-card");n&&Gn(n).catch(()=>{})}},{root:null,rootMargin:Rn,threshold:.01}),document.querySelectorAll(".news-load-sentinel").forEach(t=>Rt.observe(t))}l.infiniteScroll={attach:pr,ensureCategoryLoaded:fr,scheduleEnsureCategoryLoaded:Fn,cancelEnsureCategoryLoaded:lr,bulkLoadCategory:dr,scheduleBulkLoadCategory:Hn,cancelBulkLoadCategory:cr};T(function(){try{window.addEventListener("scroll",()=>{be=!0},{passive:!0,once:!0})}catch{}setTimeout(()=>{be=!0},1200),pr()});function jn(t){return t?Array.from(t.querySelectorAll(".category-tab")).map(e=>String(e?.dataset?.category||"").trim()).filter(Boolean):[]}function Vn(t){if(!Array.isArray(t)||t.length===0)return;let e=l.settings.getCategoryConfig()||l.settings.getDefaultCategoryConfig(),r=l.settings.normalizeCategoryConfig(e),n=l.settings.getMergedCategoryConfig(),a=Array.isArray(n?.categoryOrder)&&n.categoryOrder.length>0?n.categoryOrder.slice():t.slice(),o=new Set(t),i=0,s=a.map(d=>{let u=String(d||"").trim();if(!u||!o.has(u))return u;let c=t[i];return i+=1,c});r.categoryOrder=s,r.__migrated_explore_ai_front_v1=Date.now(),r.__migrated_explore_knowledge_front_v1=Date.now(),l.settings.saveCategoryConfig(r)}function zn(t){let e=document.querySelector(".tab-content-area");if(!e)return;let r=new Map;e.querySelectorAll(".tab-pane").forEach(a=>{let o=String(a?.id||"");o.startsWith("tab-")&&r.set(o.slice(4),a)});let n=document.createDocumentFragment();for(let a of t){let o=r.get(a);o&&n.appendChild(o)}for(let[a,o]of r.entries())t.includes(a)||n.appendChild(o);e.appendChild(n)}function hr(){let t=document.querySelector(".category-tabs");t&&t.querySelectorAll(".category-tab").forEach(e=>{try{e.setAttribute("draggable","false");let r=e.querySelector(":scope > .category-drag-handle");r?r.setAttribute("draggable","true"):(r=document.createElement("span"),r.className="category-drag-handle",r.setAttribute("title","\u62D6\u62FD\u8C03\u6574\u680F\u76EE\u987A\u5E8F"),r.setAttribute("draggable","true"),r.textContent="\u2630",e.insertBefore(r,e.firstChild))}catch{}})}function Yn(){let t=document.querySelector(".category-tabs");if(t)try{new MutationObserver(()=>{hr()}).observe(t,{childList:!0,subtree:!0})}catch{}}function Wn(){let t=document.body;if(!t)return;let e=0,r=0,n=!1,a=()=>{e&&(window.clearTimeout(e),e=0),r&&(window.clearTimeout(r),r=0)},o=()=>{n=!1,t.classList.remove("category-tabs-drag-mode")};document.addEventListener("pointerdown",s=>{!s.target?.closest?.(".category-tabs")||!s.target?.closest?.(".category-tab")||s.target?.closest?.(".category-drag-handle")||(a(),e=window.setTimeout(()=>{n=!0,t.classList.add("category-tabs-drag-mode"),r=window.setTimeout(()=>{o()},2500)},380))},!0);let i=()=>{a(),n&&o()};document.addEventListener("pointerup",i,!0),document.addEventListener("pointercancel",i,!0),document.addEventListener("scroll",i,!0)}var yr={_attached:!1,_draggingTab:null,_originTabsEl:null,attach(){this._attached||(this._attached=!0,hr(),Yn(),Wn(),document.addEventListener("click",t=>{t.target?.closest?.(".category-drag-handle")&&(t.preventDefault(),t.stopPropagation())},!0),document.addEventListener("dragstart",t=>{let e=t.target?.closest?.(".category-drag-handle");if(!e)return;let r=e.closest(".category-tab"),n=e.closest(".category-tabs"),a=r?.dataset?.category;if(!(!r||!n||!a)){this._draggingTab=r,this._originTabsEl=n,r.classList.add("dragging"),t.dataTransfer.effectAllowed="move";try{t.dataTransfer.setData("text/plain",String(a))}catch{}}},!0),document.addEventListener("dragover",t=>{let e=t.target?.closest?.(".category-tabs");if(!e||!this._draggingTab||this._originTabsEl&&e!==this._originTabsEl)return;let r=t.target?.closest?.(".category-tab");if(!r||r===this._draggingTab)return;t.preventDefault();let n=Array.from(e.querySelectorAll(".category-tab")),a=n.indexOf(this._draggingTab),o=n.indexOf(r);a<0||o<0||a===o||(a<o?e.insertBefore(this._draggingTab,r.nextSibling):e.insertBefore(this._draggingTab,r))},!0),document.addEventListener("drop",t=>{let e=t.target?.closest?.(".category-tabs");!e||!this._draggingTab||this._originTabsEl&&e!==this._originTabsEl||t.preventDefault()},!0),document.addEventListener("dragend",t=>{let e=t.target?.closest?.(".category-drag-handle");if(!e)return;let r=e.closest(".category-tabs");if(!r||!this._draggingTab){this._draggingTab&&this._draggingTab.classList.remove("dragging"),this._draggingTab=null,this._originTabsEl=null;return}let n=jn(r);Vn(n),zn(n),this._draggingTab.classList.remove("dragging"),this._draggingTab=null,this._originTabsEl=null},!0))}};l.categoryTabReorder=yr;T(()=>{yr.attach()});var Ce="explore",Un="tr_tab_switched",Kn=3,Xn=20;function re(){return window.SYSTEM_SETTINGS&&window.SYSTEM_SETTINGS.display&&window.SYSTEM_SETTINGS.display.items_per_card||50}var Et=!1,_t=0,$t=null,ct=!1;function Jn(){try{return document.querySelector(".category-tabs .category-tab.active")?.dataset?.category||null}catch{return null}}function Zn(t){let e=Number(t||0)||0;if(!e)return"";try{let r=new Date(e*1e3),n=String(r.getFullYear()),a=String(r.getMonth()+1).padStart(2,"0"),o=String(r.getDate()).padStart(2,"0");return`${n}-${a}-${o}`}catch{return""}}function Qn(t,e={}){let r=Array.isArray(t)?t:[];return r.length?r.map((n,a)=>{let o=C(n?.stable_id||""),i=C(n?.display_title||n?.title||""),s=C(n?.url||"#"),d=Zn(n?.published_at||n?.created_at),u=d?`<span class="tr-explore-time" style="margin-left:8px;color:#9ca3af;font-size:12px;">${C(d)}</span>`:"";return`
            <li class="news-item" data-news-id="${o}" data-news-title="${i}">
                <div class="news-item-content">
                    <span class="news-index">${String(a+1)}</span>
                    <a class="news-title" href="${s}" target="_blank" rel="noopener noreferrer" onclick="handleTitleClickV2(this, event)" onauxclick="handleTitleClickV2(this, event)" oncontextmenu="handleTitleClickV2(this, event)" onkeydown="handleTitleKeydownV2(this, event)">
                        ${i}
                    </a>
                    ${u}
                </div>
            </li>`}).join(""):`<li class="tr-explore-empty" aria-hidden="true">${C(e.emptyText||"\u6682\u65E0\u5185\u5BB9")}</li>`}function ve(){return document.getElementById(`tab-${Ce}`)}function _e(){let t=ve();return t?t.querySelector(".platform-grid"):null}function Sr(){let t=ve();if(!t)return!1;let e=t.querySelector(".platform-grid");e?e.style.overscrollBehavior="contain":(e=document.createElement("div"),e.className="platform-grid",e.style.display="flex",e.style.flexDirection="row",e.style.overflowX="auto",e.style.overflowY="hidden",e.style.alignItems="flex-start",e.style.overscrollBehavior="contain",t.appendChild(e));try{e.dataset&&(e.dataset.exploreInjected="1")}catch{}return!0}async function ta(t){let e=await fetch(t,{method:"GET"});if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()}async function Cr(t,e){let r=`/api/rss/explore/timeline?limit=${encodeURIComponent(String(t))}&offset=${encodeURIComponent(String(e))}`,n=await ta(r);return Array.isArray(n?.items)?n.items:[]}function vr(t,e,r){if(!t||!t.length)return;let n=document.createElement("div");n.className="platform-card tr-explore-card",n.style.minWidth="360px",n.dataset.platform=`explore-slice-${e}`,n.draggable=!1;let a=re(),o=e*a+1,i=e*a+t.length;n.innerHTML=`
        <div class="platform-header">
            <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">
                \u{1F4F0} \u6700\u65B0 ${o}-${i}
            </div>
            <div class="platform-header-actions"></div>
        </div>
        <ul class="news-list" data-explore-list="slice-${e}">
            ${Qn(t,{emptyText:"\u6682\u65E0\u5185\u5BB9"})}
        </ul>
    `,n.querySelectorAll(".news-index").forEach((u,c)=>{u.textContent=String(o+c)});let d=r.querySelector("#explore-load-sentinel");d?r.insertBefore(n,d):r.appendChild(n)}function ea(t){let e=t.querySelector("#explore-load-sentinel");e&&e.remove();let r=document.createElement("div");return r.id="explore-load-sentinel",r.style.minWidth="20px",r.style.height="100%",r.style.flexShrink="0",r.innerHTML='<div style="width:20px;height:100%;display:flex;align-items:center;justify-content:center;color:#9ca3af;">\u23F3</div>',t.appendChild(r),r}function _r(){$t&&($t.disconnect(),$t=null);let t=ve();if(!t)return;$t=new IntersectionObserver(r=>{for(let n of r)n.isIntersecting&&wr().catch(()=>{})},{root:t.querySelector(".platform-grid"),rootMargin:"200px",threshold:.01});let e=t.querySelector("#explore-load-sentinel");e&&($t.observe(e),setTimeout(()=>{let r=e.getBoundingClientRect(),n=t.querySelector(".platform-grid");n&&r.left<n.getBoundingClientRect().right&&wr().catch(()=>{})},100))}async function wr(){if(!(Et||ct)){Et=!0;try{let t=re();if(Math.floor(_t/t)>=Xn){ct=!0;let a=document.getElementById("explore-load-sentinel");a&&(a.innerHTML='<div style="writing-mode:vertical-rl;padding:20px;color:#9ca3af;font-size:12px;">\u5DF2\u8FBE\u5230\u6700\u5927\u663E\u793A\u6570\u91CF</div>',a.style.width="40px");return}let r=await Cr(t,_t);if(!r.length){ct=!0;let a=document.getElementById("explore-load-sentinel");a&&(a.innerHTML='<div style="writing-mode:vertical-rl;padding:20px;color:#9ca3af;font-size:12px;">\u5DF2\u663E\u793A\u5168\u90E8\u5185\u5BB9</div>',a.style.width="40px");return}let n=_e();if(n){let a=Math.floor(_t/re());vr(r,a,n)}if(_t+=r.length,r.length<t){ct=!0;let a=document.getElementById("explore-load-sentinel");a&&a.remove()}}catch(t){console.error("Explore load error:",t)}finally{Et=!1}}}async function ra(){let t=_e();if(!t)return;_t=0,ct=!1,t.innerHTML="",ea(t);let e=re(),r=e*Kn,n=await Cr(r,0);if(!n.length){t.innerHTML='<div style="padding:40px;text-align:center;color:#9ca3af;width:100%;">\u6682\u65E0\u5185\u5BB9</div>';return}for(let a=0;a<n.length;a+=e){let o=n.slice(a,a+e),i=Math.floor(a/e);vr(o,i,t)}if(_t=n.length,n.length<r){ct=!0;let a=document.getElementById("explore-load-sentinel");a&&a.remove()}else _r()}async function Er(t=!1){if(Jn()!==Ce||!Sr())return!1;let e=_e();if(!t&&e&&e.querySelectorAll(".platform-card").length>0)return Et=!1,!0;Et=!0;try{return await ra(),!0}catch(r){return console.error("Explore refresh error:",r),!1}finally{Et=!1}}var br=!1;async function xr(){br||Sr()&&(br=!0,await Er())}function na(){try{window.addEventListener(Un,t=>{let e=String(t?.detail?.categoryId||"").trim(),r=!!t?.detail?.hasUpdate;e===Ce&&(ct||_r(),Er(r).catch(()=>{}))})}catch{}}function aa(){if(l.exploreTimeline&&l.exploreTimeline._patched===!0)return;let t=l.data?.renderViewerFromData;typeof t=="function"&&(l.data.renderViewerFromData=function(r,n){t.call(l.data,r,n);try{xr().catch(()=>{})}catch{}},l.exploreTimeline={...l.exploreTimeline||{},_patched:!0})}T(function(){aa(),xr().catch(()=>{}),na()});var Bt=15,ne="rsscol-rss",sa=3,Ee="hotnews_rss_carousel_cursor_v1",ke=!1,ft=!1,X=[],xe=0,ae=0,ut=!1,J=-1,M=null,xt=new Map,H=null,mt=null,Y=0,oe=!1,se=!1,Pe=0,Me=0,dt=null;function Lr(){try{return window.sessionStorage}catch{return null}}function oa(){try{let t=Lr();if(!t)return null;let e=t.getItem(Ee),r=Number(e);return!Number.isFinite(r)||r<0?null:Math.floor(r)}catch{return null}}function ia(t){try{let e=Lr();if(!e)return;let r=Number(t);if(!Number.isFinite(r)||r<0){e.removeItem(Ee);return}e.setItem(Ee,String(Math.floor(r)))}catch{}}function kr(){try{return window.matchMedia&&window.matchMedia("(max-width: 640px)").matches}catch{return!1}}function la(t){if(!G()||!kr()||document.querySelector(".settings-modal-overlay.show")||oe)return;let e=t?.target;if(!e||!(e instanceof Element)||e.closest("a,button,input,textarea,select")||!e.closest(".rss-carousel-frame"))return;let r=t?.touches;!r||r.length!==1||(se=!0,dt=null,Pe=Number(r[0]?.clientX||0),Me=Number(r[0]?.clientY||0))}function ca(t){if(!se||!G())return;let e=t?.touches;if(!e||e.length!==1)return;let r=Number(e[0]?.clientX||0),n=Number(e[0]?.clientY||0),a=r-Pe,o=n-Me,i=Math.abs(a),s=Math.abs(o);if(!dt){if(i<10&&s<10)return;dt=i>=s?"x":"y"}try{t.preventDefault()}catch{}}function Ar(t){if(!se||(se=!1,!G())||!kr())return;let e=t?.changedTouches;if(!e||e.length<1)return;let r=Number(e[0]?.clientX||0),n=Number(e[0]?.clientY||0),a=r-Pe,o=n-Me,i=Math.abs(a),s=Math.abs(o),d=44;if((dt==="x"||dt==null)&&i>=d&&i>s){a<0?Tt():qt();return}(dt==="y"||dt==null)&&s>=d&&s>i&&(o<0?At(-1):At(1))}function Pr(){try{return l.tabs?.getActiveTabId?l.tabs.getActiveTabId():null}catch{return null}}function da(t){if(!G())return;let e=async()=>{if(ft||H!=null)return;let r=[];for(let a=1;a<=sa;a+=1)r.push(t+a);let n=Math.max(...r);Number.isFinite(n)&&n>=0&&await Ft(n);for(let a of r)try{if(a<0)continue;await Ft(a);let o=X[a];if(!o)continue;await Nr(o)}catch{}};try{if(typeof window.requestIdleCallback=="function"){window.requestIdleCallback(()=>e().catch(()=>{}),{timeout:1200});return}}catch{}setTimeout(()=>e().catch(()=>{}),0)}function Oe(){return document.getElementById("rssCategoryPickerModal")}function fa(){if(Oe())return;let t=document.createElement("div");t.id="rssCategoryPickerModal",t.className="settings-modal-overlay",t.style.zIndex="9999",t.addEventListener("click",r=>{r&&r.target===t&&Ae()}),t.innerHTML=`
        <div class="settings-modal" onclick="event.stopPropagation()" style="max-width:520px;">
            <div class="settings-modal-header">
                <span class="settings-modal-title">\u52A0\u5165\u680F\u76EE</span>
                <button class="settings-modal-close" type="button" data-action="close">&times;</button>
            </div>
            <div class="settings-modal-body" style="display:flex;flex-direction:column;gap:10px;">
                <div style="color:#6b7280;font-size:0.9rem;">\u9009\u62E9\u8981\u52A0\u5165\u7684\u680F\u76EE</div>
                <div id="rssCategoryPickerList" style="display:flex;flex-direction:column;gap:8px;"></div>
            </div>
        </div>`;let e=t.querySelector('button[data-action="close"]');e&&e.addEventListener("click",()=>Ae());try{document.body.appendChild(t)}catch{}}function Ae(){let t=Oe();t&&(oe=!1,t.classList.remove("show"))}function Tr(){let t=l.settings?.getMergedCategoryConfig?l.settings.getMergedCategoryConfig():null,e=l.settings?.getDefaultCategories?l.settings.getDefaultCategories():null,r=Array.isArray(t?.categoryOrder)?t.categoryOrder:[],n=Array.isArray(t?.customCategories)?t.customCategories:[],a=[],o=new Set;for(let i of r){let s=String(i||"").trim();if(!s||o.has(s)||s==="explore"||s.startsWith("rsscol-"))continue;o.add(s);let d=n.find(g=>String(g?.id||"")===s);if(d){let g=String(d?.name||s).trim()||s;a.push({id:s,name:g,icon:"\u{1F4F1}",isCustom:!0});continue}let u=e&&e[s]?e[s]:null;if(!u)continue;let c=String(u?.name||s).trim()||s,f=String(u?.icon||"\u{1F4C1}");a.push({id:s,name:c,icon:f,isCustom:!1})}for(let i of n){let s=String(i?.id||"").trim();if(!s||o.has(s)||s==="explore"||s.startsWith("rsscol-"))continue;o.add(s);let d=String(i?.name||s).trim()||s;a.push({id:s,name:d,icon:"\u{1F4F1}",isCustom:!0})}return a}function Mr(){fa();let t=Oe();if(!t)return;let e=t.querySelector("#rssCategoryPickerList");if(e){let r=Tr();e.innerHTML=r.map(n=>`
                <button type="button" class="platform-select-action-btn" data-cat-id="${C(n.id)}" style="text-align:left;">
                    ${C(n.icon)} ${C(n.name)}
                </button>`).join(""),e.querySelectorAll("button[data-cat-id]").forEach(n=>{n.addEventListener("click",async()=>{let a=String(n.getAttribute("data-cat-id")||"").trim(),i=Tr().find(d=>d.id===a),s=i||{id:a,name:a,icon:"\u{1F4C1}",isCustom:!1};Ae(),await ua(s)})})}oe=!0,t.classList.add("show");try{let r=t.querySelector(".settings-modal");r&&(r.setAttribute("tabindex","0"),r.focus())}catch{}}async function ua(t){if(!M||!M.source_id)return;let e=String(t?.id||"").trim(),r=String(t?.name||e).trim()||e||"RSS",n=!!t?.isCustom,a=String(M.source_id||"").trim(),o=a?`rss-${a}`:"",i="RSS";e&&e!=="rsscol-rss"&&!n&&(i=e);try{l.subscription?.ensureSnapshot?.()}catch{}try{l.subscription?.stageFromCatalogPreview?.({source_id:M.source_id,url:M.url,feed_title:M.feed_title||M.platform_name,column:i,entries_count:M.entries_count||0})}catch(s){q(String(s?.message||s),{variant:"error"});return}if(n&&e&&o)try{l.settings?.addPlatformToCustomCategory?.(e,o)}catch{}M.already_added=!0;try{Re(M)}catch{}try{l.toast?.show?.(`\u5DF2\u52A0\u5165\u680F\u76EE\uFF1A${r}`,{variant:"loading",durationMs:1200})}catch{}try{l.subscription?.saveOnly?await l.subscription.saveOnly():l.subscription?.saveAndRefresh?await l.subscription.saveAndRefresh():await window.saveRssSubscriptions?.()}catch(s){q(String(s?.message||s),{variant:"error"});try{l.toast?.show?.(`\u52A0\u5165\u5931\u8D25\uFF1A${String(s?.message||s)}`,{variant:"error",durationMs:2500})}catch{}return}try{Ir([M.source_id],"high").catch(()=>{})}catch{}try{l.toast?.show?.(`\u5DF2\u52A0\u5165\u680F\u76EE\uFF1A${r}`,{variant:"success",durationMs:1500})}catch{}}function G(){return ke&&Pr()===ne}function Te(){return document.getElementById("rssCategoryCarouselGrid")}function ma(){return document.getElementById("rssCategoryCarouselStatus")}function q(t,e={}){let r=ma();if(!r)return;let n=String(e.variant||"").toLowerCase(),a=n==="error"?"#dc2626":n==="success"?"#16a34a":"#6b7280";r.style.color=a,r.textContent=t==null?"":String(t)}function Or(t){let e=Number(t||0)||0;if(!e)return"";let r=new Date(e);if(Number.isNaN(r.getTime()))return"";let n=s=>String(s).padStart(2,"0"),a=String(r.getFullYear()),o=n(r.getMonth()+1),i=n(r.getDate());return`${a}-${o}-${i}`}function Rr(t){let e=[t?.published,t?.published_at,t?.pubDate,t?.updated,t?.updated_at,t?.date,t?.datetime,t?.date_published,t?.date_modified],n=Date.now()+365*24*60*60*1e3,a=o=>{let i=Number(o);return!Number.isFinite(i)||i<=0?0:i<1e11?Math.floor(i*1e3):Math.floor(i)};for(let o of e){if(o==null)continue;if(typeof o=="number"){let d=a(o);if(d>0&&d<=n)return d;continue}let i=String(o).trim();if(!i)continue;if(/^\d{10,13}$/.test(i)){let d=a(i);if(d>0&&d<=n)return d;continue}let s=Date.parse(i);if(!Number.isNaN(s)&&s>0)return s}return 0}async function Ir(t,e="normal"){let r=Array.isArray(t)?t.map(n=>String(n||"").trim()).filter(Boolean):[];if(r.length)try{await fetch("/api/rss-sources/warmup?wait_ms=0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_ids:r,priority:e})})}catch{}}async function ga(t,e){let r=new URLSearchParams;r.set("limit",String(t)),r.set("offset",String(e));let n=await fetch(`/api/rss-sources/search?${r.toString()}`),a=await n.json().catch(()=>({}));if(!n.ok)throw new Error(a?.detail||"Failed to load RSS sources");let o=Array.isArray(a?.sources)?a.sources:[],i=Number(a?.total||0)||0,s=Number(a?.next_offset??e+o.length)||e+o.length;return{items:o,total:i,nextOffset:s}}async function Ft(t){let e=Number(t);if(!Number.isFinite(e)||e<0||ut)return;let r=0;for(;X.length<=e&&!ut&&r<50;){r+=1;let n=await ga(50,ae);xe=n.total,ae=n.nextOffset;for(let a of n.items)String(a?.id||"").trim()&&X.push(a);(!n.items.length||ae>=xe)&&(ut=!0)}}async function pa(){if(ut)return;let t=0;for(;!ut&&t<200&&(t+=1,await Ft(X.length),!ut););}function ha(t){return String(t?.name||t?.host||t?.id||"").trim()||"RSS"}function ya(t){let e=t?.data||{},r=String(e?.feed?.title||"").trim(),a=(Array.isArray(e?.entries)?e.entries:[]).map(o=>{let i=String(o?.title||"").trim(),s=String(o?.link||"").trim(),d=Rr(o);return{title:i||s,link:s,ts:d}}).filter(o=>!!o.link);return{feedTitle:r,entries:a}}function wa(){let t=l.subscription?.getSubscriptions?l.subscription.getSubscriptions():[],e=new Set;for(let r of Array.isArray(t)?t:[]){let n=String(r?.source_id||r?.rss_source_id||"").trim();n&&e.add(n)}return e}async function Nr(t){let e=String(t?.id||"").trim();if(!e)return null;if(xt.has(e))return xt.get(e);let r=String(t?.url||"").trim(),n=ha(t),a=wa(),o=[],i="",s=null;try{let g=await fetch(`/api/rss-sources/preview?source_id=${encodeURIComponent(e)}`);if(s=await g.json().catch(()=>({})),!g.ok)throw new Error(s?.detail||"Preview failed");let p=ya(s);i=p.feedTitle,o=p.entries}catch(g){let p={source_id:e,error:String(g?.message||g)};return xt.set(e,p),p}if(!Array.isArray(o)||o.length<=0){let g={source_id:e,error:"No entries"};return xt.set(e,g),g}let d=0;for(let g of o){let p=Number(g?.ts||0)||0;p>d&&(d=p)}if(!d&&s){let g=Rr({published:s?.last_modified||s?.data?.feed?.updated||s?.data?.feed?.published||s?.data?.feed?.lastBuildDate});g>d&&(d=g)}let u=Or(d),f={source_id:e,url:r,feed_title:i||n,platform_name:i||n,entries:o,entries_count:o.length,date_str:u,error:"",already_added:a.has(e)};return xt.set(e,f),f}function Re(t){let e=Te();if(!e)return;let r=t,n=String(r?.source_id||"").trim(),a=C(r?.platform_name||"RSS"),o=r?.already_added?"\u5DF2\u52A0\u5165":"\u52A0\u5165\u680F\u76EE",i=r?.already_added?"disabled":"",s=Array.isArray(r?.entries)?r.entries:[],d=Math.max(0,Math.ceil(s.length/Bt)-1);Y>d&&(Y=d),Y<0&&(Y=0);let u=Y*Bt,c=s.slice(u,u+Bt),f=c.map((A,_)=>{let k=C(A?.title||""),h=C(A?.link||"#"),b=C(Or(A?.ts||0));return`
            <li class="news-item" data-news-id="" data-news-title="${k}">
                <div class="news-item-content">
                    <span class="news-index">${String(u+_+1)}</span>
                    <a class="news-title tr-news-title-lg tr-title-hover-accent tr-hover-glass tr-title-hover-wave" href="${h}" target="_blank" rel="noopener noreferrer">${k}</a>
                    <span class="rss-entry-date" style="flex:0 0 auto;margin-left:8px;color:#6b7280;font-size:0.75rem;white-space:nowrap;${b?"":"display:none;"}">${b}</span>
                </div>
            </li>`}).join(""),g=Math.max(0,Bt-c.length),p=g?Array.from({length:g}).map((A,_)=>{let k=u+c.length+_+1;return`
            <li class="news-item rss-entry-placeholder" data-news-id="">
                <div class="news-item-content">
                    <span class="news-index">${String(k)}</span>
                    <span class="news-title tr-news-title-lg tr-hover-glass">&nbsp;</span>
                    <span class="rss-entry-date" style="display:none;">&nbsp;</span>
                </div>
            </li>`}).join(""):"";e.innerHTML=`
        <div class="rss-carousel-frame" style="margin:0 auto;max-width:980px;width:min(980px,100%);box-sizing:border-box;position:relative;padding:52px 56px;">
            <div class="rss-carousel-nav-hints" style="position:absolute;inset:0;pointer-events:none;">
                <div class="rss-nav-hint rss-nav-left" aria-hidden="true" style="position:absolute;left:8px;top:50%;transform:translateY(-50%);width:40px;height:40px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.65);backdrop-filter:blur(6px);color:#374151;font-weight:900;box-shadow:0 6px 20px rgba(0,0,0,0.08);opacity:0.45;display:flex;align-items:center;justify-content:center;">\u2039</div>
                <div class="rss-nav-hint rss-nav-right" aria-hidden="true" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);width:40px;height:40px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.65);backdrop-filter:blur(6px);color:#374151;font-weight:900;box-shadow:0 6px 20px rgba(0,0,0,0.08);opacity:0.45;display:flex;align-items:center;justify-content:center;">\u203A</div>
                <div class="rss-nav-hint rss-nav-up" aria-hidden="true" style="position:absolute;left:50%;top:8px;transform:translateX(-50%);width:40px;height:40px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.65);backdrop-filter:blur(6px);color:#374151;font-weight:900;box-shadow:0 6px 20px rgba(0,0,0,0.08);opacity:0.45;display:flex;align-items:center;justify-content:center;">\u02C4</div>
                <div class="rss-nav-hint rss-nav-down" aria-hidden="true" style="position:absolute;left:50%;bottom:8px;transform:translateX(-50%);width:40px;height:40px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.65);backdrop-filter:blur(6px);color:#374151;font-weight:900;box-shadow:0 6px 20px rgba(0,0,0,0.08);opacity:0.45;display:flex;align-items:center;justify-content:center;">\u02C5</div>
            </div>
            <div class="platform-card" data-rss-source-id="${C(n)}" style="margin:0 auto;max-width:980px;width:100%;box-sizing:border-box;">
                <div class="platform-header">
                    <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;flex:1;min-width:0;white-space:nowrap;overflow:hidden;">
                        <div class="rss-preview-title-row" style="display:flex;align-items:baseline;gap:12px;min-width:0;">
                            <span class="rss-preview-title-text tr-title-compact tr-title-ellipsis tr-title-hover-accent" style="flex:1;min-width:0;">\u{1F4F1} ${a}</span>
                        </div>
                    </div>
                    <div class="platform-header-actions">
                        <button type="button" class="platform-select-action-btn" data-action="add" ${i}>${o}</button>
                    </div>
                </div>
                <ul class="news-list">${f}${p}</ul>
            </div>
        </div>`;try{window.requestAnimationFrame(()=>{e.querySelectorAll(".news-title").forEach(_=>{_ instanceof HTMLElement&&(_.closest(".rss-entry-placeholder")||(_.classList.remove("tr-title-overflow-shrink"),_.scrollWidth>_.clientWidth+1&&_.classList.add("tr-title-overflow-shrink")))})})}catch{}let y=e.querySelector('button[data-action="add"]');y&&y.addEventListener("click",()=>{M&&(oe||M.already_added||(q("",{variant:"info"}),Mr()))})}async function ie(t,e=1){if(!ft){ft=!0,mt=Number(t);try{if(await Ft(t),X.length<=0){let i=Te();i&&(i.innerHTML='<div style="color:#6b7280;">\u6682\u65E0\u53EF\u9884\u89C8\u6E90</div>'),q("",{variant:"info"});return}let r=t,n=e>=0?1:-1,a=0;for(;a<200;){a+=1,r<0&&(await pa(),r=X.length-1),await Ft(r),r>=X.length&&(r=0);let i=X[r];if(!i){r+=n;continue}let s=await Nr(i);if(!s||s.error){r+=n;continue}J=r,ia(J),M=s,Y=0,Re(s),q("",{variant:"info"});try{Ir([s.source_id],"normal").catch(()=>{})}catch{}try{da(r)}catch{}return}let o=Te();o&&(o.innerHTML='<div style="color:#6b7280;">\u6682\u65E0\u53EF\u9884\u89C8\u6E90</div>'),q("",{variant:"info"})}catch(r){q(String(r?.message||r),{variant:"error"})}finally{if(ft=!1,mt=null,G()&&H!=null){let r=Number(H);H=null;let n=Number.isFinite(J)?J:0,a=r>=n?1:-1;ie(r,a).catch(o=>q(String(o?.message||o),{variant:"error"}))}}}}function Tt(){if(!G())return;if(ft){H=(H!=null?Number(H):mt!=null?Number(mt):J)+1;return}let t=J+1;ie(t,1).catch(e=>q(String(e?.message||e),{variant:"error"}))}function qt(){if(!G())return;if(ft){H=(H!=null?Number(H):mt!=null?Number(mt):J)-1;return}let t=J-1;ie(t,-1).catch(e=>q(String(e?.message||e),{variant:"error"}))}function ba(){ft=!1,H=null,mt=null,X=[],xe=0,ae=0,ut=!1,J=-1,M=null,xt=new Map,Y=0}function At(t){if(!G()||!M)return;let e=Array.isArray(M?.entries)?M.entries:[],r=Math.max(0,Math.ceil(e.length/Bt)-1),n=Math.max(0,Math.min(r,Y+t));n!==Y&&(Y=n,Re(M))}function Le(){ke=!0;try{l.subscription?.ensureSnapshot?.()}catch{}ba();let t=oa();ie(t??0,1).catch(r=>q(String(r?.message||r),{variant:"error"}))}function Dr(){ke=!1}window.rssCategoryCarouselNext=()=>Tt();window.rssCategoryCarouselPrev=()=>qt();window.rssCategoryCarouselAddToCategory=()=>{G()&&M&&(M.already_added||Mr())};l.rssCategoryCarousel={open:Le,close:Dr,next:Tt,prev:qt};T(function(){try{let t=l.tabs?.switchTab;typeof t=="function"&&(l.tabs.switchTab=function(e){t.call(l.tabs,e);try{String(e)===ne?Le():Dr()}catch{}})}catch{}document.addEventListener("keydown",t=>{if(!G()||document.querySelector(".settings-modal-overlay.show"))return;let e=t?.target;if(!(e&&e instanceof Element&&e.closest("input,textarea,select"))){if(t.key===" "||t.key==="Spacebar"||t.code==="Space"){t.preventDefault(),Tt();return}if(t.key==="ArrowUp"){t.preventDefault(),At(-1);return}if(t.key==="ArrowDown"){t.preventDefault(),At(1);return}if(t.key==="ArrowRight"){t.preventDefault(),Tt();return}if(t.key==="ArrowLeft"){t.preventDefault(),qt();return}}}),document.addEventListener("click",t=>{if(!G()||document.querySelector(".settings-modal-overlay.show"))return;let e=t?.target;if(!e||!(e instanceof Element)||e.closest("a,button,input,textarea,select"))return;let r=document.getElementById(`tab-${ne}`);if(!r)return;let n=Number(t?.clientX||0),a=Number(t?.clientY||0),o=r.querySelector("#rssCategoryCarouselGrid .platform-card");if(!o)return;let i=o.getBoundingClientRect(),s=140,d=i.left-s,u=i.right+s,c=i.top-s,f=i.bottom+s;if(!(n<d||n>u||a<c||a>f)&&!(n>=i.left&&n<=i.right&&a>=i.top&&a<=i.bottom)){if(a<i.top){At(-1);return}if(a>i.bottom){At(1);return}if(n<i.left){qt();return}if(n>i.right){Tt();return}}}),document.addEventListener("touchstart",la,{passive:!0}),document.addEventListener("touchmove",ca,{passive:!1}),document.addEventListener("touchend",Ar,{passive:!0}),document.addEventListener("touchcancel",Ar,{passive:!0});try{Pr()===ne&&Le()}catch{}});function gt(t){let e=t;return e?e.nodeType===3?e.parentElement||null:e:null}function Lt(t){if(!t)return!1;let e=t.scrollWidth||0,r=t.clientWidth||0;return e>r+1}function $r(t){return gt(t)?.closest?.(".platform-card")?.closest?.(".platform-grid")||null}function Ie(t){let e=gt(t);return!e?.closest||e.closest(".platform-drag-handle")?!1:!!e.closest(".platform-header")||!!e.closest(".platform-name")}T(()=>{let e=null,r=!1,n=null,a=0,o=0,i=!1,s=0,d=null,u=0,c=0,f=0,g=.92,p=.5;function y(){d&&(cancelAnimationFrame(d),d=null),u=0}function A(m){if(!m)return null;let v=Array.from(m.querySelectorAll(".platform-card"));if(v.length===0)return null;let x=m.getBoundingClientRect().left,R=m.scrollLeft||0,I=null,B=1/0;for(let W of v){let U=W.getBoundingClientRect().left,K=Math.abs(U-x);K<B&&(B=K,I=W)}return I?I.offsetLeft||0:null}function _(m){if(!m)return;let v=A(m);if(v===null)return;let w=Math.max(0,(m.scrollWidth||0)-(m.clientWidth||0)),x=Math.max(0,Math.min(w,v));m.scrollTo({left:x,behavior:"smooth"})}function k(m,v){if(!m||!Lt(m))return;y(),u=v;function w(){if(Math.abs(u)<p){y(),setTimeout(()=>_(m),100);return}u*=g;let x=Math.max(0,(m.scrollWidth||0)-(m.clientWidth||0)),R=m.scrollLeft||0,I=Math.max(0,Math.min(x,R+u));if(m.scrollLeft=I,I<=0||I>=x){y(),setTimeout(()=>_(m),100);return}d=requestAnimationFrame(w)}d=requestAnimationFrame(w)}let h=!1,b=null,S=0,N=null;function Z(){if(h=!1,!b||!Lt(b)){S=0;return}let m=S;if(S=0,!m)return;let v=Math.max(0,(b.scrollWidth||0)-(b.clientWidth||0)),w=b.scrollLeft||0,x=Math.max(0,Math.min(v,w+m));b.scrollLeft=x,N&&clearTimeout(N),N=setTimeout(()=>{N=null,_(b)},150)}let P=()=>{let v=performance.now()-c,w=0;i&&n&&v>0&&v<100&&(w=-(f-a)/(v/16),w=Math.max(-50,Math.min(50,w)));let x=n;e=null,r=!1,n=null,a=0,o=0,i=!1,c=0,f=0;try{document.body.classList.remove("tr-platform-title-dragging")}catch{}x&&Math.abs(w)>2&&k(x,w)},$=(m,v,w=!1)=>{if(w){let R=gt(m)?.closest?.(".platform-card");if(!R)return!1;let I=R.closest(".platform-grid");if(!I||!Lt(I))return!1;y(),n=I,a=v,o=I.scrollLeft||0,i=!1,c=performance.now(),f=v;try{document.body.classList.add("tr-platform-title-dragging")}catch{}return!0}if(!Ie(m)||document.querySelector(".platform-card.dragging"))return!1;let x=$r(m);if(!x||!Lt(x))return!1;y(),n=x,a=v,o=x.scrollLeft||0,i=!1,c=performance.now(),f=v;try{document.body.classList.add("tr-platform-title-dragging")}catch{}return!0};document.addEventListener("pointerdown",m=>{if(m.button!==0&&m.button!==1)return;let v=gt(m.target),w=m.button===1;if($(v,m.clientX,w)&&(e=m.pointerId,w))try{m.preventDefault()}catch{}},{passive:!1}),document.addEventListener("mousedown",m=>{if(m.button!==0&&m.button!==1||e!==null)return;let v=gt(m.target),w=m.button===1;if($(v,m.clientX,w)&&(r=!0,w))try{m.preventDefault()}catch{}},{passive:!1}),document.addEventListener("pointermove",m=>{if(e===null||m.pointerId!==e||!n)return;if(document.querySelector(".platform-card.dragging")){P();return}let v=m.clientX-a;if(!i&&Math.abs(v)<4)return;i=!0;try{m.preventDefault()}catch{}c=performance.now(),f=m.clientX;let w=Math.max(0,(n.scrollWidth||0)-(n.clientWidth||0)),x=Math.max(0,Math.min(w,o-v));n.scrollLeft=x},{passive:!1}),document.addEventListener("mousemove",m=>{if(!r||!n)return;if(document.querySelector(".platform-card.dragging")){P();return}let v=m.clientX-a;if(!i&&Math.abs(v)<4)return;i=!0;try{m.preventDefault()}catch{}c=performance.now(),f=m.clientX;let w=Math.max(0,(n.scrollWidth||0)-(n.clientWidth||0)),x=Math.max(0,Math.min(w,o-v));n.scrollLeft=x},{passive:!1});let et=()=>{e!==null&&(i&&(s=Date.now()+600),P())};document.addEventListener("pointerup",et,{passive:!0}),document.addEventListener("pointercancel",et,{passive:!0}),document.addEventListener("mouseup",()=>{r&&(i&&(s=Date.now()+600),P())},{passive:!0}),document.addEventListener("click",m=>{if(Date.now()>s)return;let w=gt(m.target);if(Ie(w)){try{m.preventDefault()}catch{}try{m.stopPropagation()}catch{}try{m.stopImmediatePropagation()}catch{}}},!0),document.addEventListener("wheel",m=>{let v=typeof document.elementFromPoint=="function"?document.elementFromPoint(m.clientX,m.clientY):null,w=gt(v||m.target);if(!m.shiftKey||!Ie(w)||document.querySelector(".platform-card.dragging"))return;let x=$r(w);if(!x||!Lt(x))return;y();let R=typeof m.deltaX=="number"&&m.deltaX!==0?m.deltaX:m.deltaY;if(m.deltaMode===1?R*=20:m.deltaMode===2&&(R*=x.clientWidth||100),!!R){try{m.preventDefault()}catch{}b=x,S+=R,h||(h=!0,requestAnimationFrame(Z))}},{passive:!1});function Vt(m,v){if(!m)return;let w=Array.from(m.querySelectorAll(".platform-card"));if(w.length===0)return;let R=m.getBoundingClientRect().left,I=m.scrollLeft||0,B=0,rt=1/0;w.forEach((U,K)=>{let fe=U.getBoundingClientRect(),zt=Math.abs(fe.left-R);zt<rt&&(rt=zt,B=K)});let W=Math.max(0,Math.min(w.length-1,B+v));if(W===B&&rt<10){let U=Math.max(0,Math.min(w.length-1,B+v));if(U!==B){let K=w[U];K&&(y(),m.scrollTo({left:K.offsetLeft||0,behavior:"smooth"}))}return}let pt=w[W];pt&&(y(),m.scrollTo({left:pt.offsetLeft||0,behavior:"smooth"}))}function de(){let m=document.querySelector(".tab-pane.active");if(!m||(m.id||"")==="tab-rsscol-rss")return null;let w=m.querySelector(".platform-grid");return!w||!Lt(w)?null:w}document.addEventListener("keydown",m=>{let v=m.target;if(v&&v instanceof Element&&v.closest("input,textarea,select")||document.querySelector(".settings-modal-overlay.show")||document.getElementById("rssCatalogPreviewModal")?.classList.contains("show")||m.key!=="ArrowLeft"&&m.key!=="ArrowRight")return;let w=de();w&&(m.preventDefault(),Vt(w,m.key==="ArrowRight"?1:-1))})});var De="knowledge";var _s=2*3600,Sa="tr_tab_switched",Ca=3e5,va=3;function le(){return window.SYSTEM_SETTINGS&&window.SYSTEM_SETTINGS.display&&window.SYSTEM_SETTINGS.display.morning_brief_items||50}var Gt=!1,Ne=0,Br=null,jt=0,Ht=null,kt=!1;function _a(){try{return document.querySelector(".category-tabs .category-tab.active")?.dataset?.category||null}catch{return null}}function Ea(t){try{l.paging?.setCardPageSize?.(t,50),l.paging?.applyPagingToCard?.(t,0)}catch{}}function xa(t){let e=Number(t||0)||0;if(!e)return"";try{let r=new Date(e*1e3),n=String(r.getFullYear()),a=String(r.getMonth()+1).padStart(2,"0"),o=String(r.getDate()).padStart(2,"0");return`${n}-${a}-${o}`}catch{return""}}function Aa(t,e={}){let r=Array.isArray(t)?t:[];return r.length?r.map((n,a)=>{let o=C(n?.stable_id||""),i=C(n?.display_title||n?.title||""),s=C(n?.url||"#"),d=xa(n?.published_at||n?.created_at),u=d?`<span class="tr-mb-time" style="margin-left:8px;color:#9ca3af;font-size:12px;">${C(d)}</span>`:"";return`
            <li class="news-item" data-news-id="${o}" data-news-title="${i}">
                <div class="news-item-content">
                    <span class="news-index">${String(a+1)}</span>
                    <a class="news-title" href="${s}" target="_blank" rel="noopener noreferrer" onclick="handleTitleClickV2(this, event)" onauxclick="handleTitleClickV2(this, event)" oncontextmenu="handleTitleClickV2(this, event)" onkeydown="handleTitleKeydownV2(this, event)">
                        ${i}
                    </a>
                    ${u}
                </div>
            </li>`}).join(""):`<li class="tr-mb-empty" aria-hidden="true">${C(e.emptyText||"\u6682\u65E0\u5185\u5BB9")}</li>`}function ce(){return document.getElementById(`tab-${De}`)}function Fr(){let t=ce();return t?t.querySelector(".platform-grid"):null}function qr(){let t=ce();if(!t)return!1;let e=t.querySelector(".platform-grid");e?e.style.overscrollBehavior="contain":(e=document.createElement("div"),e.className="platform-grid",e.style.display="flex",e.style.flexDirection="row",e.style.overflowX="auto",e.style.overflowY="hidden",e.style.alignItems="flex-start",e.style.overscrollBehavior="contain",t.appendChild(e));try{e.dataset&&(e.dataset.mbInjected="1")}catch{}return!0}async function Ta(t){let e=await fetch(t,{method:"GET"});if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()}async function Hr(t,e){let r=`/api/rss/brief/timeline?limit=${encodeURIComponent(String(t))}&offset=${encodeURIComponent(String(e))}&drop_published_at_zero=0`,n=await Ta(r);return Array.isArray(n?.items)?n.items:[]}function Gr(t,e,r){if(!t||!t.length)return;let n=document.createElement("div");n.className="platform-card tr-morning-brief-card",n.style.minWidth="360px",n.dataset.platform=`mb-slice-${e}`,n.draggable=!1;let a=le(),o=e*a+1,i=e*a+t.length;n.innerHTML=`
        <div class="platform-header">
            <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">
                \u{1F552} \u6700\u65B0 ${o}-${i}
            </div>
            <div class="platform-header-actions"></div>
        </div>
        <ul class="news-list" data-mb-list="slice-${e}">
            ${Aa(t,{emptyText:"\u6682\u65E0\u5185\u5BB9"})}
        </ul>
    `,n.querySelectorAll(".news-index").forEach((u,c)=>{u.textContent=String(o+c)});let d=r.querySelector("#mb-load-sentinel");d?r.insertBefore(n,d):r.appendChild(n),Ea(n)}function La(t){let e=t.querySelector("#mb-load-sentinel");e&&e.remove();let r=document.createElement("div");return r.id="mb-load-sentinel",r.style.minWidth="20px",r.style.height="100%",r.style.flexShrink="0",r.innerHTML='<div style="width:20px;height:100%;display:flex;align-items:center;justify-content:center;color:#9ca3af;">\u23F3</div>',t.appendChild(r),r}function jr(){Ht&&(Ht.disconnect(),Ht=null);let t=ce();if(!t)return;Ht=new IntersectionObserver(r=>{for(let n of r)n.isIntersecting&&ka().catch(()=>{})},{root:t.querySelector(".platform-grid"),rootMargin:"200px",threshold:.01});let e=t.querySelector("#mb-load-sentinel");e&&Ht.observe(e)}async function ka(){if(!(Gt||kt)){Gt=!0;try{let t=le(),e=await Hr(t,jt);if(!e.length){kt=!0;let n=document.getElementById("mb-load-sentinel");n&&(n.innerHTML='<div style="writing-mode:vertical-rl;padding:20px;color:#9ca3af;font-size:12px;">\u5DF2\u663E\u793A\u5168\u90E8\u5185\u5BB9</div>',n.style.width="40px");return}let r=Fr();if(r){let n=Math.floor(jt/le());Gr(e,n,r)}if(jt+=e.length,e.length<t){kt=!0;let n=document.getElementById("mb-load-sentinel");n&&n.remove()}}catch{}finally{Gt=!1}}}async function Pa(){let t=Fr();if(!t)return;jt=0,kt=!1,t.innerHTML="",La(t);let e=le(),r=e*va,n=await Hr(r,0);if(!n.length){t.innerHTML='<div style="padding:40px;text-align:center;color:#9ca3af;width:100%;">\u6682\u65E0\u5185\u5BB9</div>';return}for(let a=0;a<n.length;a+=e){let o=n.slice(a,a+e),i=Math.floor(a/e);Gr(o,i,t)}if(jt=n.length,n.length<r){kt=!0;let a=document.getElementById("mb-load-sentinel");a&&a.remove()}else jr()}async function $e(t={}){let e=t.force===!0;if(_a()!==De)return!1;let r=Date.now();if(!e&&Ne>0&&r-Ne<Ca-5e3||!qr())return!1;Gt=!0;try{return await Pa(),Ne=Date.now(),!0}catch{return!1}finally{Gt=!1}}function Ma(){let t=ce();if(t&&!(t.dataset&&t.dataset.mbBound==="1")){t.addEventListener("click",e=>{let r=e.target;if(!r||!(r instanceof Element))return;r.closest('[data-action="mb-refresh"]')&&(e.preventDefault(),$e({force:!0}).catch(()=>{try{l.toast?.show("\u5237\u65B0\u5931\u8D25",{variant:"error",durationMs:2e3})}catch{}}))});try{t.dataset&&(t.dataset.mbBound="1")}catch{}}}async function Vr(){qr()&&(Ma(),await $e({force:!1}))}function Oa(){try{window.addEventListener(Sa,t=>{String(t?.detail?.categoryId||"").trim()===De&&(kt||jr(),clearTimeout(Br),Br=setTimeout(()=>{$e({force:!1}).catch(()=>{})},120))})}catch{}}function Ra(){if(l.morningBrief&&l.morningBrief._patched===!0)return;let t=l.data?.renderViewerFromData;typeof t=="function"&&(l.data.renderViewerFromData=function(r,n){t.call(l.data,r,n);try{Vr().catch(()=>{})}catch{}},l.morningBrief={...l.morningBrief||{},_patched:!0})}T(function(){Ra(),Vr().catch(()=>{}),Oa()});var Yr="hotnews_mobile_top_collapsed_v1",Wr="tr-mobile-top-collapsed";function zr(t){let e=!!t;try{document.body.classList.toggle(Wr,e)}catch{}try{localStorage.setItem(Yr,e?"1":"0")}catch{}try{let r=document.getElementById("trFooterTopToggle");r&&(r.textContent=e?"\u663E\u793A\u9876\u90E8":"\u9690\u85CF\u9876\u90E8")}catch{}}function Ia(){let t=!0;try{let e=localStorage.getItem(Yr);e==="0"&&(t=!1),e==="1"&&(t=!0)}catch{}try{new URLSearchParams(window.location.search).get("e2e")==="1"&&(t=!1)}catch{}zr(t);try{let e=document.getElementById("trFooterTopToggle");if(!e||e.dataset.bound==="1")return;e.dataset.bound="1",e.setAttribute("role","button"),e.setAttribute("aria-label","\u663E\u793A\u6216\u9690\u85CF\u9876\u90E8\u680F"),e.addEventListener("click",()=>{let r=!document.body.classList.contains(Wr);if(zr(r),!r)try{window.scrollTo({top:0,behavior:"smooth"})}catch{}})}catch{}}T(function(){try{if(new URLSearchParams(window.location.search).get("e2e")==="1"){try{let n=document.getElementById("early-hide");n&&n.remove()}catch{}try{let n=document.querySelector(".category-tabs");n&&n instanceof HTMLElement&&(n.style.display="flex")}catch{}try{let n=document.querySelector(".tab-content-area");n&&n instanceof HTMLElement&&(n.style.display="block")}catch{}}}catch{}if(Ia(),localStorage.getItem("category_settings_badge_dismissed")==="true"){let r=document.getElementById("categorySettingsNewBadge");r&&(r.style.display="none")}if(localStorage.getItem("rss_subscription_badge_dismissed")==="true"){let r=document.getElementById("rssSubscriptionNewBadge");r&&(r.style.display="none")}let t=l.settings.getCategoryConfig();if(t&&(t.customCategories&&t.customCategories.length>0||t.hiddenDefaultCategories&&t.hiddenDefaultCategories.length>0||t.categoryOrder&&t.categoryOrder.length>0||t.platformOrder&&typeof t.platformOrder=="object"&&Object.keys(t.platformOrder).length>0)){l.data.refreshViewerData({preserveScroll:!1});try{window.setTimeout(()=>{try{if(document.body.classList.contains("categories-ready"))return}catch{}try{let r=document.getElementById("early-hide");r&&r.remove()}catch{}try{let r=document.querySelector(".category-tabs");r&&r instanceof HTMLElement&&(r.style.display="flex")}catch{}try{let r=document.querySelector(".tab-content-area");r&&r instanceof HTMLElement&&(r.style.display="block")}catch{}try{document.body.classList.add("categories-ready")}catch{}},2500)}catch{}}else document.body.classList.add("categories-ready")});import("./platform-reorder-LZSDFU4M.js");import("./subscription-IHH5JN6U.js");import("./rss-catalog-preview-parity-G7T2TNAV.js");import("./explore-embedded-rss-KJHUCJWE.js");export{l as TR};
