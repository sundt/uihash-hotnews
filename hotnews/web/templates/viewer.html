<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="baidu-site-verification" content="codeva-FMb8nsTNbx" />
    <title>Hotnews-çƒ­ç‚¹æ–°é—»</title>
    <link rel="icon" href="{{ static_prefix }}/images/hxlogo.jpg?v={{ asset_rev }}" type="image/jpeg">
    <link rel="apple-touch-icon" href="{{ static_prefix }}/images/hxlogo.jpg?v={{ asset_rev }}">
    <!-- èµ„æºé¢„åŠ è½½æç¤º -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="preload" href="{{ static_prefix }}/css/viewer.css?v={{ asset_rev }}" as="style">
    <link rel="preload" href="{{ static_prefix }}/css/title-effects.css?v={{ asset_rev }}" as="style">
    <link rel="modulepreload" href="{{ static_prefix }}/js/index.js?v={{ asset_rev }}">
    <script id="system-settings-json" type="application/json">{{ sys_settings | tojson }}</script>
    <script>
        (function () { try { try { var p = new URLSearchParams(location.search || ''); if (p.get('e2e') === '1') return; } catch (e2) { } var r = localStorage.getItem('hotnews_categories_config'); if (r) { var c = JSON.parse(r); if ((c.customCategories && c.customCategories.length > 0) || (c.hiddenDefaultCategories && c.hiddenDefaultCategories.length > 0)) { document.write('<style id="early-hide">.category-tabs,.tab-content-area{display:none!important}</style>'); } } } catch (e) { } })();
        try { window.SYSTEM_SETTINGS = JSON.parse((document.getElementById('system-settings-json') || {}).textContent || '{}'); } catch (e) { window.SYSTEM_SETTINGS = {}; }
    </script>
    <script type="text/javascript">
        (function (c, l, a, r, i, t, y) {
            c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
            t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
            y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
        })(window, document, "clarity", "script", "uqyzcxxgdk");
    </script>
    <!-- å…³é”® CSS å†…è”ï¼ˆéª¨æ¶å±æ ·å¼ï¼Œé˜²æ­¢ FOUCï¼‰ -->
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
        }

        .main-container {
            width: 96vw;
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px 15px;
            box-sizing: border-box;
        }

        .header-card {
            background: white;
            border-radius: 12px;
            padding: 12px 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .category-tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            background: white;
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .category-tab {
            padding: 8px 16px;
            border-radius: 8px;
            background: #f3f4f6;
            cursor: pointer;
        }

        .category-tab.active {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
        }

        .platform-card {
            background: white;
            border-radius: 10px;
            padding: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }

        @keyframes skeleton-loading {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ static_prefix }}/css/title-effects.css?v={{ asset_rev }}" rel="stylesheet">
    <link href="{{ static_prefix }}/css/viewer.css?v={{ asset_rev }}" rel="stylesheet">
</head>

<body>
    <div class="main-container">
        <!-- Header -->
        <div class="header-card">
            <div class="header-top" style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                <a href="https://github.com/sundt/uihash-hotnews" target="_blank" class="header-title"
                    style="text-decoration: none; color: inherit;"><svg height="24" width="24" viewBox="0 0 16 16"
                        style="vertical-align: middle;">
                        <path fill="currentColor"
                            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                    </svg></a>
                <a href="https://gitee.com/david-sunny/hotnews" target="_blank" class="header-title"
                    style="text-decoration: none; color: inherit;"><img src="https://gitee.com/favicon.ico" width="24"
                        height="24" style="vertical-align: middle;" alt="Gitee" loading="lazy" /></a>

                <div style="flex: 1;"></div>

                <div class="header-right" style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                    <!-- æœç´¢æŒ‰é’® -->
                    <button class="icon-btn search-btn" onclick="window.location.href='/search'" title="æœç´¢">
                        ğŸ”
                    </button>
                    
                    <!-- æŠ¤çœ¼æ¨¡å¼æŒ‰é’® -->
                    <button class="icon-btn theme-toggle-btn" id="themeToggleBtn" onclick="toggleTheme()"
                        title="åˆ‡æ¢æŠ¤çœ¼æ¨¡å¼">
                        ğŸŒ™
                    </button>
                    
                    <!-- æ ç›®è®¾ç½®æŒ‰é’® -->
                    <button class="icon-btn category-settings-btn" onclick="openCategorySettings()" title="æ ç›®è®¾ç½®">
                        âš™ï¸ <span class="new-dot" id="categorySettingsNewBadge"></span>
                    </button>
                    
                    <!-- ç™»å½•/ç”¨æˆ·æŒ‰é’® -->
                    <button class="icon-btn auth-btn" id="authBtn" onclick="handleAuthClick()" title="ç™»å½•/æ³¨å†Œ">
                        ğŸ‘¤
                    </button>
                </div>
            </div>

            <!-- è¿‡æ»¤é¢æ¿ -->
            <div class="filter-panel" id="filterPanel" style="display:none;"></div>
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="fetch-status" id="fetchStatus"></div>
        </div>

        <!-- Tabs -->
        <div class="category-tabs">
            {% set ns = namespace(active_set=false) %}
            {% for cat_id, category in data.categories.items() %}
            {% set is_active = (not ns.active_set) and (cat_id != 'explore') and (cat_id != 'my-tags') %}
            {% if is_active %}{% set ns.active_set = true %}{% endif %}
            <div class="category-tab {% if is_active %}active{% endif %}" data-category="{{ cat_id }}" draggable="false"
                onclick="switchTab('{{ cat_id }}')">
                <span class="category-drag-handle" title="æ‹–æ‹½è°ƒæ•´æ ç›®é¡ºåº" draggable="true">â˜°</span>
                <div class="category-tab-icon">{{ category.icon }}</div>
                <div class="category-tab-name">{{ category.name }}{% if category.is_new %}<span
                        class="new-badge new-badge-category" data-category="{{ cat_id }}">NEW</span>{% endif %}{% if
                    cat_id == 'sports' %}<span class="new-badge" id="newBadgeSportsTab"
                        style="display:none;">NEW</span>{% endif %}</div>
            </div>
            {% endfor %}
        </div>

        <!-- Content -->
        <div class="tab-content-area">
            {% set ns2 = namespace(active_set=false) %}
            {% for cat_id, category in data.categories.items() %}
            {% set is_active_category = (not ns2.active_set) and (cat_id != 'explore') and (cat_id != 'my-tags') %}
            {% if is_active_category %}{% set ns2.active_set = true %}{% endif %}
            <div class="tab-pane {% if is_active_category %}active{% endif %}" id="tab-{{ cat_id }}">
                {% if cat_id == 'my-tags' %}
                <div class="platform-grid" id="myTagsGrid">
                    <div class="my-tags-loading" style="text-align:center;padding:60px 20px;color:#6b7280;width:100%;">
                        <div style="font-size:48px;margin-bottom:16px;">ğŸ·ï¸</div>
                        <div style="font-size:16px;">åŠ è½½ä¸­...</div>
                    </div>
                </div>
                {% elif cat_id == 'explore' %}
                <div class="platform-grid" id="trExploreGrid"></div>
                {% elif cat_id == 'knowledge' %}
                <div class="platform-grid" data-mb-injected="1">
                    <div class="platform-card tr-morning-brief-card" data-platform="mb-slice-1" data-page-size="50"
                        draggable="false">
                        <div class="platform-header">
                            <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">ğŸ•’
                                æœ€æ–° 1-50</div>
                            <div class="platform-header-actions"></div>
                        </div>
                        <ul class="news-list" data-mb-list="slice1">
                            <li class="news-placeholder" aria-hidden="true">åŠ è½½ä¸­...</li>
                        </ul>
                    </div>

                    <div class="platform-card tr-morning-brief-card" data-platform="mb-slice-2" data-page-size="50"
                        draggable="false">
                        <div class="platform-header">
                            <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">â­ æœ€æ–°
                                51-100</div>
                            <div class="platform-header-actions"></div>
                        </div>
                        <ul class="news-list" data-mb-list="slice2">
                            <li class="news-placeholder" aria-hidden="true">åŠ è½½ä¸­...</li>
                        </ul>
                    </div>

                    <div class="platform-card tr-morning-brief-card" data-platform="mb-slice-3" data-page-size="50"
                        draggable="false">
                        <div class="platform-header">
                            <div class="platform-name" style="margin-bottom:0;padding-bottom:0;border-bottom:none;">ğŸ§¾
                                æœ€æ–° 101-150</div>
                            <div class="platform-header-actions"></div>
                        </div>
                        <ul class="news-list" data-mb-list="slice3">
                            <li class="news-placeholder" aria-hidden="true">åŠ è½½ä¸­...</li>
                        </ul>
                    </div>
                </div>
                {% else %}
                <div class="platform-grid">
                    {% for platform_id, platform in (category.platforms.items()|list) %}
                    {% set is_real_card = is_active_category and loop.index0 < 3 %} <div class="platform-card"
                        data-platform="{{ platform_id }}" data-total-count="{{ platform.news|length }}"
                        data-loaded-count="{% if is_real_card %}{{ [platform.news|length, items_per_card]|min }}{% else %}0{% endif %}"
                        data-lazy="{% if is_real_card %}0{% else %}1{% endif %}" draggable="false">
                        <div class="platform-header">
                            <span class="platform-drag-handle" title="æ‹–æ‹½è°ƒæ•´å¹³å°é¡ºåº" draggable="true">â˜°</span>
                            <div class="platform-name"
                                style="margin-bottom: 0; padding-bottom: 0; border-bottom: none; cursor: pointer;"
                                onclick="dismissNewPlatformBadge('{{ platform_id }}')">
                                ğŸ“± {{ platform.name }}
                                {% if platform.is_new %}<span class="new-badge new-badge-platform"
                                    data-platform="{{ platform_id }}">NEW</span>{% endif %}
                            </div>
                            <div class="platform-header-actions"></div>
                        </div>
                        <ul class="news-list">
                            {% if is_real_card %}
                            {% for news in platform.news[:items_per_card] %}
                            <li class="news-item" data-news-id="{{ news.stable_id }}"
                                data-news-title="{{ news.display_title or news.title }}">
                                <div class="news-item-content">
                                    <input type="checkbox" class="news-checkbox" title="æ ‡è®°å·²è¯»"
                                        onchange="markAsRead(this)" />
                                    <span class="news-index">{{ loop.index }}</span>
                                    <a class="news-title {% if news.is_cross_platform %}cross-platform{% endif %}"
                                        href="{{ news.url or '#' }}" target="_blank" rel="noopener noreferrer"
                                        onclick="handleTitleClickV2(this, event)"
                                        onauxclick="handleTitleClickV2(this, event)"
                                        oncontextmenu="handleTitleClickV2(this, event)"
                                        onkeydown="handleTitleKeydownV2(this, event)">
                                        {{ news.display_title or news.title }}
                                        {% if news.is_cross_platform %}
                                        <span class="cross-platform-badge"
                                            title="åŒæ—¶å‡ºç°åœ¨: {{ news.cross_platforms|join(', ') }}">
                                            ğŸ”¥ {{ news.cross_platform_count }}
                                        </span>
                                        {% endif %}
                                    </a>
                                    {% if news.timestamp %}
                                    <span class="tr-news-date"
                                        style="margin-left:8px;color:#9ca3af;font-size:12px;white-space:nowrap;">{{
                                        news.timestamp[:10] }}</span>
                                    {% endif %}
                                </div>
                                {% if news.meta and not platform_id.startswith('rss-') %}<div class="news-subtitle">{{
                                    news.meta }}</div>{% endif %}
                            </li>
                            {% endfor %}
                            {% else %}
                            {% for _ in range(0, 8) %}
                            <li class="tr-news-skeleton" aria-hidden="true">
                                <div class="tr-news-skeleton-line"></div>
                            </li>
                            {% endfor %}
                            {% endif %}
                        </ul>
                        <div class="news-load-sentinel" aria-hidden="true"></div>
                </div>
                {% endfor %}
            </div>
            <div class="category-empty-state" style="display:none;" aria-hidden="true">æ²¡æœ‰åŒ¹é…å†…å®¹ï¼Œè¯·è°ƒæ•´å…³é”®è¯æˆ–åˆ‡æ¢æ¨¡å¼</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    </div>

    {% include "_viewer_modals.html" %}

    <div
        style="margin-top:14px;padding:10px 6px 18px 6px;color:#6b7280;font-size:12px;line-height:1.5;text-align:center;">
        æœ¬ç«™å†…å®¹ç”±ç³»ç»Ÿè‡ªåŠ¨èšåˆè‡ªäº’è”ç½‘å…¬å¼€RSSæºï¼Œä»…æä¾›ä¿¡æ¯ç´¢å¼•ä¸å¯¼è¯»ï¼Œç‰ˆæƒå½’å±äºåŸä½œè€…ã€‚æœ¬ç«™ä¸å¯¹å…¶å‡†ç¡®æ€§ã€å®Œæ•´æ€§è´Ÿè´£ã€‚å¦‚æ¶‰åŠç‰ˆæƒæˆ–å†…å®¹è¿è§„ï¼Œè¯·è”ç³»æˆ‘ä»¬åŠæ—¶åˆ é™¤ã€‚
        <a class="tr-footer-top-toggle" href="https://p2fjebt29i.feishu.cn/share/base/form/shrcnL6g8L6M6yFJU9gTnE4pBqe"
            target="_blank" rel="noopener noreferrer">ğŸ’¡ å»ºè®®</a>
    </div>

    <script type="module" src="{{ static_prefix }}/js/index.js?v={{ asset_rev }}"></script>
    <script>
        // å¤„ç†ç™»å½•/ç”¨æˆ·æŒ‰é’®ç‚¹å‡»
        async function handleAuthClick() {
            try {
                const res = await fetch('/api/auth/me');
                if (res.ok) {
                    const data = await res.json();
                    if (data.ok && data.user) {
                        // å·²ç™»å½•ï¼Œè·³è½¬åˆ°ç”¨æˆ·è®¾ç½®
                        window.location.href = '/api/user/preferences/page';
                        return;
                    }
                }
            } catch (e) {
                console.error('Auth check failed:', e);
            }
            // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
            window.location.href = '/api/auth/page';
        }
        
        // æ›´æ–°ç™»å½•æŒ‰é’®çŠ¶æ€
        async function updateAuthButton() {
            try {
                const res = await fetch('/api/auth/me');
                if (res.ok) {
                    const data = await res.json();
                    if (data.ok && data.user) {
                        const btn = document.getElementById('authBtn');
                        if (btn) {
                            btn.title = 'æˆ‘çš„è®¾ç½®';
                            btn.classList.add('logged-in');
                        }
                    }
                }
            } catch (e) {
                // Ignore
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ›´æ–°æŒ‰é’®çŠ¶æ€
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', updateAuthButton);
        } else {
            updateAuthButton();
        }
    </script>
    <script>
        (function () {
            try {
                document.body.classList.remove('tr-mobile-top-collapsed');
            } catch (e) { }
            try {
                localStorage.setItem('hotnews_mobile_top_collapsed_v1', '0');
            } catch (e) { }
        })();
    </script>
</body>

</html>